"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[708],{29600:function(e,t,r){r.d(t,{default:function(){return l}});var n=r(14623),o=r(2265),a=r(63639),i=r(82431),s=r(99637);class l extends o.Component{static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("Error caught by ErrorBoundary:",e,t),this.setState({error:e,errorInfo:t})}render(){return this.state.hasError?this.props.fallback?this.props.fallback:(0,n.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-background p-4",children:(0,n.jsx)("div",{className:"max-w-md w-full",children:(0,n.jsxs)("div",{className:"card p-8 text-center",children:[(0,n.jsx)("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,n.jsx)(a.Z,{className:"w-8 h-8 text-red-600"})}),(0,n.jsx)("h1",{className:"text-xl font-bold text-text-primary mb-2",children:"Something went wrong"}),(0,n.jsx)("p",{className:"text-text-secondary mb-6",children:"We encountered an unexpected error. Please try refreshing the page or return to the dashboard."}),(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsxs)("button",{onClick:this.handleRetry,className:"btn-primary w-full flex items-center justify-center",children:[(0,n.jsx)(i.Z,{className:"w-4 h-4 mr-2"}),"Try Again"]}),(0,n.jsxs)("button",{onClick:this.handleGoHome,className:"btn-secondary w-full flex items-center justify-center",children:[(0,n.jsx)(s.Z,{className:"w-4 h-4 mr-2"}),"Go to Dashboard"]})]}),!1]})})}):this.props.children}constructor(e){super(e),this.handleRetry=()=>{this.setState({hasError:!1,error:void 0,errorInfo:void 0})},this.handleGoHome=()=>{window.location.href="/"},this.state={hasError:!1}}}},5526:function(e,t,r){r.d(t,{Hf:function(){return d},LU:function(){return l},OQ:function(){return a},XF:function(){return g},k_:function(){return i},lj:function(){return u},un:function(){return s},xG:function(){return c}});var n=r(57557);let o="https://nlxwkbmcfejflujtzmky.supabase.co",a=(0,n.eI)(o,"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5seHdrYm1jZmVqZmx1anR6bWt5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM3MDEwNjksImV4cCI6MjA3OTI3NzA2OX0.OMRdstZ9Smn7MSKiYZ0mzf-oCEyCGSXKsESh_Rvzr30"),i=async function(e){var t;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=null===(t=(await a.auth.getSession()).data.session)||void 0===t?void 0:t.access_token,i={headers:{"Content-Type":"application/json",...n&&{Authorization:"Bearer ".concat(n)}}},s=await fetch("".concat(o,"/functions/v1/").concat(e),{...i,...r,headers:{...i.headers,...r.headers}});if(!s.ok)throw Error(await s.text());return s.json()},s=e=>{if(e.startsWith("+1")&&12===e.length){let t=e.slice(2);return"(".concat(t.slice(0,3),") ").concat(t.slice(3,6),"-").concat(t.slice(6))}return e},l=e=>"".concat(Math.floor(e/60),":").concat((e%60).toString().padStart(2,"0")),c=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(e),u=e=>{switch(e){case"success":return"text-white bg-success-600 border border-success-500";case"failure":case"error":return"text-white bg-error-600 border border-error-500";case"no_answer":case"busy":return"text-white bg-warning-600 border border-warning-500";case"voicemail":return"text-white bg-secondary-600 border border-secondary-500";case"in_progress":return"text-white bg-primary-600 border border-primary-500";default:return"text-white bg-neutral-600 border border-neutral-500"}};function d(e){return e>=1e3?"".concat((e/1e3).toFixed(1),"K"):e.toString()}function g(e){return 10*Math.ceil(e/60)}},43860:function(e,t,r){r.d(t,{AppProvider:function(){return u},q:function(){return c}});var n=r(14623),o=r(2265),a=r(5526);let i={user:null,profile:null,organization:null,subscription:null,agents:[],contacts:[],loading:!1,initialized:!1,error:null};function s(e,t){switch(t.type){case"SET_LOADING":return{...e,loading:t.loading};case"SET_INITIALIZED":return{...e,initialized:t.initialized};case"AUTH_SUCCESS":return{...e,user:t.payload.user,profile:t.payload.profile||null,organization:t.payload.organization||null,subscription:t.payload.subscription||null,agents:t.payload.agents||[],loading:!1,error:null};case"RESET_STATE":return{...i,initialized:!0};case"UPDATE_AGENTS":return{...e,agents:t.agents};case"UPDATE_CONTACTS":return{...e,contacts:t.contacts};case"SET_ERROR":return{...e,error:t.error,loading:!1};default:return e}}let l=(0,o.createContext)(void 0);function c(){let e=(0,o.useContext)(l);if(!e)throw Error("useApp must be used within AppProvider");return e}function u(e){let{children:t}=e,[r,c]=(0,o.useReducer)(s,i),u=(0,o.useRef)(null),d=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(u.current)return console.log("\uD83D\uDD04 fetchUserData already in progress, waiting..."),u.current;let t=(async()=>{try{e||document.hidden||c({type:"SET_LOADING",loading:!0}),console.log("\uD83D\uDD04 Starting fetchUserData...",{skipLoading:e}),e&&await new Promise(e=>setTimeout(e,500));let{data:{user:t},error:r}=await a.OQ.auth.getUser();if(r||!t){console.log("\uD83D\uDC64 No user found:",(null==r?void 0:r.message)||"No user"),c({type:"RESET_STATE"});return}console.log("\uD83D\uDC64 User found, fetching profile...",t.id);let{data:n,error:o}=await a.OQ.from("user_profiles").select("*").eq("id",t.id).single();if(o||!n){console.log("⚠️ No profile found:",(null==o?void 0:o.message)||"No profile data"),c({type:"AUTH_SUCCESS",payload:{user:t}});return}console.log("\uD83D\uDC64 Profile found:",n.first_name,n.last_name);let i=null,s=null,l=[];if(null==n?void 0:n.organization_id){console.log("\uD83C\uDFE2 Fetching organization data...");let[e,t,r]=await Promise.allSettled([a.OQ.from("organizations").select("*").eq("id",n.organization_id).single(),a.OQ.from("subscriptions").select("*").eq("organization_id",n.organization_id).single(),a.OQ.from("agents").select("*").eq("organization_id",n.organization_id).order("created_at",{ascending:!1})]);i="fulfilled"===e.status?e.value.data:null,s="fulfilled"===t.status?t.value.data:null,l="fulfilled"===r.status&&r.value.data||[],console.log("✅ Organization data fetched:",{organization:!!i,subscription:!!s,agentsCount:l.length})}c({type:"AUTH_SUCCESS",payload:{user:t,profile:n,organization:i,subscription:s,agents:l}}),console.log("✅ fetchUserData completed successfully")}catch(e){var t,r,n;console.error("❌ Error fetching user data:",e),(null==e?void 0:null===(t=e.message)||void 0===t?void 0:t.includes("auth"))||(null==e?void 0:null===(r=e.message)||void 0===r?void 0:r.includes("JWT"))||(null==e?void 0:null===(n=e.message)||void 0===n?void 0:n.includes("connection"))?(console.log("\uD83D\uDD10 Auth/connection error detected, resetting state"),c({type:"RESET_STATE"})):c({type:"SET_ERROR",error:"Failed to load user data"})}finally{u.current=null}})();return u.current=t,t},g=async()=>{try{var e;if(!r.user||!(null===(e=r.profile)||void 0===e?void 0:e.organization_id)){console.log("❌ Cannot fetch agents: missing user or organization");return}console.log("\uD83E\uDD16 Fetching agents...");let{data:t,error:n}=await a.OQ.from("agents").select("*").eq("organization_id",r.profile.organization_id).order("created_at",{ascending:!1});if(n)throw n;c({type:"UPDATE_AGENTS",agents:t||[]}),console.log("✅ Agents fetched:",(null==t?void 0:t.length)||0)}catch(e){console.error("❌ Error fetching agents:",e)}},h=async()=>{try{var e;if(!r.user||!(null===(e=r.profile)||void 0===e?void 0:e.organization_id)){console.log("❌ Cannot fetch contacts: missing user or organization");return}console.log("\uD83D\uDC65 Fetching contacts...");let{data:t,error:n}=await a.OQ.from("contacts").select("*").eq("organization_id",r.profile.organization_id).order("created_at",{ascending:!1});if(n)throw n;c({type:"UPDATE_CONTACTS",contacts:t||[]}),console.log("✅ Contacts fetched:",(null==t?void 0:t.length)||0)}catch(e){console.error("❌ Error fetching contacts:",e)}},f=async()=>{try{console.log("\uD83D\uDEAA Logging out..."),await a.OQ.auth.signOut(),c({type:"RESET_STATE"}),sessionStorage.removeItem("redirect-path"),console.log("✅ Logout complete")}catch(e){console.error("❌ Error during logout:",e)}};return(0,o.useEffect)(()=>{let e=!0;(async()=>{console.log("\uD83D\uDE80 Initializing app...");try{console.log("\uD83D\uDD0D Checking for session...");let e=a.OQ.auth.getSession(),t=new Promise((e,t)=>{setTimeout(()=>t(Error("Supabase connection timeout")),5e3)}),{data:{session:r}}=await Promise.race([e,t]);(null==r?void 0:r.user)?(console.log("✅ Found existing session, fetching user data..."),await d(!0)):(console.log("\uD83D\uDD10 No session found"),c({type:"RESET_STATE"}))}catch(e){console.warn("⚠️ Supabase not available (static mode):",e instanceof Error?e.message:String(e)),c({type:"RESET_STATE"})}e&&c({type:"SET_INITIALIZED",initialized:!0})})();let{data:{subscription:t}}=a.OQ.auth.onAuthStateChange(async(t,r)=>{if(console.log("\uD83D\uDD10 Auth state change:",{event:t,hasUser:!!(null==r?void 0:r.user)}),e)try{"SIGNED_IN"===t&&(null==r?void 0:r.user)?(console.log("\uD83D\uDD04 Auth SIGNED_IN - fetching user data..."),setTimeout(async()=>{if(e){let e=document.hidden;await d(e)}},200)):"SIGNED_OUT"===t?(console.log("\uD83D\uDD04 Auth SIGNED_OUT - resetting state"),c({type:"RESET_STATE"})):"INITIAL_SESSION"===t?console.log("\uD83D\uDD04 Auth event ignored:",t):"TOKEN_REFRESHED"===t&&console.log("\uD83D\uDD04 Auth TOKEN_REFRESHED - ignoring to prevent refresh")}catch(e){console.warn("⚠️ Auth state change error (possibly static mode):",e instanceof Error?e.message:String(e))}});return()=>{e=!1,t.unsubscribe()}},[]),(0,o.useEffect)(()=>{if(!r.loading)return;let e=setTimeout(()=>{r.loading&&(console.warn("\uD83D\uDED1 Emergency loader timeout - clearing localStorage and reloading..."),localStorage.clear(),sessionStorage.clear(),window.location.href="/auth")},3e4);return()=>clearTimeout(e)},[r.loading]),(0,n.jsx)(l.Provider,{value:{state:r,dispatch:c,actions:{fetchUserData:d,fetchAgents:g,fetchContacts:h,logout:f}},children:t})}}}]);