(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[12],{98012:function(e,t,s){Promise.resolve().then(s.bind(s,97111))},97111:function(e,t,s){"use strict";s.d(t,{default:function(){return tg}});var a=s(14623),r=s(43860),i=s(2265),n=s(60429),l=s(5526),c=s(29090),o=s(89345),d=s(87769),m=s(42208),x=s(69064);function u(e){let{onSuccess:t,onSwitchToSignup:s,onForgotPassword:r}=e,[u,p]=(0,i.useState)({email:"",password:""}),[h,g]=(0,i.useState)(!1),[b,y]=(0,i.useState)(!1),[f,j]=(0,i.useState)({}),v=()=>{let e={};return u.email.trim()?/\S+@\S+\.\S+/.test(u.email)||(e.email="Please enter a valid email"):e.email="Email is required",u.password||(e.password="Password is required"),j(e),0===Object.keys(e).length},N=async e=>{if(e.preventDefault(),v()){y(!0);try{console.log("\uD83D\uDD10 Attempting login...");let{data:e,error:s}=await l.OQ.auth.signInWithPassword({email:u.email,password:u.password});if(s)throw console.error("❌ Login error:",s),s;e.user&&(console.log("✅ Login successful, user:",e.user.email),x.ZP.success("Welcome back!"),setTimeout(()=>{console.log("\uD83C\uDFAF Calling onSuccess callback"),t()},100))}catch(e){console.error("\uD83D\uDCA5 Login error:",e),e.message.includes("Invalid login credentials")?x.ZP.error("Invalid email or password"):e.message.includes("Email not confirmed")?x.ZP.error("Please check your email and click the verification link"):x.ZP.error(e.message||"Failed to sign in")}finally{setTimeout(()=>{y(!1)},500)}}},w=(e,t)=>{p(s=>({...s,[e]:t})),f[e]&&j(t=>({...t,[e]:void 0}))};return(0,a.jsx)("div",{className:"min-h-screen auth-bg flex items-center justify-center p-4",children:(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"card rounded-3xl shadow-strong p-8 w-full max-w-md",children:[(0,a.jsxs)("div",{className:"text-center mb-8",children:[(0,a.jsx)(n.E.div,{initial:{scale:.9},animate:{scale:1},className:"w-16 h-16 bg-primary-600 rounded-2xl flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)(c.Z,{className:"w-8 h-8 text-white"})}),(0,a.jsx)("h1",{className:"text-2xl font-bold text-text-primary",children:"Welcome Back!"}),(0,a.jsx)("p",{className:"text-text-secondary mt-2",children:"Sign in to manage your AI voice agents and get started with your free trial."})]}),(0,a.jsxs)("form",{onSubmit:N,className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Email Address"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(o.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-text-secondary"}),(0,a.jsx)("input",{type:"email",value:u.email,onChange:e=>w("email",e.target.value),className:"input-field pl-10 ".concat(f.email?"border-error-500":""),placeholder:"john@example.com",autoComplete:"email",disabled:b})]}),f.email&&(0,a.jsx)("p",{className:"text-error-600 text-sm mt-1",children:f.email})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Password"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:h?"text":"password",value:u.password,onChange:e=>w("password",e.target.value),className:"input-field pr-10 ".concat(f.password?"border-error-500":""),placeholder:"••••••••",autoComplete:"current-password",disabled:b}),(0,a.jsx)("button",{type:"button",onClick:()=>g(!h),className:"absolute right-3 top-1/2 transform -translate-y-1/2",disabled:b,children:h?(0,a.jsx)(d.Z,{className:"w-5 h-5 text-text-secondary"}):(0,a.jsx)(m.Z,{className:"w-5 h-5 text-text-secondary"})})]}),f.password&&(0,a.jsx)("p",{className:"text-error-600 text-sm mt-1",children:f.password})]}),(0,a.jsx)("div",{className:"text-right",children:(0,a.jsx)("button",{type:"button",onClick:r,className:"text-sm text-primary-600 hover:text-primary-700 font-medium",disabled:b,children:"Forgot your password?"})}),(0,a.jsx)("button",{type:"submit",disabled:b,className:"w-full btn-primary disabled:opacity-50 disabled:cursor-not-allowed",children:b?"Signing in...":"Sign In"})]}),(0,a.jsx)("div",{className:"text-center mt-6",children:(0,a.jsxs)("p",{className:"text-text-secondary",children:["Don't have an account?"," ",(0,a.jsx)("button",{onClick:s,className:"text-primary-600 hover:text-primary-700 font-medium",disabled:b,children:"Create one"})]})}),(0,a.jsxs)(n.E.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},className:"mt-6 p-4 trial-banner rounded-xl border border-primary-200",children:[(0,a.jsx)("h3",{className:"font-medium text-primary-800 mb-1",children:"Start Your Free Trial"}),(0,a.jsx)("p",{className:"text-sm text-primary-700",children:"Get 14 days and 100 minutes free to test Kai's AI voice agents"})]})]})})}var p=s(5095),h=s(92369),g=s(60044),b=s(32489),y=s(65302),f=s(40875),j=s(13041),v=s(65951);let N=[{code:"US",name:"United States",dialCode:"+1",flag:"\uD83C\uDDFA\uD83C\uDDF8"},{code:"CA",name:"Canada",dialCode:"+1",flag:"\uD83C\uDDE8\uD83C\uDDE6"},{code:"GB",name:"United Kingdom",dialCode:"+44",flag:"\uD83C\uDDEC\uD83C\uDDE7"},{code:"AU",name:"Australia",dialCode:"+61",flag:"\uD83C\uDDE6\uD83C\uDDFA"},{code:"DE",name:"Germany",dialCode:"+49",flag:"\uD83C\uDDE9\uD83C\uDDEA"},{code:"FR",name:"France",dialCode:"+33",flag:"\uD83C\uDDEB\uD83C\uDDF7"},{code:"ES",name:"Spain",dialCode:"+34",flag:"\uD83C\uDDEA\uD83C\uDDF8"},{code:"IT",name:"Italy",dialCode:"+39",flag:"\uD83C\uDDEE\uD83C\uDDF9"},{code:"NL",name:"Netherlands",dialCode:"+31",flag:"\uD83C\uDDF3\uD83C\uDDF1"},{code:"SE",name:"Sweden",dialCode:"+46",flag:"\uD83C\uDDF8\uD83C\uDDEA"},{code:"NO",name:"Norway",dialCode:"+47",flag:"\uD83C\uDDF3\uD83C\uDDF4"},{code:"DK",name:"Denmark",dialCode:"+45",flag:"\uD83C\uDDE9\uD83C\uDDF0"},{code:"FI",name:"Finland",dialCode:"+358",flag:"\uD83C\uDDEB\uD83C\uDDEE"},{code:"PL",name:"Poland",dialCode:"+48",flag:"\uD83C\uDDF5\uD83C\uDDF1"},{code:"CH",name:"Switzerland",dialCode:"+41",flag:"\uD83C\uDDE8\uD83C\uDDED"},{code:"AT",name:"Austria",dialCode:"+43",flag:"\uD83C\uDDE6\uD83C\uDDF9"},{code:"BE",name:"Belgium",dialCode:"+32",flag:"\uD83C\uDDE7\uD83C\uDDEA"},{code:"IE",name:"Ireland",dialCode:"+353",flag:"\uD83C\uDDEE\uD83C\uDDEA"},{code:"NZ",name:"New Zealand",dialCode:"+64",flag:"\uD83C\uDDF3\uD83C\uDDFF"},{code:"SG",name:"Singapore",dialCode:"+65",flag:"\uD83C\uDDF8\uD83C\uDDEC"},{code:"HK",name:"Hong Kong",dialCode:"+852",flag:"\uD83C\uDDED\uD83C\uDDF0"},{code:"JP",name:"Japan",dialCode:"+81",flag:"\uD83C\uDDEF\uD83C\uDDF5"},{code:"KR",name:"South Korea",dialCode:"+82",flag:"\uD83C\uDDF0\uD83C\uDDF7"},{code:"CN",name:"China",dialCode:"+86",flag:"\uD83C\uDDE8\uD83C\uDDF3"},{code:"IN",name:"India",dialCode:"+91",flag:"\uD83C\uDDEE\uD83C\uDDF3"},{code:"BR",name:"Brazil",dialCode:"+55",flag:"\uD83C\uDDE7\uD83C\uDDF7"},{code:"MX",name:"Mexico",dialCode:"+52",flag:"\uD83C\uDDF2\uD83C\uDDFD"},{code:"AR",name:"Argentina",dialCode:"+54",flag:"\uD83C\uDDE6\uD83C\uDDF7"},{code:"CL",name:"Chile",dialCode:"+56",flag:"\uD83C\uDDE8\uD83C\uDDF1"},{code:"ZA",name:"South Africa",dialCode:"+27",flag:"\uD83C\uDDFF\uD83C\uDDE6"},{code:"AE",name:"United Arab Emirates",dialCode:"+971",flag:"\uD83C\uDDE6\uD83C\uDDEA"},{code:"SA",name:"Saudi Arabia",dialCode:"+966",flag:"\uD83C\uDDF8\uD83C\uDDE6"},{code:"IL",name:"Israel",dialCode:"+972",flag:"\uD83C\uDDEE\uD83C\uDDF1"},{code:"TR",name:"Turkey",dialCode:"+90",flag:"\uD83C\uDDF9\uD83C\uDDF7"},{code:"RU",name:"Russia",dialCode:"+7",flag:"\uD83C\uDDF7\uD83C\uDDFA"},{code:"UA",name:"Ukraine",dialCode:"+380",flag:"\uD83C\uDDFA\uD83C\uDDE6"},{code:"EG",name:"Egypt",dialCode:"+20",flag:"\uD83C\uDDEA\uD83C\uDDEC"},{code:"NG",name:"Nigeria",dialCode:"+234",flag:"\uD83C\uDDF3\uD83C\uDDEC"},{code:"KE",name:"Kenya",dialCode:"+254",flag:"\uD83C\uDDF0\uD83C\uDDEA"},{code:"PH",name:"Philippines",dialCode:"+63",flag:"\uD83C\uDDF5\uD83C\uDDED"},{code:"TH",name:"Thailand",dialCode:"+66",flag:"\uD83C\uDDF9\uD83C\uDDED"},{code:"VN",name:"Vietnam",dialCode:"+84",flag:"\uD83C\uDDFB\uD83C\uDDF3"},{code:"ID",name:"Indonesia",dialCode:"+62",flag:"\uD83C\uDDEE\uD83C\uDDE9"},{code:"MY",name:"Malaysia",dialCode:"+60",flag:"\uD83C\uDDF2\uD83C\uDDFE"},{code:"PT",name:"Portugal",dialCode:"+351",flag:"\uD83C\uDDF5\uD83C\uDDF9"},{code:"GR",name:"Greece",dialCode:"+30",flag:"\uD83C\uDDEC\uD83C\uDDF7"},{code:"CZ",name:"Czech Republic",dialCode:"+420",flag:"\uD83C\uDDE8\uD83C\uDDFF"},{code:"RO",name:"Romania",dialCode:"+40",flag:"\uD83C\uDDF7\uD83C\uDDF4"},{code:"HU",name:"Hungary",dialCode:"+36",flag:"\uD83C\uDDED\uD83C\uDDFA"}];function w(e){let{value:t,onChange:s,error:r,placeholder:n="Enter phone number",defaultCountryCode:l="+1"}=e,[c,o]=(0,i.useState)(N.find(e=>e.dialCode===l)||N[0]),[d,m]=(0,i.useState)(!1),[x,u]=(0,i.useState)(""),p=(0,i.useRef)(null);(0,i.useEffect)(()=>{let e=e=>{p.current&&!p.current.contains(e.target)&&(m(!1),u(""))};return d&&(document.body.style.overflow="hidden",document.addEventListener("mousedown",e)),()=>{document.body.style.overflow="unset",document.removeEventListener("mousedown",e)}},[d]);let h=N.filter(e=>e.name.toLowerCase().includes(x.toLowerCase())||e.dialCode.includes(x)||e.code.toLowerCase().includes(x.toLowerCase())),g=e=>{o(e),m(!1),u(""),s(t,e.dialCode)};return(0,a.jsxs)("div",{className:"relative w-full",children:[(0,a.jsxs)("div",{className:"flex items-stretch rounded-xl border divide-x divide-bg-tertiary focus-within:ring-2 focus-within:border-transparent focus-within:divide-transparent transition-all duration-200 w-full ".concat(r?"border-error-500 focus-within:ring-error-500":"border-bg-tertiary focus-within:ring-primary-solid"),children:[(0,a.jsxs)("div",{ref:p,className:"relative",children:[(0,a.jsxs)("button",{type:"button",onClick:()=>m(!d),className:"flex items-center space-x-1 sm:space-x-2 px-2 sm:px-4 py-3 bg-bg-secondary hover:bg-bg-tertiary transition-all duration-200 focus:outline-none min-h-[50px] rounded-l-xl",children:[v[c.code]&&i.createElement(v[c.code],{className:"w-5 h-3 sm:w-6 sm:h-4 flex-shrink-0",title:c.name}),(0,a.jsx)("span",{className:"text-sm sm:text-base font-semibold text-text-primary whitespace-nowrap",children:c.dialCode}),(0,a.jsx)(f.Z,{className:"w-3 h-3 sm:w-4 sm:h-4 text-text-secondary transition-transform duration-200 flex-shrink-0 ".concat(d?"rotate-180":"")})]}),d&&(0,a.jsxs)("div",{className:"fixed sm:absolute top-20 sm:top-full left-4 right-4 sm:left-0 sm:right-auto mt-0 sm:mt-2 w-auto sm:w-80 bg-bg-secondary border border-bg-tertiary rounded-xl shadow-strong z-50 max-h-[70vh] sm:max-h-96 overflow-hidden flex flex-col",children:[(0,a.jsx)("div",{className:"p-3 border-b border-bg-tertiary sticky top-0 bg-bg-secondary z-10",children:(0,a.jsx)("input",{type:"text",value:x,onChange:e=>u(e.target.value),placeholder:"Search country...",className:"w-full px-3 py-2 bg-bg-primary border border-bg-tertiary rounded-lg text-sm text-text-primary placeholder-text-tertiary focus:outline-none focus:ring-2 focus:ring-primary-solid focus:border-transparent",autoFocus:!0})}),(0,a.jsx)("div",{className:"overflow-y-auto flex-1",children:h.length>0?h.map(e=>(0,a.jsxs)("button",{type:"button",onClick:()=>g(e),className:"w-full flex items-center gap-3 px-4 py-3 hover:bg-bg-tertiary transition-colors text-left ".concat(c.code===e.code?"bg-primary-solid bg-opacity-10 border-l-4 border-primary-solid":""),children:[v[e.code]&&i.createElement(v[e.code],{className:"w-7 h-5 flex-shrink-0",title:e.name}),(0,a.jsx)("span",{className:"flex-1 text-sm text-text-primary font-medium min-w-0",children:e.name}),(0,a.jsx)("span",{className:"text-sm font-semibold text-text-secondary",children:e.dialCode})]},e.code)):(0,a.jsx)("div",{className:"px-4 py-8 text-center text-text-tertiary text-sm",children:"No countries found"})})]})]}),(0,a.jsxs)("div",{className:"relative flex-1 min-w-0",children:[(0,a.jsx)(j.Z,{className:"absolute left-2 sm:left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 sm:w-5 sm:h-5 text-text-secondary z-10 pointer-events-none"}),(0,a.jsx)("input",{type:"tel",value:t,onChange:e=>{let t=e.target.value;if((t=t.replace(/[^\d+\s-]/g,"")).startsWith("+")){let e=t.slice(1).replace(/\D/g,"");for(let t of["+"+e.slice(0,4),"+"+e.slice(0,3),"+"+e.slice(0,2),"+"+e.slice(0,1)]){let a=N.find(e=>e.dialCode===t);if(a&&e.length>=t.length-1){a.code!==c.code&&o(a),s(e.slice(t.length-1),a.dialCode);return}}s(t,c.dialCode);return}let a=t.replace(/\D/g,""),r=15;"+1"===c.dialCode||"+91"===c.dialCode||"+44"===c.dialCode?r=10:"+61"===c.dialCode&&(r=9),s(a.slice(0,r),c.dialCode)},className:"w-full px-3 sm:px-4 py-3 pl-8 sm:pl-10 bg-bg-secondary text-text-primary placeholder-text-tertiary focus:outline-none transition-all duration-200 min-h-[50px] border-0 rounded-r-xl text-sm sm:text-base",placeholder:n})]})]}),r&&(0,a.jsx)("p",{className:"text-error-600 text-sm mt-2 ml-1",children:r}),(0,a.jsxs)("p",{className:"text-text-tertiary text-xs mt-2 ml-1",children:["\uD83D\uDCA1 Type country code (e.g., +91 for India).","+1"===c.dialCode&&" US/Canada requires 10 digits.","+91"===c.dialCode&&" India requires 10 digits.","+44"===c.dialCode&&" UK requires 10 digits.","+61"===c.dialCode&&" Australia requires 9 digits."]})]})}let _=["welcome123","12345678","00000000","password"];function C(e){let{onSuccess:t,onSwitchToLogin:s}=e,[r,c]=(0,i.useState)({firstName:"",lastName:"",email:"",password:"",confirmPassword:"",phoneNumber:"",organizationName:"",industry:""}),[u,f]=(0,i.useState)(!1),[j,v]=(0,i.useState)(!1),[N,C]=(0,i.useState)(!1),[k,D]=(0,i.useState)(1),[S,Z]=(0,i.useState)({}),[E,A]=(0,i.useState)("+1"),[P,z]=(0,i.useState)(!1),I=()=>{let e={};if(r.firstName.trim()||(e.firstName="First name is required"),r.lastName.trim()||(e.lastName="Last name is required"),r.email.trim()?/\S+@\S+\.\S+/.test(r.email)||(e.email="Please enter a valid email"):e.email="Email is required",r.password?r.password.length<8||r.password.length>12?e.password="Password must be between 8 and 12 characters":_.includes(r.password.toLowerCase())&&(e.password="This password is too common. Please choose a stronger password."):e.password="Password is required",r.password!==r.confirmPassword&&(e.confirmPassword="Passwords do not match"),r.phoneNumber.trim()){let t=r.phoneNumber.replace(/\D/g,"");"+1"===E?10!==t.length&&(e.phoneNumber="US/Canada phone numbers must be exactly 10 digits"):"+91"===E?10!==t.length&&(e.phoneNumber="Indian phone numbers must be exactly 10 digits"):"+44"===E?10!==t.length&&(e.phoneNumber="UK phone numbers must be exactly 10 digits"):"+61"===E?9!==t.length&&(e.phoneNumber="Australian phone numbers must be exactly 9 digits"):t.length<7?e.phoneNumber="Phone number must be at least 7 digits":t.length>15&&(e.phoneNumber="Phone number must not exceed 15 digits")}else e.phoneNumber="Phone number is required";return Z(e),0===Object.keys(e).length},F=()=>{let e={};return r.organizationName.trim()||(e.organizationName="Organization name is required"),r.industry.trim()||(e.industry="Industry is required"),Z(e),0===Object.keys(e).length},O=async()=>{if(I()){C(!0);try{var e,t;let s=r.phoneNumber.replace(/\D/g,""),a="".concat(E).concat(s);console.log("Checking uniqueness for:",{email:r.email.toLowerCase(),phone:a});let[i,n]=await Promise.all([l.OQ.functions.invoke("check-email-exists",{body:{email:r.email.toLowerCase()}}),l.OQ.functions.invoke("check-phone-exists",{body:{phone_number:a}})]);if(console.log("Email check response:",i),console.log("Phone check response:",n),i.error){console.error("Error checking email:",i.error),x.ZP.error("Failed to validate email. Please try again."),C(!1);return}if(n.error){console.error("Error checking phone:",n.error),x.ZP.error("Failed to validate phone number. Please try again."),C(!1);return}if(null===(e=i.data)||void 0===e?void 0:e.exists){Z(e=>({...e,email:"An account with this email address already exists. Please log in or use a different email."})),x.ZP.error("Email already registered"),C(!1);return}if(null===(t=n.data)||void 0===t?void 0:t.exists){Z(e=>({...e,phoneNumber:"This phone number is already registered. Please use a different number."})),x.ZP.error("Phone number already registered"),C(!1);return}D(2)}catch(e){console.error("Validation error:",e),x.ZP.error("Failed to validate information")}finally{C(!1)}}},T=async e=>{if(e.preventDefault(),F()){C(!0);try{let e=r.phoneNumber.replace(/\D/g,""),s="".concat(E).concat(e);console.log("Signing up with:",{email:r.email.toLowerCase(),phone:s});let{data:a,error:i}=await l.OQ.auth.signUp({email:r.email.toLowerCase(),password:r.password,options:{data:{first_name:r.firstName,last_name:r.lastName,phone_number:s,organization_name:r.organizationName,industry:r.industry},emailRedirectTo:"".concat(window.location.origin,"/auth/callback")}});if(i)throw i;if(a.user){console.log("✅ User created successfully:",a.user.email),console.log("\uD83C\uDFE2 Creating organization...");let{data:e,error:i}=await l.OQ.from("organizations").insert({name:r.organizationName,industry:r.industry,default_country_code:"+1"}).select().single();if(i)throw console.error("❌ Organization creation error:",i),i;console.log("✅ Organization created:",e),console.log("\uD83D\uDCCB Updating user profile...");let{error:n}=await l.OQ.from("user_profiles").update({organization_id:e.id,phone_number:s,email_verified:!1,onboarding_completed:!0}).eq("id",a.user.id);if(n)throw console.error("❌ Profile update error:",n),n;console.log("✅ Profile updated successfully"),console.log("\uD83D\uDCB3 Creating subscription...");let{error:c}=await l.OQ.from("subscriptions").insert({organization_id:e.id,status:"trial",minutes_included:100,minutes_used:0});if(c)throw console.error("❌ Subscription creation error:",c),c;if(console.log("✅ Subscription created successfully"),(null==a?void 0:a.user)&&!a.session){z(!0);return}(null==a?void 0:a.session)&&(x.ZP.success("Account created successfully!"),t())}}catch(e){console.error("Signup error:",e),x.ZP.error(e.message||"Failed to create account")}finally{C(!1)}}},L=(e,t)=>{c(s=>({...s,[e]:t})),S[e]&&Z(t=>({...t,[e]:void 0}))};return(0,a.jsxs)("div",{className:"min-h-screen auth-bg flex items-center justify-center p-4",children:[(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"card rounded-3xl shadow-strong p-8 w-full max-w-md",children:[(0,a.jsxs)("div",{className:"text-center mb-8",children:[(0,a.jsx)(n.E.div,{initial:{scale:.9},animate:{scale:1},className:"w-16 h-16 bg-primary-600 rounded-2xl flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)(h.Z,{className:"w-8 h-8 text-white"})}),(0,a.jsx)("h1",{className:"text-2xl font-bold text-text-primary",children:"Create Your Account"}),(0,a.jsx)("p",{className:"text-text-secondary mt-2",children:"Join the AI voice agent revolution"}),!1]}),(0,a.jsx)("div",{className:"flex items-center justify-center mb-8",children:(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ".concat(k>=1?"bg-primary-600 text-white":"bg-neutral-600 text-neutral-400"),children:"1"}),(0,a.jsx)("div",{className:"w-16 h-1 rounded ".concat(k>=2?"bg-primary-600":"bg-neutral-600")}),(0,a.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ".concat(k>=2?"bg-primary-600 text-white":"bg-neutral-600 text-neutral-400"),children:"2"})]})}),(0,a.jsx)("form",{onSubmit:1===k?e=>{e.preventDefault(),O()}:T,children:1===k?(0,a.jsxs)(n.E.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},className:"space-y-6",children:[(0,a.jsx)("h2",{className:"text-lg font-bold text-center text-text-primary",children:"Personal Information"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"First Name"}),(0,a.jsx)("input",{type:"text",value:r.firstName,onChange:e=>L("firstName",e.target.value),className:"input-field ".concat(S.firstName?"border-error-500":""),placeholder:"John"}),S.firstName&&(0,a.jsx)("p",{className:"text-error-600 text-sm mt-1",children:S.firstName})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Last Name"}),(0,a.jsx)("input",{type:"text",value:r.lastName,onChange:e=>L("lastName",e.target.value),className:"input-field ".concat(S.lastName?"border-error-500":""),placeholder:"Doe"}),S.lastName&&(0,a.jsx)("p",{className:"text-error-600 text-sm mt-1",children:S.lastName})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Email Address"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(o.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-text-secondary"}),(0,a.jsx)("input",{type:"email",value:r.email,onChange:e=>L("email",e.target.value),className:"input-field pl-10 ".concat(S.email?"border-error-500":""),placeholder:"john@example.com"})]}),S.email&&(0,a.jsx)("p",{className:"text-error-600 text-sm mt-1",children:S.email})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Phone Number"}),(0,a.jsx)(w,{value:r.phoneNumber,onChange:(e,t)=>{L("phoneNumber",e),A(t)},error:S.phoneNumber,placeholder:"Enter phone number",defaultCountryCode:"+1"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Password"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:u?"text":"password",value:r.password,onChange:e=>L("password",e.target.value),className:"input-field pr-10 ".concat(S.password?"border-error-500":""),placeholder:"••••••••"}),(0,a.jsx)("button",{type:"button",onClick:()=>f(!u),className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:u?(0,a.jsx)(d.Z,{className:"w-5 h-5 text-text-secondary"}):(0,a.jsx)(m.Z,{className:"w-5 h-5 text-text-secondary"})})]}),S.password&&(0,a.jsx)("p",{className:"text-error-600 text-sm mt-1",children:S.password})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Confirm Password"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:j?"text":"password",value:r.confirmPassword,onChange:e=>L("confirmPassword",e.target.value),className:"input-field pr-10 ".concat(S.confirmPassword?"border-error-500":""),placeholder:"••••••••"}),(0,a.jsx)("button",{type:"button",onClick:()=>v(!j),className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:j?(0,a.jsx)(d.Z,{className:"w-5 h-5 text-text-secondary"}):(0,a.jsx)(m.Z,{className:"w-5 h-5 text-text-secondary"})})]}),S.confirmPassword&&(0,a.jsx)("p",{className:"text-error-600 text-sm mt-1",children:S.confirmPassword})]}),(0,a.jsx)("button",{type:"button",onClick:O,disabled:N,className:"w-full btn-primary disabled:opacity-50 disabled:cursor-not-allowed",children:N?"Checking...":"Continue to Organization"})]}):(0,a.jsxs)(n.E.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},className:"space-y-6",children:[(0,a.jsx)("h2",{className:"text-lg font-bold text-center text-text-primary",children:"Organization Details"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Organization Name"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(g.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-text-secondary"}),(0,a.jsx)("input",{type:"text",value:r.organizationName,onChange:e=>L("organizationName",e.target.value),className:"input-field pl-10 ".concat(S.organizationName?"border-error-500":""),placeholder:"Acme Corporation"})]}),S.organizationName&&(0,a.jsx)("p",{className:"text-error-600 text-sm mt-1",children:S.organizationName})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Industry"}),(0,a.jsxs)("select",{value:r.industry,onChange:e=>L("industry",e.target.value),className:"input-field ".concat(S.industry?"border-error-500":""),children:[(0,a.jsx)("option",{value:"",children:"Select your industry"}),(0,a.jsx)("option",{value:"Technology",children:"Technology"}),(0,a.jsx)("option",{value:"Healthcare",children:"Healthcare"}),(0,a.jsx)("option",{value:"Finance",children:"Finance"}),(0,a.jsx)("option",{value:"Retail",children:"Retail"}),(0,a.jsx)("option",{value:"Real Estate",children:"Real Estate"}),(0,a.jsx)("option",{value:"Education",children:"Education"}),(0,a.jsx)("option",{value:"Manufacturing",children:"Manufacturing"}),(0,a.jsx)("option",{value:"Hospitality",children:"Hospitality"}),(0,a.jsx)("option",{value:"Marketing",children:"Marketing"}),(0,a.jsx)("option",{value:"Consulting",children:"Consulting"}),(0,a.jsx)("option",{value:"Other",children:"Other"})]}),S.industry&&(0,a.jsx)("p",{className:"text-error-600 text-sm mt-1",children:S.industry})]}),(0,a.jsxs)("div",{className:"flex space-x-4",children:[(0,a.jsx)("button",{type:"button",onClick:()=>D(1),className:"flex-1 btn-secondary",children:"Back"}),(0,a.jsx)("button",{type:"submit",disabled:N,className:"flex-1 btn-primary",children:N?"Creating Account...":"Create Account"})]})]})}),(0,a.jsx)("div",{className:"text-center mt-6",children:(0,a.jsxs)("p",{className:"text-text-secondary",children:["Already have an account?"," ",(0,a.jsx)("button",{onClick:s,className:"text-primary-600 hover:text-primary-700 font-medium",children:"Sign in"})]})})]}),(0,a.jsx)(p.M,{children:P&&(0,a.jsx)(n.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:()=>{z(!1),window.history.pushState({},"","/auth"),window.dispatchEvent(new PopStateEvent("popstate"))},children:(0,a.jsxs)(n.E.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},onClick:e=>e.stopPropagation(),className:"bg-bg-secondary rounded-2xl shadow-2xl max-w-md w-full p-8 relative",children:[(0,a.jsx)("button",{onClick:()=>{z(!1),window.history.pushState({},"","/auth"),window.dispatchEvent(new PopStateEvent("popstate"))},className:"absolute top-4 right-4 text-text-tertiary hover:text-text-primary transition-colors",children:(0,a.jsx)(b.Z,{className:"w-6 h-6"})}),(0,a.jsx)("div",{className:"flex justify-center mb-6",children:(0,a.jsx)("div",{className:"w-20 h-20 bg-gradient-to-br from-primary-solid to-purple-600 rounded-full flex items-center justify-center shadow-lg",children:(0,a.jsx)(y.Z,{className:"w-12 h-12 text-white",strokeWidth:2.5})})}),(0,a.jsx)("h2",{className:"text-2xl font-bold text-text-primary text-center mb-6",children:"Confirm Your Signup"}),(0,a.jsx)("div",{className:"bg-bg-tertiary rounded-xl p-6 mb-6 border border-bg-tertiary",children:(0,a.jsxs)("div",{className:"flex items-start gap-3 mb-4",children:[(0,a.jsx)(o.Z,{className:"w-5 h-5 text-primary-solid flex-shrink-0 mt-0.5"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-text-primary text-base leading-relaxed mb-3 font-normal",children:"Please check your email inbox for the verification email."}),(0,a.jsxs)("p",{className:"text-text-secondary text-sm leading-relaxed font-normal",children:["If you do not see it in the next 5 minutes, be sure to check your ",(0,a.jsx)("span",{className:"font-semibold text-text-primary",children:"Spam folder"}),"."]})]})]})}),(0,a.jsxs)("div",{className:"bg-bg-primary rounded-xl p-4 mb-6 border border-bg-tertiary",children:[(0,a.jsx)("p",{className:"text-text-tertiary text-sm mb-1.5",children:"Email sent to:"}),(0,a.jsx)("p",{className:"text-text-primary font-semibold text-base",children:r.email})]}),(0,a.jsx)("button",{onClick:()=>{z(!1),window.history.pushState({},"","/auth"),window.dispatchEvent(new PopStateEvent("popstate"))},className:"w-full bg-gradient-to-r from-primary-solid to-purple-600 text-white font-bold py-3.5 px-6 rounded-xl hover:shadow-xl hover:scale-[1.02] transition-all duration-200",children:"Got it!"}),(0,a.jsx)("p",{className:"text-text-tertiary text-sm text-center mt-5",children:"After verifying your email, you can sign in to your account"})]})})})]})}var k=s(32660);function D(e){let{onBack:t}=e,[s,r]=(0,i.useState)(""),[c,d]=(0,i.useState)(!1),[m,u]=(0,i.useState)(!1),[p,h]=(0,i.useState)(""),g=e=>/\S+@\S+\.\S+/.test(e),b=async e=>{if(e.preventDefault(),!s.trim()){h("Email is required");return}if(!g(s)){h("Please enter a valid email address");return}d(!0),h("");try{let{error:e}=await l.OQ.auth.resetPasswordForEmail(s,{redirectTo:"".concat(window.location.origin,"/auth/reset-password")});if(e)throw e;u(!0),x.ZP.success("Password reset email sent!")}catch(e){console.error("Password reset error:",e),e.message.includes("rate limit")?h("Too many requests. Please wait a moment before trying again."):h(e.message||"Failed to send password reset email")}finally{d(!1)}},f=e=>{r(e),h("")};return m?(0,a.jsx)("div",{className:"min-h-screen auth-bg flex items-center justify-center p-4",children:(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"card rounded-3xl shadow-strong p-8 w-full max-w-md text-center",children:[(0,a.jsx)(n.E.div,{initial:{scale:.9},animate:{scale:1},className:"w-16 h-16 bg-success-600 rounded-2xl flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)(y.Z,{className:"w-8 h-8 text-white"})}),(0,a.jsx)("h1",{className:"text-2xl font-bold text-text-primary mb-2",children:"Check Your Email"}),(0,a.jsx)("p",{className:"text-text-secondary mb-4",children:"We've sent a password reset link to:"}),(0,a.jsx)("p",{className:"font-medium text-text-primary mb-6",children:s}),(0,a.jsxs)("div",{className:"card-light rounded-xl p-4 mb-6 text-left",children:[(0,a.jsx)("h3",{className:"font-medium text-text-primary mb-2",children:"Next Steps:"}),(0,a.jsxs)("ol",{className:"text-sm text-text-secondary space-y-1",children:[(0,a.jsx)("li",{children:"1. Check your email inbox"}),(0,a.jsx)("li",{children:"2. Click the reset password link"}),(0,a.jsx)("li",{children:"3. Create a new password"}),(0,a.jsx)("li",{children:"4. Sign in with your new password"})]})]}),(0,a.jsx)("button",{onClick:t,className:"w-full btn-primary",children:"Back to Sign In"}),(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsxs)("p",{className:"text-sm text-text-secondary",children:["Didn't receive the email? Check your spam folder or"," ",(0,a.jsx)("button",{onClick:()=>{u(!1),r("")},className:"text-primary-600 hover:text-primary-700 font-medium",children:"try again"})]})})]})}):(0,a.jsx)("div",{className:"min-h-screen auth-bg flex items-center justify-center p-4",children:(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"card rounded-3xl shadow-strong p-8 w-full max-w-md",children:[(0,a.jsxs)("div",{className:"text-center mb-8",children:[(0,a.jsx)(n.E.div,{initial:{scale:.9},animate:{scale:1},className:"w-16 h-16 bg-warning-600 rounded-2xl flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)(o.Z,{className:"w-8 h-8 text-white"})}),(0,a.jsx)("h1",{className:"text-2xl font-bold text-text-primary",children:"Reset Your Password"}),(0,a.jsx)("p",{className:"text-text-secondary mt-2",children:"Enter your email address and we'll send you a link to reset your password"})]}),(0,a.jsxs)("form",{onSubmit:b,className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Email Address"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(o.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-text-secondary"}),(0,a.jsx)("input",{type:"email",value:s,onChange:e=>f(e.target.value),className:"input-field pl-10 ".concat(p?"border-error-500":""),placeholder:"john@example.com",autoComplete:"email"})]}),p&&(0,a.jsx)(n.E.p,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"text-error-600 text-sm mt-1",children:p})]}),(0,a.jsx)("button",{type:"submit",disabled:c,className:"w-full btn-primary",children:c?"Sending Reset Link...":"Send Reset Link"})]}),(0,a.jsx)("div",{className:"text-center mt-6",children:(0,a.jsxs)("button",{onClick:t,className:"flex items-center justify-center text-text-secondary hover:text-text-primary mx-auto",children:[(0,a.jsx)(k.Z,{className:"w-4 h-4 mr-1"}),"Back to Sign In"]})}),(0,a.jsxs)(n.E.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},className:"mt-6 p-4 card-light rounded-xl",children:[(0,a.jsx)("h3",{className:"font-medium text-text-primary mb-1",children:"Security Note"}),(0,a.jsx)("p",{className:"text-sm text-text-secondary",children:"For your security, the password reset link will expire in 1 hour. If you don't see the email, check your spam folder."})]})]})})}var S=s(82431),Z=s(30401);function E(e){let{type:t,contact:s,onSuccess:r,onBack:c}=e,[d,m]=(0,i.useState)(""),[u,p]=(0,i.useState)(!1),[h,g]=(0,i.useState)(!1),[b,y]=(0,i.useState)(0),[f,v]=(0,i.useState)("");(0,i.useEffect)(()=>{N()},[]),(0,i.useEffect)(()=>{if(b>0){let e=setTimeout(()=>y(b-1),1e3);return()=>clearTimeout(e)}},[b]);let N=async()=>{try{g(!0),v(""),await (0,l.k_)("twilio-verify",{method:"POST",body:JSON.stringify({action:"send",type:t,contact:s})}),x.ZP.success("Verification code sent to your ".concat(t)),y(60)}catch(e){console.error("Error sending verification code:",e),x.ZP.error("Failed to send verification code: ".concat(e.message)),v(e.message)}finally{g(!1)}},w=async()=>{if(6!==d.length){v("Please enter a 6-digit code");return}try{p(!0),v(""),(await (0,l.k_)("twilio-verify",{method:"POST",body:JSON.stringify({action:"verify",type:t,contact:s,code:d})})).verified?(x.ZP.success("".concat(t," verified successfully!")),r()):v("Invalid verification code")}catch(e){console.error("Error verifying code:",e),v(e.message||"Verification failed")}finally{p(!1)}},_=e=>{let t=e.replace(/\D/g,"").slice(0,6);m(t),v(""),6===t.length&&setTimeout(()=>w(),100)};return(0,a.jsx)("div",{className:"min-h-screen auth-bg flex items-center justify-center p-4",children:(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"card rounded-3xl shadow-strong p-8 w-full max-w-md",children:[(0,a.jsxs)("div",{className:"text-center mb-8",children:[(0,a.jsx)(n.E.div,{initial:{scale:.9},animate:{scale:1},className:"w-16 h-16 bg-primary-600 rounded-2xl flex items-center justify-center mx-auto mb-4",children:"phone"===t?(0,a.jsx)(j.Z,{className:"w-8 h-8 text-white"}):(0,a.jsx)(o.Z,{className:"w-8 h-8 text-white"})}),(0,a.jsxs)("h1",{className:"text-2xl font-bold text-text-primary",children:["Verify Your ","phone"===t?"Phone Number":"Email"]}),(0,a.jsx)("p",{className:"text-text-secondary mt-2",children:"We've sent a 6-digit code to"}),(0,a.jsx)("p",{className:"font-medium text-text-primary mt-1",children:s})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-4 text-center",children:"Enter Verification Code"}),(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsx)("input",{type:"text",value:d,onChange:e=>_(e.target.value),className:"text-center text-2xl font-mono tracking-widest w-48 py-4 border-2 rounded-xl focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all duration-200 bg-bg-secondary text-text-primary ".concat(f?"border-error-500":"border-border-subtle"),placeholder:"123456",maxLength:6,autoComplete:"one-time-code"})}),f&&(0,a.jsx)(n.E.p,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"text-error-600 text-sm mt-2 text-center",children:f})]}),(0,a.jsx)("button",{onClick:w,disabled:u||6!==d.length,className:"w-full btn-primary mb-4 disabled:opacity-50 disabled:cursor-not-allowed",children:u?(0,a.jsxs)("div",{className:"flex items-center justify-center",children:[(0,a.jsx)(S.Z,{className:"w-4 h-4 mr-2 animate-spin"}),"Verifying..."]}):(0,a.jsxs)("div",{className:"flex items-center justify-center",children:[(0,a.jsx)(Z.Z,{className:"w-4 h-4 mr-2"}),"Verify Code"]})}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-text-secondary text-sm mb-2",children:"Didn't receive the code?"}),(0,a.jsx)("button",{onClick:N,disabled:h||b>0,className:"text-primary-600 hover:text-primary-700 font-medium text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:h?(0,a.jsxs)("div",{className:"flex items-center justify-center",children:[(0,a.jsx)(S.Z,{className:"w-4 h-4 mr-1 animate-spin"}),"Sending..."]}):b>0?"Resend in ".concat(b,"s"):"Resend Code"})]}),c&&(0,a.jsx)("div",{className:"text-center mt-6",children:(0,a.jsx)("button",{onClick:c,className:"text-text-secondary hover:text-text-primary text-sm",children:"← Back"})}),(0,a.jsxs)(n.E.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},className:"mt-6 p-4 bg-bg-secondary rounded-xl border border-border-subtle",children:[(0,a.jsx)("h3",{className:"font-medium text-text-primary mb-1",children:"Having trouble?"}),(0,a.jsx)("p",{className:"text-sm text-text-secondary",children:"phone"===t?"Make sure your phone can receive SMS messages and check your spam folder.":"Check your email inbox and spam folder for the verification code."}),(0,a.jsxs)("p",{className:"text-sm text-text-secondary mt-2",children:["Contact us at"," ",(0,a.jsx)("a",{href:"mailto:contact@karmaloop.ai",className:"text-primary-600 hover:text-primary-700",children:"contact@karmaloop.ai"})," ","if you need help."]})]})]})})}let A=(0,s(57557).eI)("https://nlxwkbmcfejflujtzmky.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5seHdrYm1jZmVqZmx1anR6bWt5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM3MDEwNjksImV4cCI6MjA3OTI3NzA2OX0.OMRdstZ9Smn7MSKiYZ0mzf-oCEyCGSXKsESh_Rvzr30",{auth:{autoRefreshToken:!1,persistSession:!1,detectSessionInUrl:!1,flowType:"pkce"}});var P=s(66337);let z=["welcome123","12345678","00000000","password"];function I(e){let{onBackToLogin:t}=e,[s,r]=(0,i.useState)(""),[l,c]=(0,i.useState)(""),[o,u]=(0,i.useState)(!1),[p,h]=(0,i.useState)(!1),[g,b]=(0,i.useState)(!1),[f,j]=(0,i.useState)(null),[v,N]=(0,i.useState)(!0),[w,_]=(0,i.useState)(!1);(0,i.useEffect)(()=>{(async()=>{try{let e=new URLSearchParams(window.location.search),t=e.get("token"),s=e.get("type");if(t&&"recovery"===s){let{data:e,error:s}=await A.auth.verifyOtp({token_hash:t,type:"recovery"});if(s)throw s;if(e.session){_(!0),N(!1);return}}j("Invalid or expired password reset link. Please request a new one."),N(!1)}catch(e){console.error("Error verifying reset token:",e);try{let{data:e}=await A.auth.getSession();if(e.session){_(!0),N(!1);return}}catch(e){}j("Something went wrong verifying your reset link. Please request a new one."),N(!1)}})()},[]);let C=async e=>{if(e.preventDefault(),!s||!l){j("Please fill in both password fields.");return}if(s!==l){j("Passwords do not match.");return}if(s.length<8||s.length>12){j("Password must be between 8 and 12 characters long.");return}if(z.includes(s.toLowerCase())){j("This password is too common. Please choose a stronger password.");return}b(!0),j(null);try{let{error:e}=await A.auth.updateUser({password:s});if(e)throw e;await A.auth.signOut(),x.ZP.success("Password updated successfully. Please log in with your new password."),window.location.href="/auth"}catch(e){console.error("Error updating password:",e),j(e.message||"Failed to update password. Please try again.")}finally{b(!1)}};return v?(0,a.jsx)("div",{className:"min-h-screen auth-bg flex items-center justify-center p-4",children:(0,a.jsx)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"card rounded-3xl shadow-strong p-8 w-full max-w-md text-center",children:(0,a.jsx)("p",{className:"text-text-secondary",children:"Verifying your reset link..."})})}):w?(0,a.jsx)("div",{className:"min-h-screen auth-bg flex items-center justify-center p-4",children:(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"card rounded-3xl shadow-strong p-8 w-full max-w-md",children:[(0,a.jsxs)("div",{className:"text-center mb-8",children:[(0,a.jsx)(n.E.div,{initial:{scale:.9},animate:{scale:1},className:"w-16 h-16 bg-primary-600 rounded-2xl flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)(P.Z,{className:"w-8 h-8 text-white"})}),(0,a.jsx)("h1",{className:"text-2xl font-bold text-text-primary",children:"Set a New Password"}),(0,a.jsx)("p",{className:"text-text-secondary mt-2",children:"Enter a strong, unique password to secure your account."})]}),(0,a.jsxs)("form",{onSubmit:C,className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"New Password"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(P.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-text-secondary"}),(0,a.jsx)("input",{type:o?"text":"password",value:s,onChange:e=>r(e.target.value),className:"input-field pl-10 pr-10 ".concat(f?"border-error-500":""),placeholder:"Enter new password",autoComplete:"new-password"}),(0,a.jsx)("button",{type:"button",onClick:()=>u(!o),className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:o?(0,a.jsx)(d.Z,{className:"w-5 h-5 text-text-secondary"}):(0,a.jsx)(m.Z,{className:"w-5 h-5 text-text-secondary"})})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Confirm New Password"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(P.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-text-secondary"}),(0,a.jsx)("input",{type:p?"text":"password",value:l,onChange:e=>c(e.target.value),className:"input-field pl-10 pr-10 ".concat(f?"border-error-500":""),placeholder:"Re-enter new password",autoComplete:"new-password"}),(0,a.jsx)("button",{type:"button",onClick:()=>h(!p),className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:p?(0,a.jsx)(d.Z,{className:"w-5 h-5 text-text-secondary"}):(0,a.jsx)(m.Z,{className:"w-5 h-5 text-text-secondary"})})]})]}),f&&(0,a.jsx)(n.E.p,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"text-error-600 text-sm mt-1",children:f}),(0,a.jsx)("button",{type:"submit",disabled:g,className:"w-full btn-primary",children:g?"Updating Password...":"Update Password"})]}),(0,a.jsx)("div",{className:"text-center mt-6",children:(0,a.jsxs)("button",{onClick:()=>{window.location.href="/auth"},className:"flex items-center justify-center text-text-secondary hover:text-text-primary mx-auto",children:[(0,a.jsx)(k.Z,{className:"w-4 h-4 mr-1"}),"Back to Sign In"]})})]})}):(0,a.jsx)("div",{className:"min-h-screen auth-bg flex items-center justify-center p-4",children:(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"card rounded-3xl shadow-strong p-8 w-full max-w-md text-center",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-red-100 rounded-2xl flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)(y.Z,{className:"w-8 h-8 text-red-500"})}),(0,a.jsx)("h1",{className:"text-2xl font-bold text-text-primary mb-2",children:"Link Invalid or Expired"}),(0,a.jsx)("p",{className:"text-text-secondary mb-6",children:f||"Your password reset link is invalid or has expired. Please request a new one from the forgot password page."}),(0,a.jsx)("button",{onClick:()=>{window.location.href="/auth"},className:"w-full btn-primary",children:"Back to Sign In"})]})})}var F=s(45131);function O(e){let{onAuthSuccess:t}=e,[s,c]=(0,i.useState)("login"),[d,m]=(0,i.useState)(""),[h,g]=(0,i.useState)(null),[b,f]=(0,i.useState)(""),[j,v]=(0,i.useState)(!1),[N,w]=(0,i.useState)(""),{actions:_}=(0,r.q)();(0,i.useEffect)(()=>{let e=new URLSearchParams(window.location.search),t=window.location.hash;if(window.location.pathname.replace(/\/+$/,"").endsWith("/auth/reset-password")){c("reset-password");return}let s=e.get("error"),a=e.get("error_code"),r=e.get("error_description"),i=t.includes("access_token");s||a?(console.log("❌ Verification error detected:",{error:s,errorCode:a,errorDescription:r}),"otp_expired"===a||(null==r?void 0:r.includes("expired"))?(g("expired"),f("Your verification link has expired. Please request a new one.")):"access_denied"===s?(g("error"),f(r?decodeURIComponent(r):"Email verification failed. Please try again.")):(g("error"),f("Verification failed. Please try again or contact support.")),window.history.replaceState({},"",window.location.pathname)):i&&(console.log("✅ Verification success detected"),g("success"),x.ZP.success("Email verified successfully! You can now sign in."),window.history.replaceState({},"",window.location.pathname))},[]);let k=async()=>{if(!N){x.ZP.error("Please enter your email address first");return}v(!0);try{let{error:e}=await l.OQ.auth.resend({type:"signup",email:N,options:{emailRedirectTo:"".concat(window.location.origin,"/auth")}});if(e)throw e;x.ZP.success("Verification email sent! Please check your inbox."),g(null)}catch(e){console.error("Error resending verification:",e),x.ZP.error(e.message||"Failed to resend verification email")}finally{v(!1)}},S=async()=>{console.log("\uD83D\uDE80 AuthWrapper handleAuthSuccess called"),console.log("✅ AuthWrapper delegating to auth state change handler"),t()},Z=()=>{c("login")},A=()=>{S()},P=()=>h?(0,a.jsx)(p.M,{children:(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"mb-6",children:["success"===h&&(0,a.jsxs)("div",{className:"bg-success-50 border border-success-200 rounded-xl p-4 flex items-start",children:[(0,a.jsx)(y.Z,{className:"w-5 h-5 text-success-600 mt-0.5 mr-3 flex-shrink-0"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:"font-medium text-success-900 mb-1",children:"Email Verified Successfully!"}),(0,a.jsx)("p",{className:"text-sm text-success-700",children:"Your email has been verified. You can now sign in to access your account."})]})]}),("error"===h||"expired"===h)&&(0,a.jsxs)("div",{className:"bg-error-50 border border-error-200 rounded-xl p-4",children:[(0,a.jsxs)("div",{className:"flex items-start mb-3",children:[(0,a.jsx)(F.Z,{className:"w-5 h-5 text-error-600 mt-0.5 mr-3 flex-shrink-0"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:"font-medium text-error-900 mb-1",children:"expired"===h?"Verification Link Expired":"Verification Failed"}),(0,a.jsx)("p",{className:"text-sm text-error-700",children:b})]})]}),(0,a.jsxs)("div",{className:"ml-8",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("input",{type:"email",value:N,onChange:e=>w(e.target.value),placeholder:"Enter your email",className:"input-field flex-1 text-sm",disabled:j}),(0,a.jsxs)("button",{onClick:k,disabled:j||!N,className:"btn-primary text-sm whitespace-nowrap disabled:opacity-50",children:[(0,a.jsx)(o.Z,{className:"w-4 h-4 mr-1.5"}),j?"Sending...":"Resend Email"]})]}),(0,a.jsx)("p",{className:"text-xs text-error-600 mt-2",children:'Enter the email address you used to sign up, then click "Resend Email" to receive a new verification link.'})]})]})]})}):null;return(()=>{switch(s){case"login":return(0,a.jsxs)("div",{children:[P(),(0,a.jsx)(u,{onSuccess:S,onSwitchToSignup:()=>c("signup"),onForgotPassword:()=>c("forgot-password")})]});case"signup":return(0,a.jsxs)("div",{children:[P(),(0,a.jsx)(C,{onSuccess:Z,onSwitchToLogin:()=>c("login")})]});case"forgot-password":return(0,a.jsx)(D,{onBack:()=>c("login")});case"reset-password":return(0,a.jsx)(I,{onBackToLogin:()=>c("login")});case"verify-phone":return(0,a.jsx)(E,{type:"phone",contact:d,onSuccess:A,onBack:()=>c("login")});case"verify-email":return(0,a.jsx)(E,{type:"email",contact:d,onSuccess:A,onBack:()=>c("login")});default:return(0,a.jsx)(u,{onSuccess:S,onSwitchToSignup:()=>c("signup"),onForgotPassword:()=>c("forgot-password")})}})()}var T=s(82222),L=s(95805),M=s(46221),R=s(53417),U=s(82023),q=s(76858),Q=s(11239);function V(e){let{onGetStarted:t}=e,s=[{icon:T.Z,title:"Multi-Channel Support",description:"Create intelligent AI agents that handle customer support across voice, email, and more"},{icon:j.Z,title:"Voice & Email",description:"Handle incoming support requests via phone calls and email seamlessly"},{icon:L.Z,title:"CRM Integration",description:"Automatically log interactions, update customer records, and track conversations"},{icon:M.Z,title:"Analytics & Reports",description:"Get insights into support performance, response times, and customer satisfaction"}],r=[{number:1,title:"Configure Your Agent",description:"Set up your support objective, target audience, and channel preferences"},{number:2,title:"Connect Channels",description:"Connect your phone number, email, and other support channels"},{number:3,title:"Go Live",description:"Your agent starts handling customer support across all channels"}];return(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-primary-50 via-white to-secondary-50",children:(0,a.jsxs)("div",{className:"max-w-6xl mx-auto px-4 py-12",children:[(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center mb-16",children:[(0,a.jsx)(n.E.div,{initial:{scale:.9},animate:{scale:1},transition:{delay:.1},className:"w-20 h-20 bg-primary-600 rounded-3xl flex items-center justify-center mx-auto mb-6",children:(0,a.jsx)(R.Z,{className:"w-10 h-10 text-white"})}),(0,a.jsxs)(n.E.h1,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"text-4xl md:text-5xl font-bold text-neutral-900 mb-4",children:["Welcome to"," ",(0,a.jsx)("span",{className:"bg-gradient-to-r from-primary-600 to-secondary-600 bg-clip-text text-transparent",children:"Kai"})]}),(0,a.jsx)(n.E.p,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"text-xl text-neutral-600 mb-8 max-w-2xl mx-auto",children:"The Shopify for Support. Provision and manage multi-channel AI agents that handle customer support across voice, email, and more—with the intelligence and personality of your best team members."}),(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"flex items-center justify-center space-x-2 mb-8",children:[(0,a.jsx)(U.Z,{className:"w-5 h-5 text-warning-500"}),(0,a.jsx)("span",{className:"text-sm font-medium text-neutral-700",children:"14-day free trial • 100 minutes included • No credit card required"})]}),(0,a.jsxs)(n.E.button,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},onClick:e=>{e.preventDefault(),console.log("\uD83D\uDE80 Set Up First Agent clicked"),t()},type:"button",className:"btn-primary text-lg px-8 py-4 group",children:["Set Up Your First Agent",(0,a.jsx)(q.Z,{className:"w-5 h-5 ml-2 group-hover:translate-x-1 transition-transform"})]})]}),(0,a.jsx)(n.E.div,{initial:{opacity:0,y:40},animate:{opacity:1,y:0},transition:{delay:.6},className:"grid md:grid-cols-2 lg:grid-cols-4 gap-6 mb-16",children:s.map((e,t)=>{let s=e.icon;return(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.7+.1*t},className:"card text-center",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-primary-100 rounded-xl flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)(s,{className:"w-6 h-6 text-primary-600"})}),(0,a.jsx)("h3",{className:"text-lg font-bold text-neutral-900 mb-2",children:e.title}),(0,a.jsx)("p",{className:"text-neutral-600 text-sm",children:e.description})]},e.title)})}),(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:40},animate:{opacity:1,y:0},transition:{delay:.8},className:"text-center mb-16",children:[(0,a.jsx)("h2",{className:"text-3xl font-bold text-neutral-900 mb-4",children:"Get Started in 3 Simple Steps"}),(0,a.jsx)("p",{className:"text-neutral-600 mb-12 max-w-2xl mx-auto",children:"Setting up your multi-channel AI support agent is quick and easy. You'll be handling customer requests in minutes."}),(0,a.jsx)("div",{className:"grid md:grid-cols-3 gap-8",children:r.map((e,t)=>(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.9+.1*t},className:"relative",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-primary-600 rounded-2xl flex items-center justify-center mx-auto mb-6",children:(0,a.jsx)("span",{className:"text-2xl font-bold text-white",children:e.number})}),(0,a.jsx)("h3",{className:"text-xl font-bold text-neutral-900 mb-3",children:e.title}),(0,a.jsx)("p",{className:"text-neutral-600",children:e.description}),t<r.length-1&&(0,a.jsx)("div",{className:"hidden md:block absolute top-8 left-full w-full h-0.5 bg-gradient-to-r from-primary-300 to-transparent -translate-x-8"})]},e.number))})]}),(0,a.jsx)(n.E.div,{initial:{opacity:0,y:40},animate:{opacity:1,y:0},transition:{delay:1},className:"card bg-gradient-to-r from-primary-600 to-secondary-600 text-white text-center",children:(0,a.jsxs)("div",{className:"max-w-3xl mx-auto",children:[(0,a.jsx)(Q.Z,{className:"w-12 h-12 mx-auto mb-6 text-warning-300"}),(0,a.jsx)("h2",{className:"text-3xl font-bold mb-4",children:"Why Choose Kai?"}),(0,a.jsx)("p",{className:"text-primary-100 mb-8 text-lg",children:"Our AI support agents are trained specifically for customer support across all channels, delivering intelligent, personalized assistance that delights your customers."}),(0,a.jsxs)("div",{className:"grid md:grid-cols-3 gap-6 text-left",children:[(0,a.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,a.jsx)(y.Z,{className:"w-6 h-6 text-success-300 mt-1 flex-shrink-0"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium mb-1",children:"24/7 Availability"}),(0,a.jsx)("p",{className:"text-primary-100 text-sm",children:"Never miss a customer inquiry on any channel"})]})]}),(0,a.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,a.jsx)(y.Z,{className:"w-6 h-6 text-success-300 mt-1 flex-shrink-0"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium mb-1",children:"Instant Responses"}),(0,a.jsx)("p",{className:"text-primary-100 text-sm",children:"No wait times across voice, email, and more"})]})]}),(0,a.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,a.jsx)(y.Z,{className:"w-6 h-6 text-success-300 mt-1 flex-shrink-0"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium mb-1",children:"Cost Effective"}),(0,a.jsx)("p",{className:"text-primary-100 text-sm",children:"Fraction of hiring a support team"})]})]})]})]})})]})})}var H=s(58896),B=s(25846),K=s(15001),J=s(22252),Y=s(47692);let G=[{id:"Savannah",name:"Savannah",accent:"American",provider:"vapi",providerVoiceId:"Savannah",description:"Professional, warm, and confident voice perfect for sales and customer service"},{id:"Elliot",name:"Elliot",accent:"American",provider:"vapi",providerVoiceId:"Elliot",description:"Authoritative and trustworthy voice ideal for technical and business discussions"},{id:"KatieX",name:"Katie X",accent:"British",provider:"elevenlabs",providerVoiceId:"MzqUf1HbJ8UmQ0wUsx2p",description:"Call Center English Female - Professional British voice with warm, friendly tone"},{id:"James",name:"James",accent:"British",provider:"elevenlabs",providerVoiceId:"lUTamkMw7gOzZbFIwmq4",description:"Professional British Male - Confident British voice perfect for business and professional settings"},{id:"Clara",name:"Clara",accent:"American",provider:"elevenlabs",providerVoiceId:"ZIlrSGI4jZqobxRKprJz",description:"American Customer Care Agent - Friendly and approachable American voice ideal for customer service"},{id:"Brad",name:"Hey Its Brad",accent:"American",provider:"elevenlabs",providerVoiceId:"f5HLTX707KIM4SzJYzSz",description:"Happy To Help - Professional American voice with clear articulation"},{id:"Emma",name:"Emma",accent:"Australian",provider:"elevenlabs",providerVoiceId:"56bWURjYFHyYyVf490Dp",description:"Warm and friendly Australian voice perfect for casual and professional conversations"},{id:"Paul",name:"Paul",accent:"Australian",provider:"elevenlabs",providerVoiceId:"WLKp2jV6nrS8aMkPPDRO",description:"Australian Professional Presenter - Energetic Australian voice great for engaging conversations"},{id:"Anushri",name:"Anushri",accent:"Indian",provider:"elevenlabs",providerVoiceId:"zFLlkq72ysbq1TWC0Mlx",description:"Natural Young Indian Voice - Clear Indian English voice with professional and friendly tone"},{id:"Raju",name:"Raju",accent:"Indian",provider:"elevenlabs",providerVoiceId:"3gsg3cxXyFLcGIfNbM6C",description:"Relatable Indian Voice - Professional Indian English voice ideal for business communications"},{id:"RiyaRao",name:"Riya Rao",accent:"Hindi",provider:"elevenlabs",providerVoiceId:"mfMM3ijQgz8QtMeKifko",description:"Hindi Customer Care - Natural Hindi voice with clear pronunciation"},{id:"AakashAryan",name:"Aakash Aryan",accent:"Hindi",provider:"elevenlabs",providerVoiceId:"N2al4jd45e882svx17SU",description:"Famous Hindi Customer Care - Professional Hindi voice perfect for business and customer service"}];function W(e){let t=G.find(t=>t.id===e);return t?"".concat(t.name," (").concat(t.accent,")"):e}function X(e){let{onComplete:t,onBack:s,onLogout:c}=e,{state:o}=(0,r.q)(),[d,m]=(0,i.useState)(1),[u,h]=(0,i.useState)(!1),[g,b]=(0,i.useState)(!1),[f,j]=(0,i.useState)(!1),[v,N]=(0,i.useState)([{id:"phone",title:"Configuring support channels",status:"pending"},{id:"agent",title:"Creating AI agent",status:"pending"},{id:"setup",title:"Configuring channel settings",status:"pending"},{id:"deploy",title:"Deploying to production",status:"pending"}]),[w,_]=(0,i.useState)({name:"",description:"",voiceId:"Savannah",businessObjective:"",targetAudience:"",keyPainPoints:"",valuePropositon:"",callToAction:"",firstMessage:"Hi! This is your AI assistant. How can I help you today?",transcriberLanguage:"en"}),[C,D]=(0,i.useState)({}),Z=[{id:1,title:"Agent Identity",description:"Give your agent a name and personality",icon:T.Z},{id:2,title:"Business Setup",description:"Define your business objective and audience",icon:H.Z},{id:3,title:"Value Proposition",description:"Explain what makes you unique",icon:B.Z}],E=(e,t,s)=>{N(a=>a.map(a=>a.id===e?{...a,status:t,error:s}:a))},A=e=>{let t={};switch(e){case 1:w.name.trim()||(t.name="Agent name is required");break;case 2:w.businessObjective.trim()||(t.businessObjective="Business objective is required"),w.targetAudience.trim()||(t.targetAudience="Target audience is required");break;case 3:w.keyPainPoints.trim()||(t.keyPainPoints="Key pain points are required"),w.valuePropositon.trim()||(t.valuePropositon="Value proposition is required"),w.callToAction.trim()||(t.callToAction="Call to action is required")}return D(t),0===Object.keys(t).length},P=()=>{j(!1)},z=async()=>{let e={...w,voiceId:"Savannah",transcriberLanguage:"en"};if(A(3)){h(!0),b(!0),N(e=>e.map(e=>({...e,status:"pending",error:void 0})));try{var s,a;let r;let i=(null===(s=o.subscription)||void 0===s?void 0:s.status)==="trial";if(i){E("phone","loading");let{data:e,error:t}=await l.OQ.from("phone_numbers").select("id, phone_number").eq("twilio_sid","PN3e8b9b28efe3ca169f3db5d253c3af46").eq("is_active",!0).single();if(t||!e)throw Error("Shared trial phone number not found. Please contact support.");r=e.id,E("phone","completed"),console.log("Using shared trial phone number:",e.phone_number)}else{E("phone","loading");let e=(await Promise.race([(0,l.k_)("acquire-phone-number",{method:"POST",body:JSON.stringify({action:"search"})}),new Promise((e,t)=>setTimeout(()=>t(Error("Phone number search timed out. Please try again.")),3e4))])).availableNumbers;if(!e||0===e.length)throw Error("No phone numbers available in your area. Please contact support.");r=(await Promise.race([(0,l.k_)("acquire-phone-number",{method:"POST",body:JSON.stringify({action:"purchase",phoneNumberSid:e[0].phoneNumber})}),new Promise((e,t)=>setTimeout(()=>t(Error("Phone number purchase timed out. Please try again.")),3e4))])).phoneNumber.id,E("phone","completed")}E("agent","loading");let n=await Promise.race([(0,l.k_)("create-agent",{method:"POST",body:JSON.stringify({name:e.name,description:e.description,voiceId:e.voiceId,businessObjective:e.businessObjective,targetAudience:e.targetAudience,keyPainPoints:e.keyPainPoints,valuePropositon:e.valuePropositon,callToAction:e.callToAction,firstMessage:e.firstMessage,phoneNumberId:r,transcriberLanguage:e.transcriberLanguage})}),new Promise((e,t)=>setTimeout(()=>t(Error("Agent creation timed out. Please try again.")),45e3))]);E("agent","completed"),E("setup","loading"),await new Promise(e=>setTimeout(e,1500)),E("setup","completed"),E("deploy","loading"),await new Promise(e=>setTimeout(e,1e3)),E("deploy","completed"),i&&(null===(a=n.agent)||void 0===a?void 0:a.agent_code)?x.ZP.success("Agent created! Your agent code is: ".concat(n.agent.agent_code),{duration:8e3}):x.ZP.success("Your AI support agent is now live!"),setTimeout(()=>{t()},1500)}catch(t){console.error("Error creating agent:",t);let e=v.find(e=>"loading"===e.status);e&&E(e.id,"error",t.message),x.ZP.error(t.message||"Failed to create agent"),h(!1)}}},I=(e,t)=>{_(s=>{let a={...s,[e]:t};if("name"===e&&(a.firstMessage=t.trim()?"Hi! This is ".concat(t,". How can I help you today?"):"Hi! This is your AI assistant. How can I help you today?"),"voiceId"===e){let e=G.find(e=>e.id===t);if((null==e?void 0:e.accent)==="Hindi"){let e=/[\u0900-\u097F]/.test(s.firstMessage);if(s.firstMessage&&!e&&/^[a-z\s.,!?'-]+$/i.test(s.firstMessage.trim())||!s.firstMessage){let e=s.name||"Agent";a.firstMessage="नमस्ते! मैं ".concat(e," हूं। मैं आपकी कैसे मदद कर सकता हूं?"),a.transcriberLanguage="hi"}}}return a}),C[e]&&D(t=>({...t,[e]:void 0}))};return g?(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-bg-primary to-bg-secondary flex items-center justify-center p-2 sm:p-4",children:(0,a.jsxs)("div",{className:"card rounded-2xl sm:rounded-3xl shadow-strong p-4 sm:p-8 w-full max-w-md",children:[(0,a.jsxs)("div",{className:"text-center mb-6 sm:mb-8",children:[(0,a.jsx)("div",{className:"w-12 h-12 sm:w-16 sm:h-16 bg-primary-600 rounded-2xl flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)(T.Z,{className:"w-6 h-6 sm:w-8 sm:h-8 text-white"})}),(0,a.jsx)("h2",{className:"text-xl sm:text-2xl font-bold text-text-primary mb-2",children:"Creating Your Agent"}),(0,a.jsx)("p",{className:"text-sm sm:text-base text-text-secondary",children:"Please wait while we set up your AI support agent"})]}),(0,a.jsx)("div",{className:"space-y-4 mb-6 sm:mb-8",children:v.map(e=>(0,a.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,a.jsxs)("div",{className:"flex-shrink-0 w-5 h-5 sm:w-6 sm:h-6 rounded-full flex items-center justify-center mt-0.5 ".concat("completed"===e.status?"bg-success-600 text-white":"loading"===e.status?"bg-primary-600 text-white":"error"===e.status?"bg-error-600 text-white":"bg-neutral-600 text-white"),children:["completed"===e.status&&(0,a.jsx)(y.Z,{className:"w-3 h-3 sm:w-4 sm:h-4"}),"loading"===e.status&&(0,a.jsx)(K.Z,{className:"w-3 h-3 sm:w-4 sm:h-4 animate-spin"}),"error"===e.status&&(0,a.jsx)(J.Z,{className:"w-3 h-3 sm:w-4 sm:h-4"}),"pending"===e.status&&(0,a.jsx)("div",{className:"w-1.5 h-1.5 bg-current rounded-full"})]}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("p",{className:"text-xs sm:text-sm font-medium leading-tight ".concat("error"===e.status?"text-error-600":"text-text-primary"),children:e.title}),e.error&&(0,a.jsx)("p",{className:"text-[10px] sm:text-xs text-error-500 mt-1 break-words",children:e.error})]})]},e.id))}),(!u||v.some(e=>"error"===e.status))&&(0,a.jsx)("div",{className:"flex flex-col space-y-3",children:v.some(e=>"error"===e.status)&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:z,className:"btn-primary w-full",disabled:u,children:u?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(K.Z,{className:"w-4 h-4 mr-2 animate-spin"}),"Retrying..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(S.Z,{className:"w-4 h-4 mr-2"}),"Try Again"]})}),(0,a.jsx)("button",{onClick:()=>{b(!1),h(!1),m(1),N(e=>e.map(e=>({...e,status:"pending",error:void 0})))},className:"btn-secondary w-full",children:"Start Over"}),c&&(0,a.jsxs)("button",{onClick:c,className:"btn-ghost w-full flex items-center justify-center",children:[(0,a.jsx)(Y.Z,{className:"w-4 h-4 mr-2"}),"Logout & Start Fresh"]})]})})]})}):(0,a.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-bg-primary to-bg-secondary flex items-center justify-center p-2 sm:p-4",children:[(0,a.jsxs)("div",{className:"card rounded-2xl sm:rounded-3xl shadow-strong p-4 sm:p-8 w-full max-w-2xl",children:[(0,a.jsxs)("div",{className:"mb-6 sm:mb-8",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4 sm:mb-6",children:[(0,a.jsx)("h1",{className:"text-lg sm:text-xl font-bold text-text-primary",children:"Set Up Your AI Agent"}),(0,a.jsxs)("span",{className:"text-xs sm:text-sm text-text-tertiary whitespace-nowrap ml-2",children:["Step ",d," of ",3]})]}),(0,a.jsx)("div",{className:"flex items-center justify-center w-full max-w-md mx-auto",children:Z.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center ".concat(t<Z.length-1?"flex-1":""),children:[(0,a.jsx)("div",{className:"w-8 h-8 sm:w-10 sm:h-10 rounded-full flex-shrink-0 flex items-center justify-center text-xs sm:text-sm font-medium ".concat(d>=e.id?"bg-primary-600 text-white":"bg-neutral-600 text-white"),children:d>e.id?(0,a.jsx)(y.Z,{className:"w-4 h-4 sm:w-5 sm:h-5"}):e.id}),t<Z.length-1&&(0,a.jsx)("div",{className:"flex-1 h-0.5 sm:h-1 mx-1 sm:mx-2 rounded ".concat(d>e.id?"bg-primary-600":"bg-neutral-600")})]},e.id))})]}),(0,a.jsx)(p.M,{mode:"wait",children:(()=>{switch(d){case 1:return(0,a.jsxs)(n.E.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"space-y-6",children:[(0,a.jsxs)("div",{className:"text-center mb-8",children:[(0,a.jsx)("div",{className:"w-12 h-12 sm:w-16 sm:h-16 bg-primary-600 rounded-2xl flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)(T.Z,{className:"w-6 h-6 sm:w-8 sm:h-8 text-white"})}),(0,a.jsx)("h2",{className:"text-xl sm:text-2xl font-bold text-text-primary mb-2",children:"Meet Your AI Agent"}),(0,a.jsx)("p",{className:"text-sm sm:text-base text-text-secondary",children:"Give your agent a name and describe what it does"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Agent Name"}),(0,a.jsx)("input",{type:"text",value:w.name,onChange:e=>I("name",e.target.value),className:"input-field ".concat(C.name?"border-error-500":""),placeholder:"e.g., Sarah - Sales Assistant"}),C.name&&(0,a.jsx)("p",{className:"text-error-600 text-sm mt-1",children:C.name})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Description (Optional)"}),(0,a.jsx)("textarea",{value:w.description,onChange:e=>I("description",e.target.value),className:"input-field resize-none",rows:3,placeholder:"Brief description of what this agent will do..."})]})]},"step1");case 2:return(0,a.jsxs)(n.E.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"space-y-6",children:[(0,a.jsxs)("div",{className:"text-center mb-8",children:[(0,a.jsx)("div",{className:"w-12 h-12 sm:w-16 sm:h-16 bg-primary-600 rounded-2xl flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)(H.Z,{className:"w-6 h-6 sm:w-8 sm:h-8 text-white"})}),(0,a.jsx)("h2",{className:"text-xl sm:text-2xl font-bold text-text-primary mb-2",children:"Business Objectives"}),(0,a.jsx)("p",{className:"text-sm sm:text-base text-text-secondary",children:"Help us understand your business goals and audience"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"What is your main business objective?"}),(0,a.jsx)("textarea",{value:w.businessObjective,onChange:e=>I("businessObjective",e.target.value),className:"input-field resize-none ".concat(C.businessObjective?"border-error-500":""),rows:3,placeholder:"e.g., Generate qualified leads for our software consultancy services..."}),C.businessObjective&&(0,a.jsx)("p",{className:"text-error-600 text-sm mt-1",children:C.businessObjective})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Who is your target audience?"}),(0,a.jsx)("textarea",{value:w.targetAudience,onChange:e=>I("targetAudience",e.target.value),className:"input-field resize-none ".concat(C.targetAudience?"border-error-500":""),rows:3,placeholder:"e.g., CTOs and technical leaders at mid-size companies looking to modernize their systems..."}),C.targetAudience&&(0,a.jsx)("p",{className:"text-error-600 text-sm mt-1",children:C.targetAudience})]})]},"step2");case 3:return(0,a.jsxs)(n.E.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"space-y-6",children:[(0,a.jsxs)("div",{className:"text-center mb-8",children:[(0,a.jsx)("div",{className:"w-12 h-12 sm:w-16 sm:h-16 bg-primary-600 rounded-2xl flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)(B.Z,{className:"w-6 h-6 sm:w-8 sm:h-8 text-white"})}),(0,a.jsx)("h2",{className:"text-xl sm:text-2xl font-bold text-text-primary mb-2",children:"Value Proposition"}),(0,a.jsx)("p",{className:"text-sm sm:text-base text-text-secondary",children:"Define what makes you unique and compelling"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"What key pain points do you solve?"}),(0,a.jsx)("textarea",{value:w.keyPainPoints,onChange:e=>I("keyPainPoints",e.target.value),className:"input-field resize-none ".concat(C.keyPainPoints?"border-error-500":""),rows:3,placeholder:"e.g., Outdated systems slowing down operations, high technical debt, lack of automation..."}),C.keyPainPoints&&(0,a.jsx)("p",{className:"text-error-600 text-sm mt-1",children:C.keyPainPoints})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"What's your unique value proposition?"}),(0,a.jsx)("textarea",{value:w.valuePropositon,onChange:e=>I("valuePropositon",e.target.value),className:"input-field resize-none ".concat(C.valuePropositon?"border-error-500":""),rows:3,placeholder:"e.g., We deliver modern, scalable solutions 3x faster than traditional agencies with guaranteed ROI..."}),C.valuePropositon&&(0,a.jsx)("p",{className:"text-error-600 text-sm mt-1",children:C.valuePropositon})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"What action do you want prospects to take?"}),(0,a.jsx)("textarea",{value:w.callToAction,onChange:e=>I("callToAction",e.target.value),className:"input-field resize-none ".concat(C.callToAction?"border-error-500":""),rows:3,placeholder:"e.g., Schedule a free 30-minute technical assessment call to discuss their specific needs..."}),C.callToAction&&(0,a.jsx)("p",{className:"text-error-600 text-sm mt-1",children:C.callToAction})]})]},"step3");default:return null}})()}),(0,a.jsxs)("div",{className:"flex items-center justify-between mt-8 gap-2",children:[(0,a.jsxs)("button",{onClick:()=>{j(!0)},className:"flex items-center justify-center space-x-1 sm:space-x-2 px-2 sm:px-4 py-2 text-[10px] sm:text-sm text-white bg-red-600 hover:bg-red-700 rounded-lg transition-colors flex-shrink-0",children:[(0,a.jsx)(Y.Z,{className:"w-3 h-3 sm:w-4 sm:h-4"}),(0,a.jsx)("span",{className:"whitespace-nowrap",children:"Sign Out"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-1 sm:space-x-3",children:[(0,a.jsxs)("button",{onClick:()=>{d>1?m(d-1):s()},className:"flex items-center justify-center px-2 sm:px-6 py-2 sm:py-3 text-[10px] sm:text-sm font-normal rounded-xl border border-primary-solid text-primary-solid hover:bg-primary-solid hover:text-white transition-all whitespace-nowrap min-w-[60px] sm:min-w-[100px]",children:[(0,a.jsx)(k.Z,{className:"w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2"}),(0,a.jsx)("span",{children:"Back"})]}),d<3?(0,a.jsxs)("button",{onClick:()=>{A(d)&&m(d+1)},className:"btn-primary !px-2 sm:!px-6 !py-2 sm:!py-3 text-[10px] sm:text-sm whitespace-nowrap min-w-[80px] sm:min-w-[120px] flex items-center justify-center",children:[(0,a.jsx)("span",{children:"Continue"}),(0,a.jsx)(q.Z,{className:"w-3 h-3 sm:w-4 sm:h-4 ml-1 sm:ml-2"})]}):(0,a.jsx)("button",{onClick:z,disabled:u,className:"btn-primary !px-2 sm:!px-6 !py-2 sm:!py-3 text-[10px] sm:text-sm whitespace-nowrap min-w-[100px] sm:min-w-[140px] flex items-center justify-center",children:u?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(K.Z,{className:"w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2 animate-spin"}),(0,a.jsx)("span",{children:"Creating..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{children:"Launch"}),(0,a.jsx)(q.Z,{className:"w-3 h-3 sm:w-4 sm:h-4 ml-1 sm:ml-2"})]})})]})]})]}),(0,a.jsx)(p.M,{children:f&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center",onClick:P}),(0,a.jsx)(n.E.div,{initial:{scale:.9,opacity:0,y:20},animate:{scale:1,opacity:1,y:0},exit:{scale:.9,opacity:0,y:20},transition:{type:"spring",damping:25,stiffness:300},className:"fixed inset-0 z-50 flex items-center justify-center p-2 sm:p-4 pointer-events-none",children:(0,a.jsxs)("div",{className:"bg-gradient-to-br from-bg-secondary to-bg-tertiary border-2 border-red-500/20 rounded-2xl sm:rounded-3xl p-4 sm:p-8 max-w-md w-full shadow-2xl pointer-events-auto relative overflow-hidden",children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-red-500/5 to-transparent pointer-events-none"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"flex items-center justify-center mb-4 sm:mb-6",children:(0,a.jsx)(n.E.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.1,type:"spring",stiffness:200},className:"w-12 h-12 sm:w-16 sm:h-16 bg-gradient-to-br from-red-500 to-red-600 rounded-2xl flex items-center justify-center shadow-lg",children:(0,a.jsx)(J.Z,{className:"w-6 h-6 sm:w-8 sm:h-8 text-white"})})}),(0,a.jsx)(n.E.h3,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.15},className:"text-xl sm:text-2xl font-medium text-text-primary text-center mb-2 sm:mb-3",children:"Leave Setup?"}),(0,a.jsx)(n.E.p,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2},className:"text-sm sm:text-base text-text-secondary text-center mb-6 sm:mb-8",children:"All the details you've entered will be lost if you leave now. Are you sure you want to exit?"}),(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.25},className:"flex space-x-3 sm:space-x-4",children:[(0,a.jsx)("button",{onClick:P,className:"flex-1 px-4 sm:px-6 py-2 sm:py-3 text-xs sm:text-sm font-medium text-text-primary bg-bg-tertiary hover:bg-bg-tertiary/70 border border-border-subtle rounded-xl transition-all duration-200 hover:scale-105 active:scale-95",children:"Stay"}),(0,a.jsx)("button",{onClick:()=>{j(!1),c?c():s()},className:"flex-1 px-4 sm:px-6 py-2 sm:py-3 text-xs sm:text-sm font-medium text-white bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 rounded-xl transition-all duration-200 shadow-lg hover:shadow-red-500/30 hover:scale-105 active:scale-95",children:"Leave"})]})]})]})})]})})]})}var $=s(16524),ee=s(22839),et=s(12194),es=s(59934),ea=s(15863),er=s(82718),ei=s(44743);function en(){let e=(0,i.useCallback)(function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{showToast:a=!0,logError:r=!0,fallbackMessage:i="An unexpected error occurred"}=s,n=i;return(null==e?void 0:e.message)?n=e.message:"string"==typeof e?n=e:(null==e?void 0:e.error)&&(n=e.error),r&&console.error("Error".concat(t?" in ".concat(t):"",":"),e),a&&x.ZP.error(n),n},[]),t=(0,i.useCallback)(async function(t,s){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{return await t()}catch(t){throw e(t,s,a),t}},[e]),s=(0,i.useCallback)(async function(t,s){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{return await t()}catch(t){return e(t,s,a),null}},[e]);return{handleError:e,handleAsyncError:t,safeAsyncCall:s}}function el(e){let{organizationId:t,userId:s,onStrategyCreated:r}=e,[l,c]=(0,i.useState)([]),[o,d]=(0,i.useState)(""),[m,x]=(0,i.useState)(null),[u,g]=(0,i.useState)(!1),[b,f]=(0,i.useState)(!1),[j,v]=(0,i.useState)(null),[N,w]=(0,i.useState)(!1),[_,C]=(0,i.useState)(null),[k,D]=(0,i.useState)(!0),[S,Z]=(0,i.useState)(null),[E,A]=(0,i.useState)(0),P=(0,i.useRef)(null),{handleError:z,safeAsyncCall:I}=en(),F=()=>{var e;null===(e=P.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})};(0,i.useEffect)(()=>{F()},[l]),(0,i.useEffect)(()=>{O(),L()},[t,s]);let O=async()=>{try{D(!0),Z(null),console.log("Loading organization context for org ID:",t);let e=await fetch("".concat("https://nlxwkbmcfejflujtzmky.supabase.co","/functions/v1/kai-chat"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat("eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5seHdrYm1jZmVqZmx1anR6bWt5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM3MDEwNjksImV4cCI6MjA3OTI3NzA2OX0.OMRdstZ9Smn7MSKiYZ0mzf-oCEyCGSXKsESh_Rvzr30")},body:JSON.stringify({action:"get_organization_context",organizationId:t})});if(console.log("API response status:",e.status),!e.ok)throw Error("Edge Function request failed: ".concat(e.status));let s=await e.json();if(console.log("API response data:",s),s.success&&s.context)console.log("Setting organization context:",s.context),C(s.context);else throw Error(s.error||"Failed to fetch organization context")}catch(e){console.error("Failed to load organization context:",e),C({name:"Gritsa Tech",totalContacts:3,activeAgents:1,totalCalls:5}),Z("Using cached organization data.")}finally{D(!1)}},L=async()=>{try{let e=await fetch("".concat("https://nlxwkbmcfejflujtzmky.supabase.co","/functions/v1/kai-chat"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat("eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5seHdrYm1jZmVqZmx1anR6bWt5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM3MDEwNjksImV4cCI6MjA3OTI3NzA2OX0.OMRdstZ9Smn7MSKiYZ0mzf-oCEyCGSXKsESh_Rvzr30")},body:JSON.stringify({action:"get_conversation_history",organizationId:t,userId:s})}),a=await e.json();a.success&&a.conversation&&(x(a.conversation.id),c(a.conversation.messages||[]),v(a.conversation.extracted_strategy),w(!!a.conversation.extracted_strategy))}catch(e){console.error("Failed to load existing conversation:",e)}},M=async()=>{f(!0);try{let e=await fetch("".concat("https://nlxwkbmcfejflujtzmky.supabase.co","/functions/v1/kai-chat"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat("eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5seHdrYm1jZmVqZmx1anR6bWt5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM3MDEwNjksImV4cCI6MjA3OTI3NzA2OX0.OMRdstZ9Smn7MSKiYZ0mzf-oCEyCGSXKsESh_Rvzr30")},body:JSON.stringify({action:"start_conversation",organizationId:t,userId:s,organizationContext:_})}),a=await e.json();a.success?(x(a.conversation.id),c([{role:"assistant",content:a.message,timestamp:new Date().toISOString()}])):(console.error("Failed to start conversation:",a.error),z(a.error||"Failed to start conversation","start conversation"))}catch(e){console.error("Error starting conversation:",e),z(e,"start conversation")}finally{f(!1)}},R=async()=>{if(!o.trim()||!m||u)return;let e=o.trim();d(""),g(!0);let a={role:"user",content:e,timestamp:new Date().toISOString()};c(e=>[...e,a]);try{let a=await fetch("".concat("https://nlxwkbmcfejflujtzmky.supabase.co","/functions/v1/kai-chat"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat("eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5seHdrYm1jZmVqZmx1anR6bWt5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM3MDEwNjksImV4cCI6MjA3OTI3NzA2OX0.OMRdstZ9Smn7MSKiYZ0mzf-oCEyCGSXKsESh_Rvzr30")},body:JSON.stringify({action:"send_message",message:e,conversationId:m,organizationId:t,userId:s,organizationContext:_})}),i=await a.json();if(i.success){let e={role:"assistant",content:i.message,timestamp:new Date().toISOString()};c(t=>[...t,e]),i.extractedStrategy&&(v(i.extractedStrategy),w(!0),null==r||r(i.extractedStrategy))}else console.error("Failed to send message:",i.error),z(i.error||"Failed to send message","send message")}catch(e){console.error("Error sending message:",e),z(e,"send message")}finally{g(!1)}};return k?(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"card p-8 text-center",children:[(0,a.jsx)("div",{className:"flex justify-center mb-4",children:(0,a.jsx)(ea.Z,{className:"w-8 h-8 animate-spin text-primary-solid"})}),(0,a.jsx)("p",{className:"text-text-secondary",children:"Loading organization context..."}),S&&(0,a.jsx)("div",{className:"mt-4 p-3 bg-yellow-900/20 border border-yellow-800 rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-2 text-yellow-400",children:[(0,a.jsx)(J.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{className:"text-sm",children:S})]})})]}):m?(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"card flex flex-col h-[600px]",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-bg-secondary",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-gradient-to-br from-purple-500 to-blue-600 rounded-full flex items-center justify-center",children:(0,a.jsx)(T.Z,{className:"w-5 h-5 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold text-text-primary",children:"Kai"}),(0,a.jsx)("p",{className:"text-sm text-text-secondary",children:N?"Strategy Created":"Creating Your Strategy"})]})]}),N&&(0,a.jsxs)("div",{className:"flex items-center text-green-400",children:[(0,a.jsx)(y.Z,{className:"w-5 h-5 mr-1"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:"Complete"})]})]}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[(0,a.jsx)(p.M,{children:l.map((e,t)=>(0,a.jsx)(n.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.1*t},className:"flex ".concat("user"===e.role?"justify-end":"justify-start"),children:(0,a.jsxs)("div",{className:"flex items-start space-x-3 max-w-[80%] ".concat("user"===e.role?"flex-row-reverse space-x-reverse":""),children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ".concat("user"===e.role?"bg-bg-secondary border border-bg-tertiary":"bg-gradient-to-br from-purple-500 to-blue-600"),children:"user"===e.role?(0,a.jsx)(h.Z,{className:"w-4 h-4 text-text-secondary"}):(0,a.jsx)(T.Z,{className:"w-4 h-4 text-white"})}),(0,a.jsxs)("div",{className:"p-3 rounded-lg ".concat("user"===e.role?"bg-blue-600 text-white":"bg-bg-secondary text-text-primary border border-bg-tertiary"),children:[(0,a.jsx)("div",{className:"whitespace-pre-wrap text-sm",children:e.content}),(0,a.jsx)("div",{className:"text-xs mt-1 opacity-70 ".concat("user"===e.role?"text-blue-100":"text-text-tertiary"),children:new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]})},t))}),u&&(0,a.jsx)(n.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"flex justify-start",children:(0,a.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,a.jsx)("div",{className:"w-8 h-8 bg-gradient-to-br from-purple-500 to-blue-600 rounded-full flex items-center justify-center",children:(0,a.jsx)(T.Z,{className:"w-4 h-4 text-white"})}),(0,a.jsx)("div",{className:"bg-bg-secondary p-3 rounded-lg border border-bg-tertiary",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(ea.Z,{className:"w-4 h-4 animate-spin text-primary-solid"}),(0,a.jsx)("span",{className:"text-sm text-text-secondary",children:"Kai is thinking..."})]})})]})}),(0,a.jsx)("div",{ref:P})]}),j&&(0,a.jsxs)(n.E.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"border-t border-bg-secondary p-4 bg-bg-tertiary",children:[(0,a.jsxs)("div",{className:"flex items-center mb-2",children:[(0,a.jsx)(y.Z,{className:"w-5 h-5 text-accent-success mr-2"}),(0,a.jsx)("h4",{className:"font-medium text-text-primary",children:"Strategy Created"})]}),(0,a.jsxs)("div",{className:"text-sm text-text-secondary space-y-1",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Target:"})," ",j.targetAudience.join(", ")]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Goals:"})," ",j.communicationGoals.join(", ")]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Frequency:"})," ",j.frequency]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Confidence:"})," ",Math.round(100*j.confidence),"%"]})]})]}),!N&&(0,a.jsxs)("div",{className:"border-t border-bg-secondary p-4",children:[(0,a.jsxs)("div",{className:"flex space-x-3",children:[(0,a.jsx)("input",{type:"text",value:o,onChange:e=>d(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),R())},placeholder:"Tell Kai about your outbound strategy...",className:"flex-1 px-3 py-2 bg-bg-secondary border border-bg-tertiary rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-solid focus:border-transparent text-text-primary placeholder-text-tertiary",disabled:u}),(0,a.jsx)("button",{onClick:R,disabled:!o.trim()||u,className:"px-4 py-2 bg-primary-solid text-white rounded-lg hover:bg-primary-600 disabled:opacity-50 disabled:cursor-not-allowed flex items-center transition-colors",children:(0,a.jsx)(ei.Z,{className:"w-4 h-4"})})]}),(0,a.jsx)("div",{className:"text-xs text-text-tertiary mt-2",children:"Press Enter to send • Shift+Enter for new line"})]})]}):(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"card p-8 text-center",children:[(0,a.jsx)("div",{className:"flex justify-center mb-4",children:(0,a.jsx)("div",{className:"w-16 h-16 bg-gradient-to-br from-purple-500 to-blue-600 rounded-full flex items-center justify-center",children:(0,a.jsx)(T.Z,{className:"w-8 h-8 text-white"})})}),(0,a.jsx)("h3",{className:"text-xl font-bold text-text-primary mb-2",children:"Meet Kai"}),(0,a.jsx)("p",{className:"text-text-secondary mb-6 max-w-md mx-auto",children:"Your intelligent controller agent that helps create personalized outbound communication strategies through conversation."}),_&&(0,a.jsxs)("div",{className:"bg-bg-secondary p-4 rounded-lg mb-6 text-sm",children:[(0,a.jsx)("h4",{className:"font-medium text-text-primary mb-2",children:"Current Organization Status"}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-4 text-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-lg font-semibold text-primary-solid",children:_.activeAgents}),(0,a.jsx)("div",{className:"text-text-tertiary",children:"Active Agents"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-lg font-semibold text-primary-solid",children:_.totalContacts}),(0,a.jsx)("div",{className:"text-text-tertiary",children:"Contacts"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-lg font-semibold text-primary-solid",children:_.totalCalls}),(0,a.jsx)("div",{className:"text-text-tertiary",children:"Total Calls"})]})]})]}),(0,a.jsxs)("div",{className:"grid md:grid-cols-3 gap-4 mb-8 text-sm",children:[(0,a.jsxs)("div",{className:"p-4 bg-bg-secondary rounded-lg border border-bg-tertiary",children:[(0,a.jsx)(U.Z,{className:"w-6 h-6 text-primary-solid mx-auto mb-2"}),(0,a.jsx)("h4",{className:"font-medium text-text-primary",children:"Smart Analysis"}),(0,a.jsx)("p",{className:"text-text-secondary",children:"Analyzes your contacts and call history"})]}),(0,a.jsxs)("div",{className:"p-4 bg-bg-secondary rounded-lg border border-bg-tertiary",children:[(0,a.jsx)(er.Z,{className:"w-6 h-6 text-primary-solid mx-auto mb-2"}),(0,a.jsx)("h4",{className:"font-medium text-text-primary",children:"Natural Conversation"}),(0,a.jsx)("p",{className:"text-text-secondary",children:"Talk naturally about your business goals"})]}),(0,a.jsxs)("div",{className:"p-4 bg-bg-secondary rounded-lg border border-bg-tertiary",children:[(0,a.jsx)(y.Z,{className:"w-6 h-6 text-accent-success mx-auto mb-2"}),(0,a.jsx)("h4",{className:"font-medium text-text-primary",children:"Automated Strategy"}),(0,a.jsx)("p",{className:"text-text-secondary",children:"Creates and executes outbound plans"})]})]}),(0,a.jsx)("button",{onClick:M,disabled:b,className:"btn-primary flex items-center mx-auto",children:b?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ea.Z,{className:"w-4 h-4 mr-2 animate-spin"}),"Starting conversation..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(T.Z,{className:"w-4 h-4 mr-2"}),"Start Strategy Discussion"]})})]})}function ec(e){let{onNavigate:t}=e,{state:s}=(0,r.q)(),{profile:c,subscription:o,agents:d,contacts:m}=s,[x,u]=(0,i.useState)(null),[p,h]=(0,i.useState)([]),[g,b]=(0,i.useState)(!0);(0,i.useEffect)(()=>{(null==c?void 0:c.organization_id)&&f()},[c]);let f=async()=>{try{b(!0);let{data:e}=await l.OQ.rpc("get_organization_stats",{org_id:null==c?void 0:c.organization_id});if(e&&e.length>0){let t=e[0];u({totalCalls:t.total_calls||0,successfulCalls:t.successful_calls||0,totalCreditsUsed:t.total_credits_used||10*t.total_minutes||0,creditsRemaining:t.credits_remaining||10*t.minutes_remaining||0,totalContacts:t.total_contacts||0,activeAgents:t.active_agents||0,callsToday:0,successRateToday:0,creditsFromCalls:t.credits_from_calls||0,creditsFromEmails:t.credits_from_emails||0,creditsFromSMS:t.credits_from_sms||0})}let{data:t}=await l.OQ.from("calls").select("\n          id,\n          direction,\n          outcome,\n          duration_seconds,\n          started_at,\n          from_number,\n          to_number,\n          contacts (first_name, last_name),\n          agents (name)\n        ").eq("organization_id",null==c?void 0:c.organization_id).order("created_at",{ascending:!1}).limit(10);if(t){let e=t.map(e=>{let t=Array.isArray(e.contacts)?e.contacts[0]:e.contacts,s=Array.isArray(e.agents)?e.agents[0]:e.agents;return{id:e.id,contact_name:t?"".concat(t.first_name||""," ").concat(t.last_name||"").trim():"inbound"===e.direction?e.from_number:e.to_number,phone_number:"inbound"===e.direction?e.from_number:e.to_number,direction:e.direction,outcome:e.outcome,duration_seconds:e.duration_seconds,started_at:e.started_at,agent_name:(null==s?void 0:s.name)||"Unknown"}});h(e);let s=new Date().toDateString(),a=e.filter(e=>new Date(e.started_at).toDateString()===s),r=a.filter(e=>"success"===e.outcome).length;u(e=>e?{...e,callsToday:a.length,successRateToday:a.length>0?r/a.length*100:0}:null)}}catch(e){console.error("Error fetching dashboard data:",e)}finally{b(!1)}},v=[{title:"Total Conversations",value:(null==x?void 0:x.totalCalls)||0,icon:R.Z,color:"primary",iconColor:"text-blue-400",bgColor:"bg-blue-400/10",trend:(null==x?void 0:x.callsToday)?"+".concat(x.callsToday," today"):"No calls today"},{title:"Success Rate",value:x&&x.totalCalls>0?"".concat(Math.round(x.successfulCalls/x.totalCalls*100),"%"):"0%",icon:y.Z,color:"success",iconColor:"text-emerald-400",bgColor:"bg-emerald-400/10",trend:"".concat(Math.round((null==x?void 0:x.successRateToday)||0),"% today")},{title:"Credits Used",value:(0,l.Hf)((null==x?void 0:x.totalCreditsUsed)||0),icon:Q.Z,color:"warning",iconColor:"text-amber-400",bgColor:"bg-amber-400/10",trend:"".concat((0,l.Hf)((null==x?void 0:x.creditsRemaining)||0)," remaining")},{title:"Contacts",value:(null==x?void 0:x.totalContacts)||0,icon:L.Z,color:"secondary",iconColor:"text-purple-400",bgColor:"bg-purple-400/10",trend:"Total in CRM"}];return g?(0,a.jsx)("div",{className:"space-y-8",children:(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[1,2,3,4].map(e=>(0,a.jsxs)("div",{className:"card animate-pulse",children:[(0,a.jsx)("div",{className:"h-4 bg-neutral-600 rounded w-1/2 mb-4"}),(0,a.jsx)("div",{className:"h-8 bg-neutral-600 rounded w-1/3 mb-2"}),(0,a.jsx)("div",{className:"h-3 bg-neutral-600 rounded w-1/4"})]},e))})}):(0,a.jsxs)("div",{className:"space-y-8",children:[(0,a.jsxs)("div",{className:"dashboard-header",children:[(0,a.jsxs)(n.E.h1,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"dashboard-title",children:["Welcome back, ",null==c?void 0:c.first_name,"! \uD83D\uDC4B"]}),(0,a.jsx)("p",{className:"dashboard-subtitle",children:"Here's what's happening with your AI support agents today."})]}),o&&o.credits_included>0&&(()=>{let e=o.credits_used||0,s=o.credits_included||1,r=e/s,i=Math.round(100*r),c=(0,l.tR)(e,s);return r<.8?null:(0,a.jsx)(n.E.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"mb-6 p-4 rounded-xl border ".concat(i>=100?"border-red-600 bg-red-500/20 text-red-100":i>=95?"border-red-500 bg-red-500/10 text-red-100":i>=90?"border-orange-500 bg-orange-500/10 text-orange-100":"border-yellow-500 bg-yellow-500/10 text-yellow-100"),children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"font-semibold text-lg flex items-center gap-2",children:["Credit usage at ",i,"%"]}),(0,a.jsx)("p",{className:"text-sm mt-1 opacity-90",children:(0,l.B8)(c)})]}),(0,a.jsx)("button",{onClick:()=>t("settings"),className:"px-4 py-2 bg-white/10 hover:bg-white/20 rounded-lg text-sm font-medium transition-all text-white border border-white/10",children:"Add Credits"})]})})})(),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:v.map((e,t)=>{let s=e.icon;return(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*t},className:"kpi-card p-6",children:[(0,a.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,a.jsx)("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center ".concat(e.bgColor),children:(0,a.jsx)(s,{className:"w-6 h-6 ".concat(e.iconColor)})})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"kpi-title",children:e.title}),(0,a.jsx)("p",{className:"kpi-value",children:e.value}),(0,a.jsx)("p",{className:"text-xs text-white/90",children:e.trend})]})]},e.title)})}),o&&(0,a.jsx)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"trial-banner p-6 rounded-2xl ".concat("trial"===o.status?"border-warning-200":"border-success-200"),children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(J.Z,{className:"w-6 h-6 ".concat("trial"===o.status?"text-warning-600":"text-success-600")}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"font-medium text-text-primary capitalize",children:[o.status," Account"]}),(0,a.jsx)("p",{className:"text-sm text-text-secondary",children:"trial"===o.status?"Trial ends ".concat(new Date(o.trial_end_date).toLocaleDateString()):"Active subscription"})]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("p",{className:"text-sm font-medium text-text-primary",children:[(0,l.Hf)(o.credits_used||0)," / ",(0,l.Hf)(o.credits_included||0)," credits"]}),(0,a.jsx)("div",{className:"w-32 h-2 bg-neutral-200 rounded-full mt-1",children:(0,a.jsx)("div",{className:"h-full rounded-full ".concat("trial"===o.status?"bg-warning-500":"bg-success-500"),style:{width:"".concat(Math.min((o.credits_used||0)/(o.credits_included||1)*100,100),"%")}})})]})]})}),(0,a.jsxs)("div",{className:"grid lg:grid-cols-2 gap-8",children:[(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},className:"card",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("h2",{className:"text-lg font-bold text-text-primary",children:"Recent Calls"}),(0,a.jsx)("button",{onClick:()=>t("calls"),className:"text-sm text-primary-600 hover:text-primary-700 font-medium",children:"View All"})]}),p.length>0?(0,a.jsx)("div",{className:"space-y-4",children:p.slice(0,5).map(e=>(0,a.jsxs)("div",{className:"flex items-center space-x-4 p-3 hover:bg-bg-secondary rounded-lg transition-colors",children:[(0,a.jsx)("div",{className:"icon-box w-10 h-10 ".concat((e.direction,"bg-primary-600")),children:"inbound"===e.direction?(0,a.jsx)($.Z,{className:"w-5 h-5 text-white"}):(0,a.jsx)(ee.Z,{className:"w-5 h-5 text-white"})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("p",{className:"font-medium text-text-primary truncate",children:e.contact_name||e.phone_number}),(0,a.jsxs)("p",{className:"text-sm text-text-secondary",children:[e.agent_name," • ",(0,l.LU)(e.duration_seconds)]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat((0,l.lj)(e.outcome)),children:e.outcome&&"string"==typeof e.outcome?e.outcome.replace("_"," "):"Unknown"}),(0,a.jsx)("p",{className:"text-xs text-text-tertiary mt-1",children:new Date(e.started_at).toLocaleTimeString()})]})]},e.id))}):(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)(et.Z,{className:"w-12 h-12 text-text-tertiary mx-auto mb-3"}),(0,a.jsx)("p",{className:"text-text-secondary",children:"No calls yet"}),(0,a.jsx)("p",{className:"text-sm text-text-tertiary",children:"Your call history will appear here"})]})]}),(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6},className:"card",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("h2",{className:"text-lg font-bold text-text-primary",children:"Your Agents"}),(0,a.jsx)("button",{onClick:()=>t("agents"),className:"text-sm text-primary-600 hover:text-primary-700 font-medium",children:"Manage Agents"})]}),d.length>0?(0,a.jsx)("div",{className:"space-y-4",children:d.map(e=>(0,a.jsxs)("div",{className:"flex items-center space-x-4 p-3 hover:bg-bg-secondary rounded-lg transition-colors",children:[(0,a.jsx)("div",{className:"icon-box w-10 h-10",children:(0,a.jsx)(T.Z,{className:"w-5 h-5 text-white"})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("p",{className:"font-medium text-text-primary truncate",children:e.name}),(0,a.jsx)("div",{className:"w-2 h-2 rounded-full ".concat(e.is_active&&e.phone_number?"bg-success-500":"bg-neutral-400")})]}),(0,a.jsx)("div",{className:"text-sm text-text-secondary",children:e.phone_number?(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsxs)("span",{className:"flex items-center space-x-1",children:[(0,a.jsx)(j.Z,{className:"w-3 h-3"}),(0,a.jsx)("span",{children:(0,l.un)(e.phone_number)})]}),(0,a.jsx)("span",{children:"•"}),(0,a.jsx)("span",{children:W(e.voice_id)})]}):(0,a.jsx)("span",{className:"text-warning-600",children:"No phone number assigned"})})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat(e.is_active&&e.phone_number?"text-success-100 bg-success-800":"text-warning-100 bg-warning-800"),children:e.is_active&&e.phone_number?"Active":"Setup Required"}),(0,a.jsxs)("p",{className:"text-xs text-text-tertiary mt-1",children:[e.total_calls," calls",e.total_calls>0&&(0,a.jsxs)(a.Fragment,{children:[" • ",Math.round(e.successful_calls/e.total_calls*100),"% success"]})]})]})]},e.id))}):(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)(T.Z,{className:"w-12 h-12 text-text-tertiary mx-auto mb-3"}),(0,a.jsx)("p",{className:"text-text-secondary",children:"No agents configured"}),(0,a.jsx)("button",{onClick:()=>t("agents"),className:"text-sm text-primary-600 hover:text-primary-700 font-medium mt-2",children:"Create Your First Agent"})]})]})]}),(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.7},className:"card",children:[(0,a.jsx)("h2",{className:"text-lg font-bold text-text-primary mb-6",children:"Quick Actions"}),(0,a.jsxs)("div",{className:"grid md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,a.jsxs)("button",{onClick:()=>t("strategy"),className:"p-4 border border-border-subtle rounded-xl hover:border-primary-300 hover:bg-bg-secondary transition-all duration-200 text-left",children:[(0,a.jsx)(H.Z,{className:"w-6 h-6 text-primary-600 mb-2"}),(0,a.jsx)("h3",{className:"font-medium text-text-primary mb-1",children:"Strategy Center"}),(0,a.jsx)("p",{className:"text-sm text-text-secondary",children:"Create intelligent outbound strategies with Kai"})]}),(0,a.jsxs)("button",{onClick:()=>t("contacts"),className:"p-4 border border-border-subtle rounded-xl hover:border-primary-300 hover:bg-bg-secondary transition-all duration-200 text-left",children:[(0,a.jsx)(L.Z,{className:"w-6 h-6 text-primary-600 mb-2"}),(0,a.jsx)("h3",{className:"font-medium text-text-primary mb-1",children:"Manage Contacts"}),(0,a.jsx)("p",{className:"text-sm text-text-secondary",children:"View detailed contact communication timeline"})]}),(0,a.jsxs)("button",{onClick:()=>t("agents"),className:"p-4 border border-border-subtle rounded-xl hover:border-primary-300 hover:bg-bg-secondary transition-all duration-200 text-left",children:[(0,a.jsx)(T.Z,{className:"w-6 h-6 text-primary-600 mb-2"}),(0,a.jsx)("h3",{className:"font-medium text-text-primary mb-1",children:"Create Agent"}),(0,a.jsx)("p",{className:"text-sm text-text-secondary",children:"Set up a new AI support agent with multi-channel capabilities"})]}),(0,a.jsxs)("button",{onClick:()=>t("reports"),className:"p-4 border border-border-subtle rounded-xl hover:border-primary-300 hover:bg-bg-secondary transition-all duration-200 text-left",children:[(0,a.jsx)(M.Z,{className:"w-6 h-6 text-primary-600 mb-2"}),(0,a.jsx)("h3",{className:"font-medium text-text-primary mb-1",children:"Analytics"}),(0,a.jsx)("p",{className:"text-sm text-text-secondary",children:"Advanced call performance metrics"})]}),(0,a.jsxs)("button",{onClick:()=>t("support"),className:"p-4 border border-border-subtle rounded-xl hover:border-primary-300 hover:bg-bg-secondary transition-all duration-200 text-left",children:[(0,a.jsx)(es.Z,{className:"w-6 h-6 text-primary-600 mb-2"}),(0,a.jsx)("h3",{className:"font-medium text-text-primary mb-1",children:"Support Cases"}),(0,a.jsx)("p",{className:"text-sm text-text-secondary",children:"Manage and track customer support tickets"})]})]})]}),!1,(0,a.jsx)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:1},className:"card bg-gradient-to-r from-primary-600 to-primary-700 text-white",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-bold mb-2",children:"\uD83D\uDE80 Enhanced Features Available"}),(0,a.jsx)("p",{className:"text-primary-100 mb-4",children:"Your platform now includes advanced call tracking, detailed contact timelines, and enhanced security."}),(0,a.jsxs)("ul",{className:"text-sm text-primary-100 space-y-1",children:[(0,a.jsx)("li",{children:"• Comprehensive contact communication history"}),(0,a.jsx)("li",{children:"• Call recordings with full transcripts"}),(0,a.jsx)("li",{children:"• Enhanced VAPI integration with secure webhooks"}),(0,a.jsx)("li",{children:"• Real-time call data synchronization"})]})]}),(0,a.jsx)("div",{className:"text-right",children:(0,a.jsx)("button",{onClick:()=>t("contacts"),className:"px-4 py-2 bg-bg-secondary rounded-lg font-medium hover:bg-bg-tertiary transition-colors text-primary-solid",children:"Try New CRM"})})]})})]})}var eo=s(91723),ed=s(17689),em=s(99397),ex=s(73247),eu=s(31047),ep=s(48736),eh=s(2207),eg=s(18930),eb=s(83229),ey=s(94630),ef=s(17684),ej=s(62720),ev=s(86595),eN=s(54887),ew=s(89227),e_=s(33276),eC=s(92735),ek=s(35471),eD=s(45274),eS=s(51548),eZ=s(88623),eE=s(81706);function eA(e){let{call:t,variant:s="compact",className:r=""}=e,[c,o]=(0,i.useState)(!1),[d,m]=(0,i.useState)(!1),[x,u]=(0,i.useState)(null),[p,h]=(0,i.useState)(0),[g,b]=(0,i.useState)(0),[y,f]=(0,i.useState)(1),[j,v]=(0,i.useState)(!1),[N,w]=(0,i.useState)(!1),_=(0,i.useRef)(null),C=(0,i.useRef)(null),k=t.recording_url||"success"===t.outcome;(0,i.useEffect)(()=>{let e=_.current;if(!e)return;let t=()=>h(e.currentTime),s=()=>b(e.duration),a=()=>{o(!1),e.src.startsWith("blob:")&&URL.revokeObjectURL(e.src)},r=()=>{u("Failed to load recording"),o(!1),m(!1),e.src.startsWith("blob:")&&URL.revokeObjectURL(e.src)};return e.addEventListener("timeupdate",t),e.addEventListener("loadedmetadata",s),e.addEventListener("ended",a),e.addEventListener("error",r),()=>{e.removeEventListener("timeupdate",t),e.removeEventListener("loadedmetadata",s),e.removeEventListener("ended",a),e.removeEventListener("error",r),e.src.startsWith("blob:")&&URL.revokeObjectURL(e.src)}},[]);let D=async function(){var e;let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"stream";if(!(null===(e=(await l.OQ.auth.getSession()).data.session)||void 0===e?void 0:e.access_token))throw Error("Authentication required");return"".concat("".concat("https://nlxwkbmcfejflujtzmky.supabase.co","/functions/v1"),"/call-recording-proxy/").concat(t.id,"?type=stereo&action=").concat(s)},S=async()=>{if(_.current)try{if(m(!0),u(null),_.current.src&&(_.current.src.startsWith("blob:")||_.current.readyState>=1))await _.current.play(),o(!0);else{var e;let t=await D("stream"),s=await l.OQ.auth.getSession(),a=await fetch(t,{headers:{Authorization:"Bearer ".concat(null===(e=s.data.session)||void 0===e?void 0:e.access_token)}});if(!a.ok)throw Error("Failed to load recording: ".concat(a.status," ").concat(a.statusText));let r=await a.blob(),i=URL.createObjectURL(r);_.current.src=i,await _.current.play(),o(!0),_.current.onended=()=>{o(!1),URL.revokeObjectURL(i)}}}catch(e){console.error("Error playing recording:",e),u(e.message||"Failed to play recording"),console.error("Failed to play recording")}finally{m(!1)}},Z=()=>{_.current&&(_.current.pause(),o(!1))},E=e=>{if(_.current){let t=Math.max(0,Math.min(g,p+e));_.current.currentTime=t,h(t)}},A=async()=>{try{var e,s;w(!0);let a=await l.OQ.auth.getSession();if(!(null===(e=a.data.session)||void 0===e?void 0:e.access_token))throw Error("Authentication required");let r="".concat("".concat("https://nlxwkbmcfejflujtzmky.supabase.co","/functions/v1"),"/call-recording-proxy/").concat(t.id,"?type=stereo&action=download"),i=await fetch(r,{headers:{Authorization:"Bearer ".concat(a.data.session.access_token)}});if(!i.ok)throw Error("Failed to download recording");let n=await i.blob(),c=window.URL.createObjectURL(n),o=document.createElement("a");o.href=c;let d=i.headers.get("Content-Disposition"),m=(null==d?void 0:null===(s=d.match(/filename="(.+)"/))||void 0===s?void 0:s[1])||"call-recording-".concat(new Date(t.started_at||t.created_at).toISOString().split("T")[0],".mp3");o.download=m,document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(c),console.log("Recording downloaded successfully")}catch(e){console.error("Error downloading recording:",e),console.error(e.message||"Failed to download recording")}finally{w(!1)}},P=e=>"".concat(Math.floor(e/60),":").concat(Math.floor(e%60).toString().padStart(2,"0"));return k?"compact"===s?(0,a.jsxs)("div",{className:"flex items-center space-x-2 ".concat(r),children:[(0,a.jsx)("button",{onClick:c?Z:S,disabled:d,className:"p-2 text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors disabled:opacity-50",title:c?"Pause recording":"Play recording",children:d?(0,a.jsx)(K.Z,{className:"w-4 h-4 animate-spin"}):c?(0,a.jsx)(ew.Z,{className:"w-4 h-4"}):(0,a.jsx)(e_.Z,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:A,disabled:N,className:"p-2 text-neutral-600 hover:bg-neutral-50 rounded-lg transition-colors disabled:opacity-50",title:"Download recording",children:N?(0,a.jsx)(K.Z,{className:"w-4 h-4 animate-spin"}):(0,a.jsx)(eC.Z,{className:"w-4 h-4"})}),x&&(0,a.jsx)("div",{title:x,children:(0,a.jsx)(J.Z,{className:"w-4 h-4 text-accent-error"})}),(0,a.jsx)("audio",{ref:_,preload:"none"})]}):(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"card p-4 ".concat(r),children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 mb-4",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-indigo-100 rounded-xl flex items-center justify-center",children:(0,a.jsx)(ek.Z,{className:"w-5 h-5 text-indigo-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-medium text-text-primary",children:"Call Recording"}),(0,a.jsxs)("p",{className:"text-sm text-text-secondary",children:[new Date(t.started_at||t.created_at).toLocaleString()," • ",Math.floor(t.duration_seconds/60),"min"]})]})]}),x?(0,a.jsxs)("div",{className:"flex items-center justify-center py-8 text-red-600",children:[(0,a.jsx)(J.Z,{className:"w-6 h-6 mr-2"}),(0,a.jsx)("span",{children:x})]}):(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-4",children:[(0,a.jsx)("button",{onClick:()=>E(-10),className:"p-2 text-neutral-600 hover:bg-neutral-50 rounded-lg transition-colors",title:"Skip back 10s",children:(0,a.jsx)(eD.Z,{className:"w-5 h-5"})}),(0,a.jsx)("button",{onClick:c?Z:S,disabled:d,className:"p-3 bg-indigo-600 text-white rounded-xl hover:bg-indigo-700 transition-colors disabled:opacity-50",title:c?"Pause":"Play",children:d?(0,a.jsx)(K.Z,{className:"w-6 h-6 animate-spin"}):c?(0,a.jsx)(ew.Z,{className:"w-6 h-6"}):(0,a.jsx)(e_.Z,{className:"w-6 h-6"})}),(0,a.jsx)("button",{onClick:()=>E(10),className:"p-2 text-neutral-600 hover:bg-neutral-50 rounded-lg transition-colors",title:"Skip forward 10s",children:(0,a.jsx)(eS.Z,{className:"w-5 h-5"})})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("input",{ref:C,type:"range",min:0,max:g||0,value:p,onChange:e=>{let t=parseFloat(e.target.value);_.current&&(_.current.currentTime=t,h(t))},className:"w-full audio-slider"}),(0,a.jsxs)("div",{className:"flex justify-between text-sm text-text-secondary",children:[(0,a.jsx)("span",{children:P(p)}),(0,a.jsx)("span",{children:P(g)})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("button",{onClick:()=>{if(_.current){let e=!j;v(e),_.current.volume=e?0:y}},className:"p-1 text-neutral-600 hover:bg-neutral-50 rounded transition-colors",title:j?"Unmute":"Mute",children:j?(0,a.jsx)(eZ.Z,{className:"w-4 h-4"}):(0,a.jsx)(eE.Z,{className:"w-4 h-4"})}),(0,a.jsx)("input",{type:"range",min:0,max:1,step:.1,value:j?0:y,onChange:e=>{let t=parseFloat(e.target.value);f(t),v(0===t),_.current&&(_.current.volume=t)},className:"w-20 volume-slider"})]}),(0,a.jsxs)("button",{onClick:A,disabled:N,className:"btn-secondary flex items-center text-sm disabled:opacity-50",children:[N?(0,a.jsx)(K.Z,{className:"w-4 h-4 mr-2 animate-spin"}):(0,a.jsx)(eC.Z,{className:"w-4 h-4 mr-2"}),"Download"]})]})]}),(0,a.jsx)("audio",{ref:_,preload:"none"})]}):null}function eP(e){var t,s;let{call:r,onClose:c}=e,[o,d]=(0,i.useState)(!1),[m,x]=(0,i.useState)(!1);(0,i.useEffect)(()=>(x(!0),document.body.style.overflow="hidden",()=>{document.body.style.overflow="unset"}),[]);let u=(e,t)=>{let s="w-5 h-5";return"inbound"===e?(0,a.jsx)($.Z,{className:s}):(0,a.jsx)(ee.Z,{className:s})},p=(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4",style:{zIndex:9999},onClick:e=>{e.target===e.currentTarget&&c()},children:(0,a.jsxs)(n.E.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-bg-primary rounded-xl max-w-2xl w-full max-h-[85vh] overflow-hidden flex flex-col",onClick:e=>e.stopPropagation(),children:[(0,a.jsx)("div",{className:"p-6 border-b border-bg-tertiary",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"p-3 rounded-xl ".concat("inbound"===r.direction?"bg-blue-100":"bg-green-100"),children:u(r.direction,r.outcome)}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-xl font-bold text-text-primary",children:"Call Details"}),(0,a.jsx)("p",{className:"text-text-secondary",children:new Date(r.started_at).toLocaleString()})]})]}),(0,a.jsx)("button",{onClick:c,className:"p-2 hover:bg-bg-secondary rounded-lg transition-colors",title:"Close",children:(0,a.jsx)(b.Z,{className:"w-5 h-5 text-text-secondary"})})]})}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[o&&(0,a.jsxs)("div",{className:"text-center py-4",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-indigo-600 mx-auto"}),(0,a.jsx)("p",{className:"text-sm text-text-secondary mt-2",children:"Loading complete call data..."})]}),(0,a.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-bg-secondary rounded-lg",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-text-secondary",children:"Direction:"}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[u(r.direction,r.outcome),(0,a.jsx)("span",{className:"capitalize text-text-primary font-medium",children:r.direction})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-bg-secondary rounded-lg",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-text-secondary",children:"Duration:"}),(0,a.jsx)("span",{className:"text-text-primary font-medium",children:(0,l.LU)(r.duration_seconds)})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-bg-secondary rounded-lg",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-text-secondary",children:"Outcome:"}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(e=>{switch(e){case"success":return(0,a.jsx)(y.Z,{className:"w-5 h-5 text-green-600"});case"failure":case"error":return(0,a.jsx)(F.Z,{className:"w-5 h-5 text-red-600"});case"no_answer":case"busy":return(0,a.jsx)(J.Z,{className:"w-5 h-5 text-yellow-600"});case"in_progress":return(0,a.jsx)(eo.Z,{className:"w-5 h-5 text-indigo-600"});case"voicemail":return(0,a.jsx)(R.Z,{className:"w-5 h-5 text-blue-600"});default:return(0,a.jsx)(J.Z,{className:"w-5 h-5 text-neutral-500"})}})(r.outcome),(0,a.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat((0,l.lj)(r.outcome)),children:r.outcome&&"string"==typeof r.outcome?r.outcome.replace("_"," "):"Unknown"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[r.agent_name&&(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-bg-secondary rounded-lg",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-text-secondary",children:"Agent:"}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(T.Z,{className:"w-4 h-4 text-indigo-600"}),(0,a.jsx)("span",{className:"text-text-primary font-medium",children:r.agent_name})]})]}),r.contact_name&&(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-bg-secondary rounded-lg",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-text-secondary",children:"Contact:"}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(h.Z,{className:"w-4 h-4 text-neutral-600"}),(0,a.jsx)("span",{className:"text-text-primary font-medium",children:r.contact_name})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-bg-secondary rounded-lg",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-text-secondary",children:"Cost:"}),(0,a.jsx)("span",{className:"text-text-primary font-medium",children:(0,l.xG)(r.cost_usd||0)})]}),(r.contact_phone||r.from_number||r.to_number)&&(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-bg-secondary rounded-lg",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-text-secondary",children:"Phone:"}),(0,a.jsx)("span",{className:"text-text-primary font-medium",children:(0,l.un)(r.contact_phone||r.from_number||r.to_number||"")})]})]})]}),r.recording_url&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("h4",{className:"font-medium text-text-primary mb-3 flex items-center",children:[(0,a.jsx)(eo.Z,{className:"w-4 h-4 mr-2"}),"Call Recording"]}),(0,a.jsx)(eA,{call:{id:r.id,organization_id:"",agent_id:"",contact_id:r.contact_name||"",vapi_call_id:r.vapi_call_id,direction:r.direction,outcome:r.outcome,from_number:r.from_number,to_number:r.to_number,duration_seconds:r.duration_seconds,cost_usd:r.cost_usd,started_at:r.started_at,ended_at:r.ended_at,created_at:r.created_at,summary:r.summary,recording_url:r.recording_url,transcript:null===(s=r.transcript)||void 0===s?void 0:s.full_transcript},variant:"full"})]}),r.summary&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("h4",{className:"font-medium text-text-primary mb-3 flex items-center",children:[(0,a.jsx)(R.Z,{className:"w-4 h-4 mr-2"}),"Call Summary"]}),(0,a.jsx)("div",{className:"bg-bg-secondary p-4 rounded-lg",children:(0,a.jsx)("p",{className:"text-text-secondary leading-relaxed",children:r.summary})})]}),(null===(t=r.transcript)||void 0===t?void 0:t.full_transcript)&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("h4",{className:"font-medium text-text-primary mb-3 flex items-center",children:[(0,a.jsx)(R.Z,{className:"w-4 h-4 mr-2"}),"Full Transcript"]}),(0,a.jsx)("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4 max-h-64 overflow-y-auto",children:r.transcript.messages&&r.transcript.messages.length>0?(0,a.jsx)("div",{className:"space-y-3",children:r.transcript.messages.map((e,t)=>{let s=["assistant","agent","bot","system"].includes(String(e.role||"").toLowerCase());return(0,a.jsxs)("div",{className:"p-3 rounded-lg ".concat(s?"bg-blue-900/30 border border-blue-700/50":"bg-neutral-700/50 border border-neutral-600/50"),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,a.jsx)("span",{className:"font-medium text-sm text-neutral-200",children:s?"Agent":"Customer"}),(0,a.jsxs)("span",{className:"text-xs text-neutral-400",children:[Math.floor(e.time/1e3),"s"]})]}),(0,a.jsx)("p",{className:"text-sm text-neutral-100",children:e.message})]},t)})}):(0,a.jsx)("pre",{className:"text-sm text-neutral-200 whitespace-pre-wrap font-mono leading-relaxed",children:r.transcript.full_transcript})})]})]})]})});return m?(0,eN.createPortal)(p,document.body):null}function ez(e){let{calls:t,loading:s=!1,onRefresh:r,showContact:c=!0,showAgent:o=!0,variant:d="full",className:m=""}=e,[x,u]=(0,i.useState)(null),p=(e,t)=>{let s="w-4 h-4";return"inbound"===e?(0,a.jsx)($.Z,{className:s}):(0,a.jsx)(ee.Z,{className:s})},g=e=>{switch(e){case"success":return(0,a.jsx)(y.Z,{className:"w-4 h-4 text-green-600"});case"failure":case"error":return(0,a.jsx)(F.Z,{className:"w-4 h-4 text-red-600"});case"no_answer":case"busy":return(0,a.jsx)(J.Z,{className:"w-4 h-4 text-yellow-600"});case"in_progress":return(0,a.jsx)(eo.Z,{className:"w-4 h-4 text-indigo-600"});case"voicemail":return(0,a.jsx)(R.Z,{className:"w-4 h-4 text-blue-600"});default:return(0,a.jsx)(J.Z,{className:"w-4 h-4 text-neutral-500"})}};return s?(0,a.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})}):"compact"===d?(0,a.jsxs)("div",{className:"space-y-3 ".concat(m),children:[t.map((e,t)=>(0,a.jsx)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.05*t},className:"card p-4 cursor-pointer hover:bg-bg-secondary transition-colors",onClick:()=>u(e),children:(0,a.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,a.jsx)("div",{className:"p-2 rounded-lg ".concat("inbound"===e.direction?"bg-blue-100":"bg-green-100"),children:p(e.direction,e.outcome)}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,a.jsx)("h4",{className:"font-medium text-text-primary truncate",children:c&&e.contact_name?e.contact_name:o&&e.agent_name?e.agent_name:"".concat(e.direction," Call")}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[g(e.outcome),(0,a.jsx)("span",{className:"text-xs text-text-secondary",children:new Date(e.started_at).toLocaleDateString()})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-3 text-sm text-text-secondary",children:[(0,a.jsxs)("span",{className:"flex items-center space-x-1",children:[(0,a.jsx)(eo.Z,{className:"w-3 h-3"}),(0,a.jsx)("span",{children:(0,l.LU)(e.duration_seconds)})]}),e.cost_usd>0&&(0,a.jsx)("span",{children:(0,l.xG)(e.cost_usd)})]}),e.summary&&(0,a.jsx)("p",{className:"mt-1 text-sm text-text-secondary line-clamp-1",children:e.summary})]})]})},e.id)),x&&(0,a.jsx)(eP,{call:x,onClose:()=>u(null)})]}):(0,a.jsxs)("div",{className:"card overflow-hidden ".concat(m),children:[(0,a.jsxs)("div",{className:"p-4 border-b border-bg-tertiary flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-text-primary",children:"Call History"}),r&&(0,a.jsxs)("button",{onClick:r,className:"btn-secondary flex items-center text-sm",children:[(0,a.jsx)(S.Z,{className:"w-4 h-4 mr-2"}),"Refresh"]})]}),(0,a.jsxs)("div",{className:"overflow-x-auto",children:[(0,a.jsxs)("table",{className:"min-w-full divide-y divide-bg-tertiary",children:[(0,a.jsx)("thead",{className:"bg-bg-secondary",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-text-secondary uppercase tracking-wider",children:"Date"}),c&&(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-text-secondary uppercase tracking-wider",children:"Contact"}),o&&(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-text-secondary uppercase tracking-wider",children:"Agent"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-text-secondary uppercase tracking-wider",children:"Direction"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-text-secondary uppercase tracking-wider",children:"Outcome"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-text-secondary uppercase tracking-wider",children:"Duration"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-text-secondary uppercase tracking-wider",children:"Cost"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-text-secondary uppercase tracking-wider",children:"Actions"})]})}),(0,a.jsx)("tbody",{className:"bg-bg-primary divide-y divide-bg-tertiary",children:t.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-bg-secondary transition-colors",children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-text-primary",children:(0,a.jsxs)("div",{children:[new Date(e.started_at).toLocaleDateString(),(0,a.jsx)("br",{}),(0,a.jsx)("span",{className:"text-xs text-text-tertiary",children:new Date(e.started_at).toLocaleTimeString()})]})}),c&&(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-text-primary",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(h.Z,{className:"w-4 h-4 text-neutral-600 mr-2"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{children:e.contact_name||"Unknown"}),e.contact_phone&&(0,a.jsx)("div",{className:"text-xs text-text-tertiary",children:(0,l.un)(e.contact_phone)})]})]})}),o&&(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-text-primary",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(T.Z,{className:"w-4 h-4 text-indigo-600 mr-2"}),(0,a.jsx)("span",{children:e.agent_name||"Unknown"})]})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[p(e.direction,e.outcome),(0,a.jsx)("span",{className:"text-sm text-text-primary capitalize",children:e.direction})]})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("div",{className:"flex items-center",children:[g(e.outcome),(0,a.jsx)("span",{className:"ml-2 inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat((0,l.lj)(e.outcome)),children:e.outcome&&"string"==typeof e.outcome?e.outcome.replace("_"," "):"Unknown"})]})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-text-primary",children:(0,l.LU)(e.duration_seconds)}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-text-primary",children:(0,l.xG)(e.cost_usd||0)}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,a.jsx)("button",{onClick:()=>u(e),className:"text-indigo-600 hover:text-indigo-900",children:"View Details"})})]},e.id))})]}),0===t.length&&(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)(j.Z,{className:"mx-auto h-12 w-12 text-text-tertiary"}),(0,a.jsx)("h3",{className:"mt-2 text-sm font-medium text-text-primary",children:"No calls found"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-text-secondary",children:"No calls have been made yet."})]})]}),x&&(0,a.jsx)(eP,{call:x,onClose:()=>u(null)})]})}function eI(e){let{contactId:t,onBack:s}=e,[r,c]=(0,i.useState)(null),[d,m]=(0,i.useState)([]),[u,p]=(0,i.useState)(!0),[g,f]=(0,i.useState)("timeline"),[v,N]=(0,i.useState)(null),[w,_]=(0,i.useState)(!1),[C,D]=(0,i.useState)(!1),[S,Z]=(0,i.useState)(""),[E,A]=(0,i.useState)([]),[P,z]=(0,i.useState)(""),[I,O]=(0,i.useState)(1),[T,L]=(0,i.useState)("new"),[M,U]=(0,i.useState)(!1);(0,i.useEffect)(()=>{q()},[t]);let q=async()=>{try{p(!0);let{data:e,error:s}=await l.OQ.from("contacts").select("*").eq("id",t).single();if(s)throw s;c(e),Z(e.notes||""),A(e.tags||[]),O(e.contact_priority||1),L(e.relationship_status||"new");let{data:a,error:i}=await l.OQ.from("calls").select("\n          *,\n          agents (name),\n          call_transcripts (full_transcript, messages)\n        ").eq("contact_id",t).order("started_at",{ascending:!1});if(i)throw i;let n=a.map(e=>{var t,s;return{id:e.id,vapi_call_id:e.vapi_call_id,direction:e.direction,outcome:e.outcome,duration_seconds:e.duration_seconds,started_at:e.started_at,ended_at:e.ended_at,cost_usd:e.cost_usd,summary:e.summary,recording_url:e.recording_url,agent_name:(null===(t=e.agents)||void 0===t?void 0:t.name)||"Unknown",contact_name:"".concat((null==r?void 0:r.first_name)||""," ").concat((null==r?void 0:r.last_name)||"").trim()||"Unknown Contact",contact_phone:null==r?void 0:r.phone_number,from_number:e.from_number,to_number:e.to_number,created_at:e.created_at,transcript:(null===(s=e.call_transcripts)||void 0===s?void 0:s[0])?{full_transcript:e.call_transcripts[0].full_transcript,messages:e.call_transcripts[0].messages}:void 0}});m(n)}catch(e){console.error("Error fetching contact data:",e),x.ZP.error("Failed to load contact details")}finally{p(!1)}},Q=async()=>{try{U(!0);let{error:e}=await l.OQ.from("contacts").update({notes:S,tags:E,contact_priority:I,relationship_status:T}).eq("id",t);if(e)throw e;c(e=>e?{...e,notes:S,tags:E,contact_priority:I,relationship_status:T}:null),D(!1),x.ZP.success("Contact updated successfully")}catch(e){console.error("Error saving contact:",e),x.ZP.error("Failed to save changes")}finally{U(!1)}},V=()=>{P.trim()&&!E.includes(P.trim())&&(A([...E,P.trim()]),z(""))},H=e=>{A(E.filter(t=>t!==e))},B=async e=>{N(e),e.recording_url&&e.transcript||await K(e)},K=async e=>{if(e.vapi_call_id)try{_(!0);let t=await l.OQ.functions.invoke("call-data-retrieval",{body:{action:"getCall",callId:e.vapi_call_id,organizationId:null==r?void 0:r.organization_id}});if(t.error)throw Error(t.error.message||"Failed to fetch call data");let{call:s}=t.data;m(t=>t.map(t=>{var a,r,i,n;return t.id===e.id?{...t,outcome:"ended"===s.status?(null===(a=s.analysis)||void 0===a?void 0:a.successEvaluation)||"success":t.outcome,recording_url:(null===(r=s.recordings)||void 0===r?void 0:r.stereo)||(null===(i=s.recordings)||void 0===i?void 0:i.mono),transcript:{full_transcript:s.transcript,messages:s.messages||[]},summary:(null===(n=s.analysis)||void 0===n?void 0:n.summary)||t.summary}:t})),N(t=>{var a,r,i,n;return(null==t?void 0:t.id)===e.id?{...t,outcome:"ended"===s.status?(null===(a=s.analysis)||void 0===a?void 0:a.successEvaluation)||"success":t.outcome,recording_url:(null===(r=s.recordings)||void 0===r?void 0:r.stereo)||(null===(i=s.recordings)||void 0===i?void 0:i.mono),transcript:{full_transcript:s.transcript,messages:s.messages||[]},summary:(null===(n=s.analysis)||void 0===n?void 0:n.summary)||t.summary}:t})}catch(e){console.error("Error enriching call data:",e),x.ZP.error("Failed to load complete call data")}finally{_(!1)}},Y=e=>"".concat(Math.floor(e/60),":").concat((e%60).toString().padStart(2,"0")),G=e=>{switch(e){case"success":return(0,a.jsx)(y.Z,{className:"w-4 h-4 text-green-600"});case"failure":return(0,a.jsx)(F.Z,{className:"w-4 h-4 text-red-600"});case"no_answer":case"busy":return(0,a.jsx)(J.Z,{className:"w-4 h-4 text-yellow-600"});case"in_progress":return(0,a.jsx)(eo.Z,{className:"w-4 h-4 text-indigo-600"});case"voicemail":return(0,a.jsx)(R.Z,{className:"w-4 h-4 text-blue-600"});default:return(0,a.jsx)(J.Z,{className:"w-4 h-4 text-neutral-500"})}},W=(e,t)=>{let s="w-4 h-4";return"inbound"===e?(0,a.jsx)($.Z,{className:s}):(0,a.jsx)(ee.Z,{className:s})};return u?(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"})}):r?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("button",{onClick:s,className:"p-2 hover:bg-bg-secondary rounded-lg transition-colors",children:(0,a.jsx)(k.Z,{className:"w-5 h-5 text-text-secondary"})}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h1",{className:"text-2xl font-bold text-text-primary",children:[r.first_name," ",r.last_name]}),(0,a.jsx)("p",{className:"text-text-secondary",children:r.company})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[C?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("button",{onClick:Q,disabled:M,className:"btn-primary",children:[M?(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}):(0,a.jsx)(eb.Z,{className:"w-4 h-4 mr-2"}),"Save"]}),(0,a.jsxs)("button",{onClick:()=>{D(!1),Z((null==r?void 0:r.notes)||""),A((null==r?void 0:r.tags)||[]),O((null==r?void 0:r.contact_priority)||1),L((null==r?void 0:r.relationship_status)||"new")},className:"btn-secondary",children:[(0,a.jsx)(b.Z,{className:"w-4 h-4 mr-2"}),"Cancel"]})]}):(0,a.jsxs)("button",{onClick:()=>D(!0),className:"btn-secondary",children:[(0,a.jsx)(ey.Z,{className:"w-4 h-4 mr-2"}),"Edit"]}),(0,a.jsx)("button",{className:"p-2 hover:bg-bg-secondary rounded-lg",children:(0,a.jsx)(ef.Z,{className:"w-5 h-5 text-text-secondary"})})]})]}),(0,a.jsxs)("div",{className:"grid md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,a.jsx)("div",{className:"card p-4",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(j.Z,{className:"w-5 h-5 text-indigo-600"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-text-secondary",children:"Phone"}),(0,a.jsx)("p",{className:"font-medium text-text-primary",children:(0,l.un)(r.phone_number)})]})]})}),(0,a.jsx)("div",{className:"card p-4",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(o.Z,{className:"w-5 h-5 text-indigo-600"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-text-secondary",children:"Email"}),(0,a.jsx)("p",{className:"font-medium text-text-primary",children:r.email||"Not provided"})]})]})}),(0,a.jsx)("div",{className:"card p-4",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(et.Z,{className:"w-5 h-5 text-indigo-600"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-text-secondary",children:"Total Calls"}),(0,a.jsx)("p",{className:"font-medium text-text-primary",children:r.total_calls||0})]})]})}),(0,a.jsx)("div",{className:"card p-4",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[G(r.last_call_outcome||"unknown"),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-text-secondary",children:"Last Outcome"}),(0,a.jsx)("p",{className:"font-medium text-text-primary capitalize",children:r.last_call_outcome&&"string"==typeof r.last_call_outcome?r.last_call_outcome.replace("_"," "):"None"})]})]})})]}),(0,a.jsxs)("div",{className:"grid lg:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"card p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-bold text-text-primary mb-4",children:"Contact Information"}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium text-text-secondary",children:"Tags"}),C&&(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("input",{type:"text",value:P,onChange:e=>z(e.target.value),onKeyPress:e=>"Enter"===e.key&&V(),placeholder:"Add tag...",className:"text-xs px-2 py-1 bg-bg-secondary border border-bg-tertiary rounded focus:outline-none focus:ring-1 focus:ring-primary-solid"}),(0,a.jsx)("button",{onClick:V,className:"text-xs px-2 py-1 bg-primary-solid text-white rounded hover:bg-primary-600",children:"Add"})]})]}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(C?E:r.tags||[]).map(e=>(0,a.jsxs)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-primary-100 text-primary-800 border border-primary-200",children:[(0,a.jsx)(ej.Z,{className:"w-3 h-3 mr-1"}),e,C&&(0,a.jsx)("button",{onClick:()=>H(e),className:"ml-1 text-primary-600 hover:text-primary-800",children:(0,a.jsx)(b.Z,{className:"w-3 h-3"})})]},e)),0===(C?E:r.tags||[]).length&&(0,a.jsx)("span",{className:"text-text-tertiary text-sm",children:"No tags"})]})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"text-sm font-medium text-text-secondary mb-2 block",children:"Relationship Status"}),C?(0,a.jsxs)("select",{value:T,onChange:e=>L(e.target.value),className:"w-full px-3 py-2 bg-bg-secondary border border-bg-tertiary rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-solid",children:[(0,a.jsx)("option",{value:"new",children:"New"}),(0,a.jsx)("option",{value:"contacted",children:"Contacted"}),(0,a.jsx)("option",{value:"engaged",children:"Engaged"}),(0,a.jsx)("option",{value:"customer",children:"Customer"})]}):(0,a.jsxs)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat((e=>{switch(e){case"customer":return"text-green-400 bg-green-900/20";case"engaged":return"text-blue-400 bg-blue-900/20";case"contacted":return"text-yellow-400 bg-yellow-900/20";default:return"text-gray-400 bg-gray-900/20"}})(r.relationship_status||"new")),children:[(0,a.jsx)(h.Z,{className:"w-3 h-3 mr-1"}),(r.relationship_status||"new").charAt(0).toUpperCase()+(r.relationship_status||"new").slice(1)]})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"text-sm font-medium text-text-secondary mb-2 block",children:"Priority"}),C?(0,a.jsxs)("select",{value:I,onChange:e=>O(Number(e.target.value)),className:"w-full px-3 py-2 bg-bg-secondary border border-bg-tertiary rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-solid",children:[(0,a.jsx)("option",{value:1,children:"Low"}),(0,a.jsx)("option",{value:2,children:"Medium"}),(0,a.jsx)("option",{value:3,children:"High"})]}):(0,a.jsxs)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat((e=>{switch(e){case 3:return"text-red-400 bg-red-900/20";case 2:return"text-yellow-400 bg-yellow-900/20";default:return"text-blue-400 bg-blue-900/20"}})(r.contact_priority||1)),children:[(0,a.jsx)(ev.Z,{className:"w-3 h-3 mr-1"}),(e=>{switch(e){case 3:return"High";case 2:return"Medium";default:return"Low"}})(r.contact_priority||1)]})]})]}),(0,a.jsxs)("div",{className:"card p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-bold text-text-primary mb-4",children:"Notes"}),C?(0,a.jsx)("textarea",{value:S,onChange:e=>Z(e.target.value),placeholder:"Add notes about this contact...",rows:6,className:"w-full px-3 py-2 bg-bg-secondary border border-bg-tertiary rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-solid resize-none"}):(0,a.jsx)("div",{className:"min-h-[120px]",children:r.notes?(0,a.jsx)("p",{className:"text-text-primary whitespace-pre-wrap",children:r.notes}):(0,a.jsx)("p",{className:"text-text-tertiary",children:"No notes added yet"})})]})]}),(0,a.jsx)("div",{className:"border-b border-border-subtle",children:(0,a.jsx)("nav",{className:"flex space-x-8",children:[{id:"timeline",label:"Timeline",icon:eu.Z},{id:"calls",label:"Call History",icon:et.Z},{id:"details",label:"Details",icon:ep.Z}].map(e=>{let t=e.icon;return(0,a.jsxs)("button",{onClick:()=>f(e.id),className:"flex items-center space-x-2 py-4 px-1 border-b-2 transition-colors ".concat(g===e.id?"border-indigo-600 text-indigo-600":"border-transparent text-text-secondary hover:text-text-primary"),children:[(0,a.jsx)(t,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:e.label})]},e.id)})})}),(0,a.jsxs)("div",{className:"min-h-[400px]",children:["timeline"===g&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-text-primary",children:"Communication Timeline"}),d.length>0?(0,a.jsx)("div",{className:"space-y-4",children:d.map((e,t)=>(0,a.jsx)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*t},className:"card p-4 cursor-pointer hover:bg-bg-secondary transition-colors",onClick:()=>B(e),children:(0,a.jsxs)("div",{className:"flex items-start space-x-4",children:[(0,a.jsx)("div",{className:"p-2 rounded-lg ".concat("inbound"===e.direction?"bg-blue-100":"bg-green-100"),children:W(e.direction,e.outcome)}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("h4",{className:"font-medium text-text-primary",children:"inbound"===e.direction?"Inbound Call":"Outbound Call"}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[G(e.outcome||"unknown"),(0,a.jsx)("span",{className:"text-sm text-text-secondary",children:new Date(e.started_at).toLocaleString()})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-text-secondary",children:[(0,a.jsxs)("span",{className:"flex items-center space-x-1",children:[(0,a.jsx)(eo.Z,{className:"w-3 h-3"}),(0,a.jsx)("span",{children:Y(e.duration_seconds)})]}),(0,a.jsxs)("span",{children:["Agent: ",e.agent_name]}),e.cost_usd>0&&(0,a.jsxs)("span",{children:["$",e.cost_usd.toFixed(3)]})]}),e.summary&&(0,a.jsx)("p",{className:"mt-2 text-sm text-text-secondary line-clamp-2",children:e.summary})]})]})},e.id))}):(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)(et.Z,{className:"w-12 h-12 text-text-tertiary mx-auto mb-3"}),(0,a.jsx)("p",{className:"text-text-secondary",children:"No calls yet"}),(0,a.jsx)("p",{className:"text-sm text-text-tertiary",children:"Call history will appear here"})]})]}),"calls"===g&&(0,a.jsx)("div",{className:"space-y-4",children:(0,a.jsx)(ez,{calls:d,loading:u,onRefresh:()=>{x.ZP.promise(l.OQ.functions.invoke("call-data-retrieval",{body:{action:"syncMissingCalls",organizationId:r.organization_id}}).then(e=>{if(e.error)throw Error(e.error.message);return e.data}),{loading:"Syncing call data...",success:"Call data synced successfully",error:"Failed to sync call data"}).then(()=>q())},showContact:!1,showAgent:!0,variant:"full"})}),"details"===g&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-text-primary",children:"Contact Details"}),(0,a.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-1",children:"First Name"}),(0,a.jsx)("input",{type:"text",value:r.first_name,className:"input",readOnly:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-1",children:"Last Name"}),(0,a.jsx)("input",{type:"text",value:r.last_name,className:"input",readOnly:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-1",children:"Company"}),(0,a.jsx)("input",{type:"text",value:r.company||"",className:"input",readOnly:!0})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-1",children:"Phone Number"}),(0,a.jsx)("input",{type:"text",value:r.phone_number,className:"input",readOnly:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-1",children:"Email"}),(0,a.jsx)("input",{type:"email",value:r.email||"",className:"input",readOnly:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-1",children:"Created"}),(0,a.jsx)("input",{type:"text",value:new Date(r.created_at).toLocaleDateString(),className:"input",readOnly:!0})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-1",children:"Notes"}),(0,a.jsx)("textarea",{value:r.notes||"",className:"input min-h-[100px]",readOnly:!0,placeholder:"No notes available"})]})]})]}),v&&(0,a.jsx)(eP,{call:v,onClose:()=>N(null)})]}):(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("p",{className:"text-text-secondary",children:"Contact not found"}),(0,a.jsx)("button",{onClick:s,className:"btn-secondary mt-4",children:"Go Back"})]})}function eF(e){let{onNavigate:t}=e,{state:s,dispatch:c,actions:o}=(0,r.q)(),{profile:d,contacts:m,agents:u}=s,[h,b]=(0,i.useState)(!1),[f,v]=(0,i.useState)(""),[N,w]=(0,i.useState)("all"),[_,C]=(0,i.useState)(!1),[k,D]=(0,i.useState)(!1),[S,Z]=(0,i.useState)([]),[E,A]=(0,i.useState)(!1),[P,z]=(0,i.useState)(""),[I,O]=(0,i.useState)(!1),[T,M]=(0,i.useState)(null),[R,U]=(0,i.useState)(null),[q,Q]=(0,i.useState)(null),[V,H]=(0,i.useState)(!1),[B,K]=(0,i.useState)(null),[Y,G]=(0,i.useState)({firstName:"",lastName:"",phoneNumber:"",email:"",company:""});(0,i.useEffect)(()=>{X(),o.fetchAgents()},[d]);let X=async()=>{if(null==d?void 0:d.organization_id)try{b(!0);let{data:e}=await l.OQ.from("contacts").select("*").eq("organization_id",d.organization_id).order("created_at",{ascending:!1});c({type:"UPDATE_CONTACTS",contacts:e||[]}),b(!1)}catch(t){console.error("Error fetching contacts:",t);let e=t instanceof Error?t.message:"Failed to fetch contacts";x.ZP.error(e),b(!1)}},$=async()=>{if(console.log("\uD83D\uDC65 handleAddContact called",Y),!Y.phoneNumber.trim()){x.ZP.error("Phone number is required");return}try{console.log("\uD83D\uDCBE Inserting contact into database...");let{error:e}=await l.OQ.from("contacts").insert({organization_id:null==d?void 0:d.organization_id,first_name:Y.firstName||null,last_name:Y.lastName||null,phone_number:Y.phoneNumber,email:Y.email||null,company:Y.company||null});if(e)throw e;console.log("✅ Contact added successfully"),x.ZP.success("Contact added successfully"),D(!1),G({firstName:"",lastName:"",phoneNumber:"",email:"",company:""}),await X()}catch(t){console.error("Error adding contact:",t);let e=t instanceof Error?t.message:"Failed to add contact";x.ZP.error(e)}},ee=async(e,t)=>{if(!t){Z([e.id]),A(!0);return}try{let s=u.find(e=>e.id===t);if(!s){x.ZP.error("Selected agent not found");return}if(!s.vapi_assistant_id){x.ZP.error("Agent is not properly configured");return}let a=await (0,l.k_)("initiate-outbound-call",{method:"POST",body:JSON.stringify({contactId:e.id,agentId:s.id,organizationId:null==d?void 0:d.organization_id})});a.success?(x.ZP.success("Calling ".concat(e.first_name||e.phone_number,"...")),await X()):x.ZP.error(a.error||"Failed to initiate call")}catch(t){console.error("Error initiating outbound call:",t);let e=t instanceof Error?t.message:"Failed to initiate call";x.ZP.error(e)}},es=async e=>{if(0===S.length){x.ZP.error("No contacts selected");return}try{if(!u.find(t=>t.id===e)){x.ZP.error("Selected agent not found");return}let t=S.map(t=>{let s=m.find(e=>e.id===t);if(s)return ee(s,e)});await Promise.all(t),Z([]),A(!1),x.ZP.success("Initiated calls for ".concat(S.length," contacts"))}catch(e){console.error("Error with bulk calling:",e),x.ZP.error("Failed to initiate some calls")}},ea=async e=>{if(confirm("Are you sure you want to delete this contact? This action cannot be undone."))try{K(e);let t=await (0,l.k_)("edit-contact?contactId=".concat(e),{method:"DELETE"});if(!t.success)throw Error(t.error||"Failed to delete contact");x.ZP.success("Contact deleted successfully"),await X()}catch(t){console.error("Error deleting contact:",t);let e=t instanceof Error?t.message:"Failed to delete contact";x.ZP.error(e)}finally{K(null)}},er=async()=>{try{O(!0);let e="";e=T?await T.text():P;let t=await (0,l.k_)("import-contacts",{method:"POST",body:JSON.stringify({data:e,organizationId:null==d?void 0:d.organization_id})});if(!t.success)throw Error(t.error||"Import failed");console.log("✅ Import result:",t),x.ZP.success("Successfully imported ".concat(t.summary.imported," contacts")),t.summary.duplicates>0&&(0,x.ZP)("".concat(t.summary.duplicates," duplicates skipped"),{icon:"⚠️"}),t.summary.invalid>0&&x.ZP.error("".concat(t.summary.invalid," invalid entries")),C(!1),z(""),M(null),await X()}catch(t){console.error("Error importing contacts:",t);let e=t instanceof Error?t.message:"Failed to import contacts";x.ZP.error(e)}finally{O(!1)}},ei=m.filter(e=>{var t,s,a,r;let i=(null===(t=e.first_name)||void 0===t?void 0:t.toLowerCase().includes(f.toLowerCase()))||(null===(s=e.last_name)||void 0===s?void 0:s.toLowerCase().includes(f.toLowerCase()))||e.phone_number.includes(f)||(null===(a=e.email)||void 0===a?void 0:a.toLowerCase().includes(f.toLowerCase()))||(null===(r=e.company)||void 0===r?void 0:r.toLowerCase().includes(f.toLowerCase())),n="all"===N||"contacted"===N&&e.total_calls>0||"never_contacted"===N&&0===e.total_calls||"success"===N&&"success"===e.last_call_outcome||"pending"===N&&"in_progress"===e.last_call_outcome;return i&&n}),en=e=>{if(0===e.total_calls)return(0,a.jsx)(eo.Z,{className:"w-4 h-4 text-neutral-400"});switch(e.last_call_outcome){case"success":return(0,a.jsx)(y.Z,{className:"w-4 h-4 text-success-500"});case"failure":return(0,a.jsx)(F.Z,{className:"w-4 h-4 text-error-500"});case"in_progress":return(0,a.jsx)(eo.Z,{className:"w-4 h-4 text-warning-500"});default:return(0,a.jsx)(eo.Z,{className:"w-4 h-4 text-neutral-400"})}},el=e=>{let t=e.last_outbound_call||e.last_inbound_call;if(!t)return"Never contacted";let s=new Date(t).toLocaleDateString(),a="Unknown";return"string"==typeof e.last_call_outcome&&(a=e.last_call_outcome.replace("_"," ")),"".concat(a," - ").concat(s)};return(0,a.jsx)("div",{className:"space-y-6",children:R?(0,a.jsx)(eI,{contactId:R,onBack:()=>U(null)}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-text-primary",children:"CRM"}),(0,a.jsx)("p",{className:"text-text-secondary mt-1",children:"Manage your contacts and track communication history"})]}),(0,a.jsxs)("div",{className:"flex space-x-3",children:[(0,a.jsxs)("button",{onClick:()=>C(!0),className:"btn-secondary flex items-center",children:[(0,a.jsx)(ed.Z,{className:"w-4 h-4 mr-2"}),"Import Contacts"]}),(0,a.jsxs)("button",{onClick:()=>D(!0),className:"btn-primary flex items-center",children:[(0,a.jsx)(em.Z,{className:"w-4 h-4 mr-2"}),"Add Contact"]})]})]}),(0,a.jsx)("div",{className:"card",children:(0,a.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between space-y-4 md:space-y-0",children:[(0,a.jsx)("div",{className:"flex-1 max-w-md",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(ex.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-neutral-400"}),(0,a.jsx)("input",{type:"text",placeholder:"Search contacts...",value:f,onChange:e=>v(e.target.value),className:"input-field pl-10"})]})}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("select",{value:N,onChange:e=>w(e.target.value),className:"input-field",children:[(0,a.jsx)("option",{value:"all",children:"All Contacts"}),(0,a.jsx)("option",{value:"contacted",children:"Contacted"}),(0,a.jsx)("option",{value:"never_contacted",children:"Never Contacted"}),(0,a.jsx)("option",{value:"success",children:"Successful Calls"}),(0,a.jsx)("option",{value:"pending",children:"Pending Follow-up"})]}),(0,a.jsxs)("span",{className:"text-sm text-neutral-500",children:[ei.length," of ",m.length," contacts"]})]})]})}),(0,a.jsx)("div",{className:"card p-0 overflow-hidden",children:h?(0,a.jsxs)("div",{className:"p-8 text-center",children:[(0,a.jsx)("div",{className:"animate-spin w-8 h-8 border-4 border-primary-200 border-t-primary-600 rounded-full mx-auto"}),(0,a.jsx)("p",{className:"text-neutral-500 mt-2",children:"Loading contacts..."})]}):ei.length>0?(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{className:"bg-bg-secondary border-b border-border-subtle",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"text-left py-4 px-6 font-medium text-text-primary",children:"Contact"}),(0,a.jsx)("th",{className:"text-left py-4 px-6 font-medium text-text-primary",children:"Phone"}),(0,a.jsx)("th",{className:"text-left py-4 px-6 font-medium text-text-primary",children:"Company"}),(0,a.jsx)("th",{className:"text-left py-4 px-6 font-medium text-text-primary",children:"Last Contact"}),(0,a.jsx)("th",{className:"text-left py-4 px-6 font-medium text-text-primary",children:"Status"}),(0,a.jsx)("th",{className:"text-left py-4 px-6 font-medium text-text-primary",children:"Actions"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-border-subtle",children:ei.map((e,t)=>{var s,r;return(0,a.jsxs)(n.E.tr,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.05*t},className:"hover:bg-bg-secondary transition-colors",children:[(0,a.jsx)("td",{className:"py-4 px-6",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center bg-gradient-to-br from-primary-500 to-primary-600 shadow-lg",children:(0,a.jsx)("span",{className:"text-sm font-medium text-white uppercase",children:(null===(s=e.first_name)||void 0===s?void 0:s[0])||(null===(r=e.last_name)||void 0===r?void 0:r[0])||e.phone_number[1]})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium text-text-primary",children:e.first_name||e.last_name?"".concat(e.first_name||""," ").concat(e.last_name||"").trim():"Unknown"}),e.email&&(0,a.jsx)("p",{className:"text-sm text-text-secondary",children:e.email})]})]})}),(0,a.jsx)("td",{className:"py-4 px-6",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(j.Z,{className:"w-4 h-4 text-text-secondary"}),(0,a.jsx)("span",{className:"text-text-primary",children:(0,l.un)(e.phone_number)})]})}),(0,a.jsx)("td",{className:"py-4 px-6",children:e.company?(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(g.Z,{className:"w-4 h-4 text-text-secondary"}),(0,a.jsx)("span",{className:"text-text-primary",children:e.company})]}):(0,a.jsx)("span",{className:"text-text-secondary",children:"—"})}),(0,a.jsx)("td",{className:"py-4 px-6",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(eu.Z,{className:"w-4 h-4 text-text-secondary"}),(0,a.jsx)("span",{className:"text-sm text-text-secondary",children:e.last_outbound_call||e.last_inbound_call?new Date(e.last_outbound_call||e.last_inbound_call).toLocaleDateString():"Never"})]})}),(0,a.jsx)("td",{className:"py-4 px-6",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[en(e),(0,a.jsx)("span",{className:"text-sm text-neutral-600",children:el(e)})]})}),(0,a.jsx)("td",{className:"py-4 px-6",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("button",{onClick:()=>U(e.id),className:"p-2 text-neutral-400 hover:text-primary-600 hover:bg-primary-50 rounded-lg transition-colors",title:"View Details",children:(0,a.jsx)(ep.Z,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:()=>ee(e),className:"p-2 text-neutral-400 hover:text-primary-600 hover:bg-primary-50 rounded-lg transition-colors",title:"Call Contact",disabled:0===u.filter(e=>e.is_active&&e.phone_number).length,children:(0,a.jsx)(et.Z,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:()=>{Q(e),H(!0)},className:"p-2 text-neutral-400 hover:text-primary-600 hover:bg-primary-50 rounded-lg transition-colors",title:"Edit Contact",children:(0,a.jsx)(eh.Z,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:()=>ea(e.id),className:"p-2 text-neutral-400 hover:text-error-600 hover:bg-error-50 rounded-lg transition-colors",title:"Delete Contact",disabled:B===e.id,children:B===e.id?(0,a.jsx)("div",{className:"animate-spin w-4 h-4 border-2 border-error-200 border-t-error-600 rounded-full"}):(0,a.jsx)(eg.Z,{className:"w-4 h-4"})})]})})]},e.id)})})]})}):(0,a.jsxs)("div",{className:"p-12 text-center",children:[(0,a.jsx)(L.Z,{className:"w-16 h-16 text-neutral-300 mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-neutral-900 mb-2",children:f||"all"!==N?"No contacts found":"No contacts yet"}),(0,a.jsx)("p",{className:"text-neutral-600 mb-6",children:f||"all"!==N?"Try adjusting your search or filter criteria":"Import contacts or add them manually to get started"}),!f&&"all"===N&&(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row justify-center space-y-2 sm:space-y-0 sm:space-x-3",children:[(0,a.jsxs)("button",{onClick:()=>C(!0),className:"btn-secondary flex items-center justify-center",children:[(0,a.jsx)(ed.Z,{className:"w-4 h-4 mr-2"}),"Import Contacts"]}),(0,a.jsxs)("button",{onClick:()=>D(!0),className:"btn-primary flex items-center justify-center",children:[(0,a.jsx)(em.Z,{className:"w-4 h-4 mr-2"}),"Add Manually"]})]})]})}),(0,a.jsx)(p.M,{children:_&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,a.jsxs)(n.E.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"card rounded-2xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto shadow-lg shadow-primary-500/20",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-text-primary",children:"Import Contacts"}),(0,a.jsx)("button",{onClick:()=>C(!1),className:"p-2 hover:bg-neutral-100 rounded-lg transition-colors",children:"✕"})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"bg-primary-50 border border-primary-200 rounded-xl p-4",children:[(0,a.jsx)("h3",{className:"font-medium text-primary-900 mb-2",children:"Supported Formats"}),(0,a.jsxs)("div",{className:"text-sm text-primary-700 space-y-1",children:[(0,a.jsxs)("p",{children:["• ",(0,a.jsx)("strong",{children:"Phone only:"})," One phone number per line"]}),(0,a.jsxs)("p",{children:["• ",(0,a.jsx)("strong",{children:"Name + Phone:"})," John Doe +1234567890"]}),(0,a.jsxs)("p",{children:["• ",(0,a.jsx)("strong",{children:"Comma separated:"})," John Doe, +1234567890, john@email.com, Company"]})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Upload CSV File"}),(0,a.jsxs)("div",{className:"border-2 border-dashed border-neutral-300 rounded-xl p-6 text-center hover:border-primary-400 transition-colors",children:[(0,a.jsx)("input",{type:"file",accept:".csv,text/csv",onChange:e=>{var t;let s=null===(t=e.target.files)||void 0===t?void 0:t[0];s&&("text/csv"===s.type||s.name.endsWith(".csv")?(M(s),z("")):x.ZP.error("Please select a CSV file"))},className:"hidden",id:"csv-upload"}),(0,a.jsxs)("label",{htmlFor:"csv-upload",className:"cursor-pointer",children:[(0,a.jsx)(ed.Z,{className:"w-8 h-8 text-neutral-400 mx-auto mb-2"}),(0,a.jsx)("p",{className:"text-sm text-neutral-600",children:T?T.name:"Click to upload CSV file"}),(0,a.jsx)("p",{className:"text-xs text-neutral-500 mt-1",children:"Support for CSV files with headers: Name, Phone, Email, Company"})]})]})]}),(0,a.jsx)("div",{className:"flex items-center justify-center",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"h-px bg-neutral-300 flex-1 w-16"}),(0,a.jsx)("span",{className:"text-sm text-neutral-500",children:"OR"}),(0,a.jsx)("div",{className:"h-px bg-neutral-300 flex-1 w-16"})]})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Paste contact data"}),(0,a.jsx)("textarea",{value:P,onChange:e=>{z(e.target.value),e.target.value.trim()&&M(null)},placeholder:"John Smith +1234567890\nJane Doe, +1987654321, jane@company.com, Acme Corp\n+1555123456\nMichael Johnson +1444555666",className:"input-field resize-none h-32",disabled:!!T}),(0,a.jsx)("p",{className:"text-xs text-neutral-500 mt-1",children:"Each contact should be on a separate line. Phone numbers will be automatically formatted."})]})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,a.jsx)("button",{type:"button",onClick:()=>{console.log("\uD83D\uDEAB Import cancel clicked"),C(!1)},className:"btn-secondary",children:"Cancel"}),(0,a.jsx)("button",{type:"button",onClick:e=>{e.preventDefault(),console.log("\uD83D\uDE80 Import button clicked",{disabled:I||!P.trim()&&!T,importing:I,hasData:!!P.trim(),hasFile:!!T}),er()},disabled:I||!P.trim()&&!T,className:"btn-primary",children:I?"Importing...":"Import Contacts"})]})]})]})})}),(0,a.jsx)(p.M,{children:k&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,a.jsxs)(n.E.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"card rounded-2xl p-6 w-full max-w-md shadow-2xl shadow-primary-500/20",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-text-primary",children:"Add Contact"}),(0,a.jsx)("button",{onClick:()=>D(!1),className:"p-2 hover:bg-bg-secondary rounded-lg transition-colors",children:"✕"})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-1",children:"First Name"}),(0,a.jsx)("input",{type:"text",value:Y.firstName,onChange:e=>G(t=>({...t,firstName:e.target.value})),className:"input-field",placeholder:"John"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-1",children:"Last Name"}),(0,a.jsx)("input",{type:"text",value:Y.lastName,onChange:e=>G(t=>({...t,lastName:e.target.value})),className:"input-field",placeholder:"Doe"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-1",children:"Phone Number *"}),(0,a.jsx)("input",{type:"tel",value:Y.phoneNumber,onChange:e=>G(t=>({...t,phoneNumber:e.target.value})),className:"input-field",placeholder:"+1 (555) 123-4567",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-1",children:"Email"}),(0,a.jsx)("input",{type:"email",value:Y.email,onChange:e=>G(t=>({...t,email:e.target.value})),className:"input-field",placeholder:"john@company.com"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-1",children:"Company"}),(0,a.jsx)("input",{type:"text",value:Y.company,onChange:e=>G(t=>({...t,company:e.target.value})),className:"input-field",placeholder:"Acme Corp"})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,a.jsx)("button",{type:"button",onClick:()=>{console.log("\uD83D\uDEAB Cancel button clicked"),D(!1)},className:"btn-secondary",children:"Cancel"}),(0,a.jsx)("button",{type:"button",onClick:e=>{e.preventDefault(),console.log("\uD83D\uDE80 Add contact button clicked",{disabled:!Y.phoneNumber.trim()}),$()},disabled:!Y.phoneNumber.trim(),className:"btn-primary",children:"Add Contact"})]})]})]})})}),(0,a.jsx)(p.M,{children:E&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,a.jsxs)(n.E.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"card rounded-2xl p-6 w-full max-w-md",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-text-primary",children:"Select Agent"}),(0,a.jsx)("button",{onClick:()=>A(!1),className:"p-2 hover:bg-neutral-100 rounded-lg transition-colors",children:"✕"})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("p",{className:"text-sm text-neutral-600",children:["Choose which agent will handle the outbound call",S.length>1?"s":""," to:"]}),(0,a.jsx)("div",{className:"bg-neutral-50 rounded-lg p-3",children:(0,a.jsx)("div",{className:"text-sm font-medium text-neutral-900",children:1===S.length?(()=>{let e=m.find(e=>e.id===S[0]);return e?"".concat(e.first_name||""," ").concat(e.last_name||"").trim()||e.phone_number:"Unknown contact"})():"".concat(S.length," selected contacts")})}),(0,a.jsx)("div",{className:"space-y-2",children:u.filter(e=>e.is_active&&e.phone_number).map(e=>(0,a.jsx)("button",{onClick:()=>{if(1===S.length){let t=m.find(e=>e.id===S[0]);t&&ee(t,e.id)}else es(e.id);A(!1)},className:"w-full text-left p-3 border border-neutral-200 rounded-lg hover:border-primary-300 hover:bg-primary-50 transition-colors",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium text-neutral-900",children:e.name}),(0,a.jsxs)("div",{className:"text-sm text-neutral-600",children:[W(e.voice_id)," • ",(0,l.un)(e.phone_number)]})]}),(0,a.jsx)(et.Z,{className:"w-5 h-5 text-primary-600"})]})},e.id))}),0===u.filter(e=>e.is_active&&e.phone_number).length&&(0,a.jsxs)("div",{className:"text-center py-6",children:[(0,a.jsx)(J.Z,{className:"w-12 h-12 text-warning-500 mx-auto mb-3"}),(0,a.jsx)("h3",{className:"font-medium text-neutral-900 mb-2",children:"No Active Agents"}),(0,a.jsx)("p",{className:"text-sm text-neutral-600 mb-4",children:"You need at least one active agent with a phone number to make outbound calls."}),(0,a.jsx)("button",{onClick:()=>t("agents"),className:"btn-primary text-sm",children:"Manage Agents"})]}),(0,a.jsx)("div",{className:"flex justify-end space-x-3 pt-4",children:(0,a.jsx)("button",{onClick:()=>A(!1),className:"btn-secondary",children:"Cancel"})})]})]})})}),(0,a.jsx)(eO,{contact:q,isOpen:V,onClose:()=>{H(!1),Q(null)},onSave:async()=>{await X(),H(!1),Q(null),x.ZP.success("Contact updated successfully")}})]})})}function eO(e){let{contact:t,isOpen:s,onClose:r,onSave:c}=e,[o,d]=(0,i.useState)({firstName:"",lastName:"",phoneNumber:"",email:"",company:""}),[m,u]=(0,i.useState)(!1);(0,i.useEffect)(()=>{t&&d({firstName:t.first_name||"",lastName:t.last_name||"",phoneNumber:t.phone_number||"",email:t.email||"",company:t.company||""})},[t]);let p=async()=>{if(t)try{u(!0);let e=await (0,l.k_)("edit-contact",{method:"POST",body:JSON.stringify({contactId:t.id,...o})});if(!e.success)throw Error(e.error||"Failed to update contact");await c()}catch(e){console.error("Error updating contact:",e),x.ZP.error("Failed to update contact")}finally{u(!1)}};return s&&t?(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,a.jsxs)(n.E.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"card rounded-2xl p-6 w-full max-w-md shadow-2xl shadow-primary-500/20",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-text-primary",children:"Edit Contact"}),(0,a.jsx)("button",{onClick:r,className:"p-2 hover:bg-bg-secondary rounded-lg transition-colors",children:"✕"})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-1",children:"First Name"}),(0,a.jsx)("input",{type:"text",value:o.firstName,onChange:e=>d(t=>({...t,firstName:e.target.value})),className:"input-field",placeholder:"John"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-1",children:"Last Name"}),(0,a.jsx)("input",{type:"text",value:o.lastName,onChange:e=>d(t=>({...t,lastName:e.target.value})),className:"input-field",placeholder:"Doe"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-1",children:"Phone Number *"}),(0,a.jsx)("input",{type:"tel",value:o.phoneNumber,onChange:e=>d(t=>({...t,phoneNumber:e.target.value})),className:"input-field",placeholder:"+1 (555) 123-4567",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-1",children:"Email"}),(0,a.jsx)("input",{type:"email",value:o.email,onChange:e=>d(t=>({...t,email:e.target.value})),className:"input-field",placeholder:"john@company.com"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-1",children:"Company"}),(0,a.jsx)("input",{type:"text",value:o.company,onChange:e=>d(t=>({...t,company:e.target.value})),className:"input-field",placeholder:"Acme Corp"})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,a.jsx)("button",{onClick:r,className:"btn-secondary",disabled:m,children:"Cancel"}),(0,a.jsx)("button",{onClick:p,className:"btn-primary",disabled:m||!o.phoneNumber.trim(),children:m?"Saving...":"Save Changes"})]})]})]})}):null}var eT=s(70525);function eL(e){var t;let{onNavigate:s}=e,{state:c,actions:d,dispatch:u}=(0,r.q)(),{profile:h,agents:g}=c,[b,f]=(0,i.useState)(!1),[v,N]=(0,i.useState)(null),[w,_]=(0,i.useState)(!1),[C,k]=(0,i.useState)(null),[D,S]=(0,i.useState)(!1),[Z,E]=(0,i.useState)(!1),[A,P]=(0,i.useState)([]),[z,I]=(0,i.useState)(null),[O,M]=(0,i.useState)(!1),[U,q]=(0,i.useState)(null),[Q,V]=(0,i.useState)(!1);(0,i.useEffect)(()=>{H()},[h]),(0,i.useEffect)(()=>{let e=()=>I(null);return window.addEventListener("click",e),()=>window.removeEventListener("click",e)},[]);let H=async()=>{if(null==h?void 0:h.organization_id)try{f(!0);let{data:e}=await l.OQ.from("agents").select("*").eq("organization_id",h.organization_id).order("created_at",{ascending:!1});u({type:"UPDATE_AGENTS",agents:e||[]})}catch(e){console.error("Error fetching agents:",e),x.ZP.error("Failed to load agents")}finally{f(!1)}},B=async e=>{try{let t=!e.is_active,{error:s}=await l.OQ.from("agents").update({is_active:t}).eq("id",e.id);if(s)throw s;await H(),x.ZP.success("Agent ".concat(t?"activated":"deactivated"))}catch(e){console.error("Error toggling agent status:",e),x.ZP.error("Failed to update agent status")}},K=e=>{navigator.clipboard.writeText(e),x.ZP.success("Phone number copied to clipboard")},Y=e=>e.phone_number?e.is_active?(0,a.jsx)(y.Z,{className:"w-5 h-5 text-success-500"}):(0,a.jsx)(F.Z,{className:"w-5 h-5 text-neutral-400"}):(0,a.jsx)(J.Z,{className:"w-5 h-5 text-warning-500"}),G=e=>e.phone_number?e.is_active?"Active":"Inactive":"No Phone Number",X=e=>0===e.total_calls?0:Math.round(e.successful_calls/e.total_calls*100),$=async e=>{try{V(!0);let{error:t}=await l.OQ.from("agents").delete().eq("id",e);if(t)throw t;x.ZP.success("Agent deleted successfully"),M(!1),q(null),await H()}catch(e){console.error("Error deleting agent:",e),x.ZP.error("Failed to delete agent")}finally{V(!1)}};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("h1",{className:"text-2xl sm:text-3xl font-bold text-text-primary truncate",children:"Support Agents"}),(0,a.jsx)("p",{className:"text-text-secondary text-sm sm:text-base mt-1 line-clamp-2 sm:line-clamp-none",children:"Manage your AI support agents and monitor their multi-channel performance"})]}),(0,a.jsxs)("button",{onClick:()=>s("setup"),className:"btn-primary w-full sm:w-auto flex items-center justify-center px-6 py-3",children:[(0,a.jsx)(em.Z,{className:"w-4 h-4 mr-2 flex-shrink-0"}),(0,a.jsx)("span",{className:"whitespace-nowrap",children:"Create New Agent"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6 items-stretch",children:[(0,a.jsx)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"card p-4 sm:p-6 flex flex-col h-full overflow-hidden",children:(0,a.jsxs)("div",{className:"flex flex-row items-start space-x-3 sm:space-x-4 flex-1",children:[(0,a.jsx)("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl flex-shrink-0 flex items-center justify-center shadow-lg",children:(0,a.jsx)(em.Z,{className:"w-5 h-5 sm:w-6 sm:h-6 text-white"})}),(0,a.jsxs)("div",{className:"flex-1 flex flex-col h-full min-w-0",children:[(0,a.jsx)("h3",{className:"text-base sm:text-lg font-semibold text-text-primary mb-1 sm:mb-2 text-left truncate",children:"Create New Agent"}),(0,a.jsx)("p",{className:"text-text-secondary text-xs sm:text-sm mb-4 sm:mb-6 text-left flex-1 line-clamp-2 md:line-clamp-3",children:"Set up a new AI support agent with customized personality and multi-channel capabilities"}),(0,a.jsx)("div",{className:"mt-auto flex justify-start",children:(0,a.jsxs)("button",{onClick:()=>s("setup"),className:"btn-primary !px-2 md:!px-4 lg:!px-6 !py-2 sm:!py-3 flex items-center justify-center text-[10px] lg:text-sm",children:[(0,a.jsx)(em.Z,{className:"w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2"}),(0,a.jsx)("span",{className:"whitespace-nowrap",children:"Create Agent"})]})})]})]})}),(0,a.jsx)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"card p-4 sm:p-6 flex flex-col h-full overflow-hidden",children:(0,a.jsxs)("div",{className:"flex flex-row items-start space-x-3 sm:space-x-4 flex-1",children:[(0,a.jsx)("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-br from-purple-500 to-blue-600 rounded-xl flex-shrink-0 flex items-center justify-center shadow-lg",children:(0,a.jsx)(T.Z,{className:"w-5 h-5 sm:w-6 sm:h-6 text-white"})}),(0,a.jsxs)("div",{className:"flex-1 flex flex-col h-full min-w-0",children:[(0,a.jsx)("h3",{className:"text-base sm:text-lg font-semibold text-text-primary mb-1 sm:mb-2 text-left truncate",children:"Chat with Kai"}),(0,a.jsx)("p",{className:"text-text-secondary text-xs sm:text-sm mb-4 sm:mb-6 text-left flex-1 line-clamp-2 md:line-clamp-3",children:"Create outbound communication strategies through AI-powered conversation"}),(0,a.jsx)("div",{className:"mt-auto flex justify-start",children:(0,a.jsxs)("button",{onClick:()=>E(!0),className:"btn-secondary !px-2 md:!px-4 lg:!px-6 !py-2 sm:!py-3 flex items-center justify-center text-[10px] lg:text-sm",children:[(0,a.jsx)(T.Z,{className:"w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2"}),(0,a.jsx)("span",{className:"whitespace-nowrap",children:"Strategy Chat"})]})})]})]})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-6",children:[(0,a.jsx)("div",{className:"kpi-card p-3 sm:p-6 translate-y-0",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"min-w-0",children:[(0,a.jsx)("p",{className:"kpi-title text-xs sm:text-base truncate",children:"Total Agents"}),(0,a.jsx)("p",{className:"kpi-value text-xl sm:text-3xl",children:g.length})]}),(0,a.jsx)("div",{className:"w-8 h-8 sm:w-12 sm:h-12 rounded-lg sm:rounded-xl flex-shrink-0 flex items-center justify-center bg-blue-500/10 ml-2",children:(0,a.jsx)(T.Z,{className:"w-4 h-4 sm:w-6 sm:h-6 text-blue-400"})})]})}),(0,a.jsx)("div",{className:"kpi-card p-3 sm:p-6 translate-y-0",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"min-w-0",children:[(0,a.jsx)("p",{className:"kpi-title text-xs sm:text-base truncate",children:"Active Now"}),(0,a.jsx)("p",{className:"kpi-value text-xl sm:text-3xl",children:g.filter(e=>e.is_active&&e.phone_number).length})]}),(0,a.jsx)("div",{className:"w-8 h-8 sm:w-12 sm:h-12 rounded-lg sm:rounded-xl flex-shrink-0 flex items-center justify-center bg-emerald-500/10 ml-2",children:(0,a.jsx)(y.Z,{className:"w-4 h-4 sm:w-6 sm:h-6 text-emerald-400"})})]})}),(0,a.jsx)("div",{className:"kpi-card p-3 sm:p-6 translate-y-0",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"min-w-0",children:[(0,a.jsx)("p",{className:"kpi-title text-xs sm:text-base truncate",children:"Total Calls"}),(0,a.jsx)("p",{className:"kpi-value text-xl sm:text-3xl",children:g.reduce((e,t)=>e+t.total_calls,0)})]}),(0,a.jsx)("div",{className:"w-8 h-8 sm:w-12 sm:h-12 rounded-lg sm:rounded-xl flex-shrink-0 flex items-center justify-center bg-amber-500/10 ml-2",children:(0,a.jsx)(et.Z,{className:"w-4 h-4 sm:w-6 sm:h-6 text-amber-400"})})]})}),(0,a.jsx)("div",{className:"kpi-card p-3 sm:p-6 translate-y-0",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"min-w-0",children:[(0,a.jsx)("p",{className:"kpi-title text-xs sm:text-base truncate",children:"Success Rate"}),(0,a.jsxs)("p",{className:"kpi-value text-xl sm:text-3xl",children:[g.length>0&&Math.round(g.reduce((e,t)=>e+t.successful_calls,0)/Math.max(g.reduce((e,t)=>e+t.total_calls,0),1)*100)||0,"%"]})]}),(0,a.jsx)("div",{className:"w-8 h-8 sm:w-12 sm:h-12 rounded-lg sm:rounded-xl flex-shrink-0 flex items-center justify-center bg-purple-500/10 ml-2",children:(0,a.jsx)(eT.Z,{className:"w-4 h-4 sm:w-6 sm:h-6 text-purple-400"})})]})})]}),(0,a.jsx)("div",{className:"space-y-4",children:b?(0,a.jsxs)("div",{className:"card p-8 text-center",children:[(0,a.jsx)("div",{className:"animate-spin w-8 h-8 border-4 border-primary-200 border-t-primary-600 rounded-full mx-auto"}),(0,a.jsx)("p",{className:"text-text-secondary mt-2",children:"Loading agents..."})]}):g.length>0?g.map((e,t)=>(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*t},className:"card hover:shadow-lg transition-all duration-200 p-3 sm:p-4 md:p-6",children:[(0,a.jsxs)("div",{className:"flex flex-row items-start justify-between gap-2 sm:gap-3",children:[(0,a.jsxs)("div",{className:"flex items-start space-x-2 sm:space-x-3 flex-1 min-w-0",children:[(0,a.jsx)("div",{className:"w-8 h-8 sm:w-10 sm:h-10 md:w-12 md:h-12 bg-primary-900/50 rounded-lg sm:rounded-xl flex-shrink-0 flex items-center justify-center border border-primary-500/20 shadow-inner",children:(0,a.jsx)(T.Z,{className:"w-4 h-4 sm:w-5 sm:h-5 md:w-6 md:h-6 text-primary-400"})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsxs)("div",{className:"flex items-center flex-wrap gap-x-2 gap-y-1 min-w-0",children:[(0,a.jsx)("h3",{className:"text-sm sm:text-base md:text-lg font-bold text-text-primary truncate",children:e.name}),e.agent_code&&(0,a.jsxs)("span",{className:"text-[10px] sm:text-xs md:text-sm text-primary-400 font-mono font-bold bg-primary-500/10 px-2 py-0.5 rounded border border-primary-500/20",children:["Code-",e.agent_code]}),(0,a.jsxs)("div",{className:"flex items-center space-x-1 flex-shrink-0 bg-bg-secondary px-1.5 py-0.5 rounded-full border border-bg-tertiary",children:[(0,a.jsx)(j.Z,{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 text-primary-400"}),(0,a.jsx)(R.Z,{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 text-emerald-400"}),(0,a.jsx)(o.Z,{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 text-purple-400"})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-1 flex-shrink-0",children:[Y(e),(0,a.jsx)("span",{className:"text-[10px] sm:text-xs md:text-sm font-medium ".concat(e.phone_number?e.is_active?"text-emerald-500":"text-text-tertiary":"text-red-500"),children:G(e)})]})]}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-x-2 sm:gap-x-3 gap-y-1 mt-1.5",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)(j.Z,{className:"w-3 h-3 text-text-tertiary"}),e.phone_number?(0,a.jsx)("button",{onClick:t=>{t.stopPropagation(),K(e.phone_number)},className:"text-[10px] sm:text-xs md:text-sm text-text-secondary hover:text-primary-400 transition-colors truncate max-w-[80px] sm:max-w-[120px]",title:"Click to copy",children:(0,l.un)(e.phone_number)}):(0,a.jsx)("span",{className:"text-[10px] sm:text-xs md:text-sm text-text-tertiary",children:"No phone"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)(L.Z,{className:"w-3 h-3 text-text-tertiary"}),(0,a.jsx)("span",{className:"text-[10px] sm:text-xs md:text-sm text-text-secondary truncate max-w-[60px] sm:max-w-[100px]",children:W(e.voice_id)})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)(et.Z,{className:"w-3 h-3 text-text-tertiary"}),(0,a.jsxs)("span",{className:"text-[10px] sm:text-xs md:text-sm text-text-secondary",children:[e.total_calls," calls"]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)(eT.Z,{className:"w-3 h-3 text-text-tertiary"}),(0,a.jsxs)("span",{className:"text-[10px] sm:text-xs md:text-sm text-text-secondary",children:[X(e),"% success"]})]})]})]})]}),(0,a.jsxs)("div",{className:"flex items-start space-x-0.5 sm:space-x-1 flex-shrink-0",children:[e.phone_number&&(0,a.jsx)("button",{onClick:()=>B(e),className:"p-1 sm:p-1.5 md:p-2 rounded-lg transition-colors ".concat(e.is_active?"text-red-500 hover:bg-red-500/10":"text-emerald-500 hover:bg-emerald-500/10"),title:e.is_active?"Deactivate Agent":"Activate Agent",children:e.is_active?(0,a.jsx)(ew.Z,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"}):(0,a.jsx)(e_.Z,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"})}),(0,a.jsx)("button",{onClick:()=>{N(e),_(!0),I(null)},className:"p-1 sm:p-1.5 md:p-2 text-text-tertiary hover:text-primary-400 hover:bg-primary-500/10 rounded-lg transition-colors",title:"View Details",children:(0,a.jsx)(m.Z,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"})}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("button",{onClick:t=>{t.stopPropagation(),I(z===e.id?null:e.id)},className:"p-1 sm:p-1.5 md:p-2 text-text-tertiary hover:text-text-primary hover:bg-bg-secondary rounded-lg transition-colors",title:"More Options",children:(0,a.jsx)(ef.Z,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"})}),z===e.id&&(0,a.jsxs)("div",{className:"absolute right-0 mt-2 w-48 bg-bg-tertiary border border-bg-tertiary rounded-xl shadow-2xl z-50 overflow-hidden py-1",children:[(0,a.jsxs)("button",{onClick:()=>{k(e),S(!0),I(null)},className:"w-full text-left px-4 py-2 text-sm text-text-secondary hover:bg-emerald-500 hover:text-white flex items-center space-x-2 transition-colors",children:[(0,a.jsx)(eh.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"Edit Agent"})]}),(0,a.jsxs)("button",{onClick:()=>{q(e),M(!0),I(null)},className:"w-full text-left px-4 py-2 text-sm text-red-500 hover:bg-red-500 hover:text-white flex items-center space-x-2 transition-colors",children:[(0,a.jsx)(eg.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"Delete Agent"})]})]})]})]})]}),e.business_objective&&(0,a.jsx)("div",{className:"mt-3 pt-3 border-t border-bg-secondary",children:(0,a.jsxs)("p",{className:"text-[10px] sm:text-xs md:text-sm text-text-secondary line-clamp-2",children:[(0,a.jsx)("strong",{className:"text-text-primary font-medium",children:"Objective:"})," ",e.business_objective]})})]},e.id)):(0,a.jsxs)("div",{className:"card p-12 text-center",children:[(0,a.jsx)(T.Z,{className:"w-16 h-16 text-neutral-300 mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-neutral-900 mb-2",children:"No agents configured yet"}),(0,a.jsx)("p",{className:"text-neutral-600 mb-6",children:"Create your first AI support agent to start handling customer requests across all channels"}),(0,a.jsxs)("button",{onClick:()=>s("dashboard"),className:"btn-primary flex items-center mx-auto",children:[(0,a.jsx)(em.Z,{className:"w-4 h-4 mr-2"}),"Create Your First Agent"]})]})}),(0,a.jsx)(p.M,{children:w&&v&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,a.jsxs)(n.E.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"card rounded-2xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto shadow-2xl shadow-primary-500/20",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-text-primary",children:"Agent Details"}),(0,a.jsx)("button",{onClick:()=>_(!1),className:"p-2 hover:bg-bg-secondary rounded-lg transition-colors",children:"✕"})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-1",children:"Agent Name"}),(0,a.jsx)("p",{className:"text-text-primary font-medium",children:v.name})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-1",children:"Voice"}),(0,a.jsx)("p",{className:"text-text-primary",children:W(v.voice_id)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-1",children:"Phone Number"}),(0,a.jsx)("p",{className:"text-text-primary",children:v.phone_number?(0,l.un)(v.phone_number):"Not assigned"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-1",children:"Status"}),(0,a.jsx)("p",{className:"font-medium ".concat(v.phone_number?v.is_active?"text-success-600":"text-neutral-400":"text-warning-600"),children:G(v)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-1",children:"Agent Code"}),(0,a.jsx)("p",{className:"text-text-primary font-mono font-semibold text-lg",children:v.agent_code||"Not assigned"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsx)("div",{className:"card",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-2xl font-bold text-primary-600",children:v.total_calls}),(0,a.jsx)("p",{className:"text-sm text-text-secondary",children:"Total Calls"})]})}),(0,a.jsx)("div",{className:"card",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsxs)("p",{className:"text-2xl font-bold text-success-600",children:[X(v),"%"]}),(0,a.jsx)("p",{className:"text-sm text-text-secondary",children:"Success Rate"})]})})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Business Objective"}),(0,a.jsx)("p",{className:"text-text-primary text-sm card-light p-3 rounded-lg",children:v.business_objective||"Not specified"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Target Audience"}),(0,a.jsx)("p",{className:"text-text-primary text-sm card-light p-3 rounded-lg",children:v.target_audience||"Not specified"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Value Proposition"}),(0,a.jsx)("p",{className:"text-text-primary text-sm card-light p-3 rounded-lg",children:v.value_proposition||"Not specified"})]})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,a.jsx)("button",{onClick:()=>_(!1),className:"btn-secondary",children:"Close"}),(0,a.jsxs)("button",{onClick:()=>{k(v),S(!0),_(!1)},className:"btn-primary flex items-center",children:[(0,a.jsx)(eh.Z,{className:"w-4 h-4 mr-2"}),"Edit Agent"]})]})]})]})})}),(0,a.jsx)(eM,{agent:C,isOpen:D,onClose:()=>{S(!1),k(null)},onSave:async()=>{await H(),S(!1),k(null),x.ZP.success("Agent updated successfully")}}),(0,a.jsx)(p.M,{children:O&&U&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,a.jsx)(n.E.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-bg-primary border border-bg-tertiary rounded-xl w-full max-w-md overflow-hidden shadow-xl",children:(0,a.jsxs)("div",{className:"p-6 text-center",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-red-500/10 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)(eg.Z,{className:"w-8 h-8 text-red-500"})}),(0,a.jsx)("h3",{className:"text-xl font-bold text-text-primary mb-2",children:"Delete Agent"}),(0,a.jsxs)("p",{className:"text-text-secondary mb-6",children:["Are you sure you want to delete ",(0,a.jsx)("span",{className:"font-semibold text-text-primary",children:U.name}),"? This action cannot be undone and all data associated with this agent will be permanently removed."]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsx)("button",{onClick:()=>{M(!1),q(null)},className:"btn-secondary",disabled:Q,children:"Cancel"}),(0,a.jsx)("button",{onClick:()=>$(U.id),className:"bg-red-500 hover:bg-red-600 text-white font-medium py-2 rounded-xl transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",disabled:Q,children:Q?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"animate-spin w-4 h-4 border-2 border-white/20 border-t-white rounded-full mr-2"}),"Deleting..."]}):"Delete Agent"})]})]})})})}),(0,a.jsx)(p.M,{children:Z&&(0,a.jsx)(n.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)(n.E.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-bg-primary border border-bg-tertiary rounded-xl w-full max-w-4xl max-h-[90vh] overflow-hidden shadow-xl flex flex-col",children:[(0,a.jsxs)("div",{className:"flex-shrink-0 flex items-center justify-between p-6 border-b border-bg-secondary",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"w-8 h-8 bg-gradient-to-br from-purple-500 to-blue-600 rounded-full flex items-center justify-center",children:(0,a.jsx)(T.Z,{className:"w-4 h-4 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-text-primary",children:"Controller Agent “Kai”"}),(0,a.jsx)("p",{className:"text-sm text-text-secondary",children:"Create outbound communication strategies"})]})]}),(0,a.jsx)("button",{onClick:()=>E(!1),className:"p-2 hover:bg-bg-secondary rounded-lg transition-colors",children:(0,a.jsx)(F.Z,{className:"w-5 h-5 text-text-secondary"})})]}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto",children:[(0,a.jsx)("div",{className:"p-6",children:(0,a.jsx)(el,{organizationId:(null==h?void 0:h.organization_id)||"",userId:(null===(t=c.user)||void 0===t?void 0:t.id)||"",onStrategyCreated:e=>{P(t=>[...t,e]),x.ZP.success("Strategy created successfully!")}})}),A.length>0&&(0,a.jsxs)("div",{className:"border-t border-bg-secondary p-6",children:[(0,a.jsx)("h4",{className:"text-lg font-semibold text-text-primary mb-4",children:"Created Strategies"}),(0,a.jsx)("div",{className:"space-y-3",children:A.map((e,t)=>{var s,r;return(0,a.jsx)("div",{className:"bg-bg-secondary p-4 rounded-lg",children:(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{className:"text-text-primary",children:"Target:"}),(0,a.jsx)("span",{className:"text-text-secondary ml-2",children:(null===(s=e.targetAudience)||void 0===s?void 0:s.join(", "))||"Not specified"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{className:"text-text-primary",children:"Frequency:"}),(0,a.jsx)("span",{className:"text-text-secondary ml-2",children:e.frequency||"Not specified"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{className:"text-text-primary",children:"Goals:"}),(0,a.jsx)("span",{className:"text-text-secondary ml-2",children:(null===(r=e.communicationGoals)||void 0===r?void 0:r.join(", "))||"Not specified"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{className:"text-text-primary",children:"Confidence:"}),(0,a.jsx)("span",{className:"text-text-secondary ml-2",children:e.confidence?Math.round(100*e.confidence)+"%":"N/A"})]})]})},t)})})]})]})]})})})]})}function eM(e){let{agent:t,isOpen:s,onClose:r,onSave:c}=e,[o,d]=(0,i.useState)({name:"",description:"",voiceId:"Savannah",businessObjective:"",targetAudience:"",keyPainPoints:"",valuePropositon:"",callToAction:"",firstMessage:"",voicemailMessage:"",endCallMessage:"",transcriberLanguage:"en"}),[m,u]=(0,i.useState)(!1);(0,i.useEffect)(()=>{t&&d({name:t.name||"",description:t.description||"",voiceId:t.voice_id||"Savannah",businessObjective:t.business_objective||"",targetAudience:t.target_audience||"",keyPainPoints:t.key_pain_points||"",valuePropositon:t.value_proposition||"",callToAction:t.call_to_action||"",firstMessage:t.first_message||"",voicemailMessage:t.voicemail_message||"",endCallMessage:t.end_call_message||"",transcriberLanguage:t.transcriber_language||"en"})},[t]);let p=async()=>{if(t)try{u(!0);let e=await (0,l.k_)("edit-agent",{method:"POST",body:JSON.stringify({agentId:t.id,...o})});if(!e.success)throw Error(e.error||"Failed to update agent");await c()}catch(e){console.error("Error updating agent:",e),x.ZP.error("Failed to update agent")}finally{u(!1)}};return s&&t?(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,a.jsxs)(n.E.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"card rounded-2xl p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto shadow-2xl shadow-primary-500/20",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-text-primary",children:"Edit Agent"}),(0,a.jsx)("button",{onClick:r,className:"p-2 hover:bg-bg-secondary rounded-lg transition-colors",children:"✕"})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-1",children:"Agent Name *"}),(0,a.jsx)("input",{type:"text",value:o.name,onChange:e=>d(t=>({...t,name:e.target.value})),className:"input-field",placeholder:"Enter agent name",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-1",children:"Voice"}),(0,a.jsx)("select",{value:o.voiceId,onChange:e=>{let s=e.target.value,a=G.find(e=>e.id===s),r=(null==a?void 0:a.accent)==="Hindi";d(e=>{if(r){let a=/[\u0900-\u097F]/.test(e.firstMessage);if(e.firstMessage&&!a&&/^[a-z\s.,!?'-]+$/i.test(e.firstMessage.trim())||!e.firstMessage){let a=e.name||(null==t?void 0:t.name)||"Agent";return{...e,voiceId:s,firstMessage:"नमस्ते! मैं ".concat(a," हूं। मैं आपकी कैसे मदद कर सकता हूं?"),transcriberLanguage:"hi"}}}return{...e,voiceId:s}})},className:"input-field",children:G.map(e=>(0,a.jsx)("option",{value:e.id,children:W(e.id)},e.id))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-1",children:"Transcriber Language"}),(0,a.jsxs)("select",{value:o.transcriberLanguage,onChange:e=>d(t=>({...t,transcriberLanguage:e.target.value})),className:"input-field",children:[(0,a.jsx)("option",{value:"en",children:"English"}),(0,a.jsx)("option",{value:"hi",children:"Hindi"}),(0,a.jsx)("option",{value:"es",children:"Spanish"}),(0,a.jsx)("option",{value:"fr",children:"French"}),(0,a.jsx)("option",{value:"de",children:"German"}),(0,a.jsx)("option",{value:"it",children:"Italian"}),(0,a.jsx)("option",{value:"pt",children:"Portuguese"}),(0,a.jsx)("option",{value:"ja",children:"Japanese"}),(0,a.jsx)("option",{value:"ko",children:"Korean"}),(0,a.jsx)("option",{value:"zh",children:"Chinese"})]}),(0,a.jsx)("p",{className:"text-xs text-text-secondary mt-1",children:"Select the language for speech recognition and transcription during calls."})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-1",children:"Description"}),(0,a.jsx)("textarea",{value:o.description,onChange:e=>d(t=>({...t,description:e.target.value})),className:"input-field resize-none h-20",placeholder:"Brief description of this agent's purpose..."})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-text-primary",children:"Business Context"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-1",children:"Business Objective"}),(0,a.jsx)("textarea",{value:o.businessObjective,onChange:e=>d(t=>({...t,businessObjective:e.target.value})),className:"input-field resize-none h-20",placeholder:"What is the main goal of your business?"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-1",children:"Target Audience"}),(0,a.jsx)("textarea",{value:o.targetAudience,onChange:e=>d(t=>({...t,targetAudience:e.target.value})),className:"input-field resize-none h-20",placeholder:"Who are your ideal customers?"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-1",children:"Key Pain Points"}),(0,a.jsx)("textarea",{value:o.keyPainPoints,onChange:e=>d(t=>({...t,keyPainPoints:e.target.value})),className:"input-field resize-none h-20",placeholder:"What problems does your business solve?"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-1",children:"Value Proposition"}),(0,a.jsx)("textarea",{value:o.valuePropositon,onChange:e=>d(t=>({...t,valuePropositon:e.target.value})),className:"input-field resize-none h-20",placeholder:"What unique value do you provide?"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-1",children:"Call to Action"}),(0,a.jsx)("textarea",{value:o.callToAction,onChange:e=>d(t=>({...t,callToAction:e.target.value})),className:"input-field resize-none h-20",placeholder:"What should customers do next?"})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-text-primary",children:"Call Messages"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-1",children:"First Message (Introduction)"}),(0,a.jsx)("input",{type:"text",value:o.firstMessage,onChange:e=>d(t=>({...t,firstMessage:e.target.value})),className:"input-field",placeholder:"Hi there, my name is [Agent Name], from [Company]. How are you today?"}),(()=>{let e=G.find(e=>e.id===o.voiceId),t=(null==e?void 0:e.accent)==="Hindi",s=/[\u0900-\u097F]/.test(o.firstMessage),r=o.firstMessage&&!s&&/^[a-z\s.,!?'-]+$/i.test(o.firstMessage.trim());return t&&r?(0,a.jsxs)("div",{className:"mt-2 p-2 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded text-xs",children:[(0,a.jsx)("p",{className:"text-yellow-800 dark:text-yellow-200 font-medium",children:"⚠️ Language Mismatch"}),(0,a.jsx)("p",{className:"text-yellow-700 dark:text-yellow-300 mt-1",children:"You've selected a Hindi voice but your first message is in English. Update the first message to Hindi for consistent voice experience."}),(0,a.jsx)("p",{className:"text-yellow-600 dark:text-yellow-400 mt-1 italic",children:'Example: "नमस्ते! मैं [Agent Name] हूं, [Company] से। आप कैसे हैं?"'})]}):(0,a.jsx)("p",{className:"text-xs text-text-secondary mt-1",children:"This is the first thing your agent will say when answering calls."})})()]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-1",children:"Voicemail Message"}),(0,a.jsx)("input",{type:"text",value:o.voicemailMessage,onChange:e=>d(t=>({...t,voicemailMessage:e.target.value})),className:"input-field",placeholder:"Hello! This is [Agent Name] from [Company]..."})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-1",children:"End Call Message"}),(0,a.jsx)("input",{type:"text",value:o.endCallMessage,onChange:e=>d(t=>({...t,endCallMessage:e.target.value})),className:"input-field",placeholder:"Thank you for your time today. Have a wonderful day!"})]})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,a.jsx)("button",{onClick:r,className:"btn-secondary",disabled:m,children:"Cancel"}),(0,a.jsx)("button",{onClick:p,className:"btn-primary",disabled:m||!o.name.trim(),children:m?"Saving...":"Save Changes"})]})]})]})}):null}var eR=s(95252),eU=s(47625),eq=s(77031),eQ=s(56940),eV=s(97059),eH=s(62994),eB=s(8147),eK=s(31699),eJ=s(75169),eY=s(3574),eG=s(20407);function eW(e){let{onNavigate:t}=e,{state:s}=(0,r.q)(),{profile:c,subscription:o}=s,[d,m]=(0,i.useState)(!0),[x,u]=(0,i.useState)("7d"),[p,h]=(0,i.useState)(null),[g,b]=(0,i.useState)([]),[y,f]=(0,i.useState)([]),[j,v]=(0,i.useState)([]),[N,w]=(0,i.useState)(null);(0,i.useEffect)(()=>{(null==c?void 0:c.organization_id)&&_()},[c,x]);let _=async()=>{try{m(!0);let e=parseInt(x.replace("d","")),t=new Date;t.setDate(t.getDate()-e+1);let{data:s,error:a}=await l.OQ.from("calls").select("\n          id,\n          outcome,\n          duration_seconds,\n          cost_usd,\n          started_at,\n          agent_id,\n          agents (\n            id,\n            name\n          )\n        ").eq("organization_id",null==c?void 0:c.organization_id).gte("started_at",t.toISOString()).not("outcome","is",null).order("started_at",{ascending:!0});if(a)throw Error("Failed to fetch calls data: ".concat(a.message));let r=Array.isArray(s)?s:[],{data:i}=await l.OQ.from("subscriptions").select("credits_included, credits_used").eq("organization_id",null==c?void 0:c.organization_id).single(),n=r.length,o=r.filter(e=>"success"===e.outcome).length,d=r.reduce((e,t)=>e+(0,l.XF)(t.duration_seconds||0),0),u=r.reduce((e,t)=>e+(t.cost_usd||0),0),p=((null==i?void 0:i.credits_included)||0)-((null==i?void 0:i.credits_used)||0);h({totalCalls:n,successfulCalls:o,failedCalls:n-o,totalCredits:d,averageDuration:n>0?Math.round(r.reduce((e,t)=>e+(t.duration_seconds||0),0)/n):0,successRate:n>0?Math.round(o/n*100):0,costTotal:u,avgCostPerCall:n>0?u/n:0,creditsRemaining:p});let g=new Map;r.forEach(e=>{let t=new Date(e.started_at).toLocaleDateString(),s=g.get(t)||{date:t,calls:0,successful:0,minutes:0,cost:0};s.calls+=1,"success"===e.outcome&&(s.successful+=1),s.minutes+=Math.round((e.duration_seconds||0)/60),s.cost+=e.cost_usd||0,g.set(t,s)}),b(Array.from(g.values()).slice(-7));let y=new Map;r.forEach(e=>{let t=(Array.isArray(e.agents)?e.agents:e.agents?[e.agents]:[])[0]||null,s=(null==t?void 0:t.id)||e.agent_id||"unknown",a=(null==t?void 0:t.name)||"Unknown Agent",r=y.get(s)||{agentId:s,agentName:a,totalCalls:0,successfulCalls:0,successRate:0,avgDuration:0,costTotal:0};r.totalCalls+=1,"success"===e.outcome&&(r.successfulCalls+=1),r.avgDuration=(r.avgDuration*(r.totalCalls-1)+(e.duration_seconds||0))/r.totalCalls,r.successRate=Math.round(r.successfulCalls/r.totalCalls*100),r.costTotal+=e.cost_usd||0,y.set(s,r)}),f(Array.from(y.values()));let j=new Map,N={success:"#10b981",failure:"#ef4444",no_answer:"#f59e0b",busy:"#8b5cf6",voicemail:"#3b82f6",in_progress:"#6b7280"};r.forEach(e=>{let t=e.outcome||"unknown",s=j.get(t)||{count:0,color:"#6b7280"};s.count+=1,s.color=N[t]||"#6b7280",j.set(t,s)});let w=Array.from(j.entries()).map(e=>{let[t,s]=e;return{name:t&&"string"==typeof t?t.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()):"Unknown",value:s.count,percentage:n>0?Math.round(s.count/n*100):0,color:s.color}});v(w)}catch(e){console.error("Error fetching reports data:",e)}finally{m(!1)}},C=[{title:"Total Calls",value:(null==p?void 0:p.totalCalls)||0,icon:et.Z,bgColor:"bg-blue-500/10",iconColor:"text-blue-500",change:"+12% vs last period"},{title:"Success Rate",value:"".concat((null==p?void 0:p.successRate)||0,"%"),icon:H.Z,bgColor:"bg-emerald-500/10",iconColor:"text-emerald-500",change:"+5% vs last period"},{title:"Total Credits",value:(0,l.Hf)((null==p?void 0:p.totalCredits)||0),icon:eo.Z,bgColor:"bg-amber-500/10",iconColor:"text-amber-500",change:"".concat((0,l.Hf)((null==p?void 0:p.creditsRemaining)||0)," remaining")},{title:"Total Cost",value:(0,l.xG)((null==p?void 0:p.costTotal)||0),icon:eR.Z,bgColor:"bg-rose-500/10",iconColor:"text-rose-500",change:"".concat((0,l.xG)((null==p?void 0:p.avgCostPerCall)||0)," avg per call")}];return d?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsx)("h1",{className:"text-3xl font-bold text-text-primary",children:"Reports"})}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[1,2,3,4].map(e=>(0,a.jsxs)("div",{className:"card animate-pulse",children:[(0,a.jsx)("div",{className:"h-4 bg-neutral-200 rounded w-1/2 mb-4"}),(0,a.jsx)("div",{className:"h-8 bg-neutral-200 rounded w-1/3 mb-2"}),(0,a.jsx)("div",{className:"h-3 bg-neutral-200 rounded w-1/4"})]},e))})]}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-text-primary",children:"Reports & Analytics"}),(0,a.jsx)("p",{className:"text-text-secondary mt-1",children:"Track performance and analyze your AI voice agent metrics"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsxs)("select",{value:x,onChange:e=>u(e.target.value),className:"input-field",children:[(0,a.jsx)("option",{value:"7d",children:"Last 7 days"}),(0,a.jsx)("option",{value:"30d",children:"Last 30 days"}),(0,a.jsx)("option",{value:"90d",children:"Last 90 days"})]}),(0,a.jsxs)("button",{className:"btn-secondary flex items-center",children:[(0,a.jsx)(eC.Z,{className:"w-4 h-4 mr-2"}),"Export"]})]})]}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:C.map((e,t)=>{let s=e.icon;return(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*t},className:"card",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center ".concat(e.bgColor),children:(0,a.jsx)(s,{className:"w-6 h-6 ".concat(e.iconColor)})}),(0,a.jsx)("div",{className:"text-right",children:(0,a.jsx)(eT.Z,{className:"w-4 h-4 text-accent-success mb-1"})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-text-secondary mb-1",children:e.title}),(0,a.jsx)("p",{className:"text-2xl font-bold text-text-primary mb-1",children:e.value}),(0,a.jsx)("p",{className:"text-xs text-text-tertiary",children:e.change})]})]},e.title)})}),(0,a.jsxs)("div",{className:"grid lg:grid-cols-2 gap-6",children:[(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"card",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("h2",{className:"text-lg font-bold text-neutral-900",children:"Daily Performance"}),(0,a.jsxs)("div",{className:"flex items-center space-x-4 text-sm",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"w-3 h-3 bg-primary-500 rounded-full"}),(0,a.jsx)("span",{className:"text-neutral-600",children:"Total Calls"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"w-3 h-3 bg-success-500 rounded-full"}),(0,a.jsx)("span",{className:"text-neutral-600",children:"Successful"})]})]})]}),(0,a.jsx)("div",{className:"h-64",children:(0,a.jsx)(eU.h,{width:"100%",height:"100%",children:(0,a.jsxs)(eq.v,{data:g,children:[(0,a.jsx)(eQ.q,{strokeDasharray:"3 3",stroke:"#f3f4f6"}),(0,a.jsx)(eV.K,{dataKey:"date",stroke:"#6b7280",fontSize:12}),(0,a.jsx)(eH.B,{stroke:"#6b7280",fontSize:12}),(0,a.jsx)(eB.u,{contentStyle:{backgroundColor:"#1f2937",border:"1px solid #374151",borderRadius:"8px",boxShadow:"0 10px 15px -3px rgba(0, 0, 0, 0.3)",color:"#f9fafb"}}),(0,a.jsx)(eK.$,{dataKey:"calls",fill:"#0ea5e9",radius:[4,4,0,0]}),(0,a.jsx)(eK.$,{dataKey:"successful",fill:"#22c55e",radius:[4,4,0,0]})]})})})]}),(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},className:"card",children:[(0,a.jsx)("div",{className:"flex items-center justify-between mb-6",children:(0,a.jsx)("h2",{className:"text-lg font-bold text-neutral-900",children:"Call Outcomes"})}),(0,a.jsx)("div",{className:"h-64",children:(0,a.jsx)(eU.h,{width:"100%",height:"100%",children:(0,a.jsxs)(eJ.u,{children:[(0,a.jsx)(eY.b,{data:j,cx:"50%",cy:"50%",labelLine:!1,label:e=>{let{name:t,percentage:s}=e;return"".concat(t,": ").concat(s,"%")},outerRadius:80,fill:"#8884d8",dataKey:"value",children:j.map((e,t)=>(0,a.jsx)(eG.b,{fill:e.color},"cell-".concat(t)))}),(0,a.jsx)(eB.u,{contentStyle:{backgroundColor:"#1f2937",border:"1px solid #374151",borderRadius:"8px",boxShadow:"0 10px 15px -3px rgba(0, 0, 0, 0.3)",color:"#f9fafb"}})]})})}),(0,a.jsx)("div",{className:"grid grid-cols-2 gap-4 mt-4",children:j.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:e.color}}),(0,a.jsx)("span",{className:"text-sm text-neutral-600",children:e.name}),(0,a.jsx)("span",{className:"text-sm font-medium text-neutral-900",children:e.value})]},e.name))})]})]}),(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6},className:"card",children:[(0,a.jsx)("div",{className:"flex items-center justify-between mb-6",children:(0,a.jsx)("h2",{className:"text-lg font-bold text-text-primary",children:"Agent Performance"})}),y.length>0?(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{className:"bg-bg-secondary border-b border-border-subtle",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"text-left py-3 px-4 font-medium text-text-primary",children:"Agent"}),(0,a.jsx)("th",{className:"text-left py-3 px-4 font-medium text-text-primary",children:"Total Calls"}),(0,a.jsx)("th",{className:"text-left py-3 px-4 font-medium text-text-primary",children:"Successful"}),(0,a.jsx)("th",{className:"text-left py-3 px-4 font-medium text-text-primary",children:"Success Rate"}),(0,a.jsx)("th",{className:"text-left py-3 px-4 font-medium text-text-primary",children:"Avg Duration"}),(0,a.jsx)("th",{className:"text-left py-3 px-4 font-medium text-text-primary",children:"Total Cost"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-border-subtle",children:y.map((e,t)=>(0,a.jsxs)("tr",{className:"hover:bg-bg-secondary",children:[(0,a.jsx)("td",{className:"py-3 px-4 font-medium text-text-primary",children:e.agentName}),(0,a.jsx)("td",{className:"py-3 px-4 text-text-secondary",children:e.totalCalls}),(0,a.jsx)("td",{className:"py-3 px-4 text-text-secondary",children:e.successfulCalls}),(0,a.jsx)("td",{className:"py-3 px-4",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"flex-1 bg-neutral-700 rounded-full h-2",children:(0,a.jsx)("div",{className:"bg-green-500 h-2 rounded-full",style:{width:"".concat(e.successRate,"%")}})}),(0,a.jsxs)("span",{className:"text-sm font-medium text-text-primary",children:[e.successRate,"%"]})]})}),(0,a.jsx)("td",{className:"py-3 px-4 text-text-secondary",children:(0,l.LU)(Math.round(e.avgDuration))}),(0,a.jsx)("td",{className:"py-3 px-4 text-text-secondary",children:(0,l.xG)(e.costTotal)})]},e.agentName))})]})}):(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)(M.Z,{className:"w-16 h-16 text-neutral-600 mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-text-primary mb-2",children:"No Performance Data"}),(0,a.jsx)("p",{className:"text-text-secondary mb-1",children:"No agent performance data available for the selected period"}),(0,a.jsx)("p",{className:"text-sm text-text-tertiary",children:"Data will appear after your agents make calls"})]})]}),(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.7},className:"card",children:[(0,a.jsx)("div",{className:"flex items-center justify-between mb-6",children:(0,a.jsx)("h2",{className:"text-lg font-bold text-text-primary",children:"Usage & Consumption"})}),(0,a.jsxs)("div",{className:"grid md:grid-cols-3 gap-6",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-3xl font-bold text-blue-500 mb-2",children:(0,l.Hf)((null==o?void 0:o.credits_used)||0)}),(0,a.jsx)("p",{className:"text-sm text-text-secondary",children:"Credits Used"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-3xl font-bold text-green-500 mb-2",children:(0,l.Hf)((null==p?void 0:p.creditsRemaining)||0)}),(0,a.jsx)("p",{className:"text-sm text-text-secondary",children:"Credits Remaining"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-3xl font-bold text-yellow-500 mb-2",children:(0,l.xG)((null==p?void 0:p.costTotal)||0)}),(0,a.jsx)("p",{className:"text-sm text-text-secondary",children:"Total Cost"})]})]}),o&&(0,a.jsxs)("div",{className:"mt-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("span",{className:"text-sm text-text-secondary",children:"Usage Progress"}),(0,a.jsxs)("span",{className:"text-sm font-medium text-text-primary",children:[(null==o?void 0:o.credits_included)?Math.round((o.credits_used||0)/o.credits_included*100):0,"%"]})]}),(0,a.jsx)("div",{className:"w-full bg-neutral-700 rounded-full h-3",children:(0,a.jsx)("div",{className:"h-3 rounded-full transition-all duration-300 ".concat(o&&o.credits_used/o.credits_included>.8?"bg-red-500":o&&o.credits_used/o.credits_included>.6?"bg-yellow-500":"bg-green-500"),style:{width:(null==o?void 0:o.credits_included)?"".concat(Math.min((o.credits_used||0)/o.credits_included*100,100),"%"):"0%"}})})]})]})]})}function eX(e){let{stats:t,loading:s=!1,className:r=""}=e;if(s)return(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 ".concat(r),children:[void 0,void 0,void 0,void 0].map((e,t)=>(0,a.jsx)("div",{className:"card p-6 animate-pulse",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-gray-200 rounded-xl"}),(0,a.jsxs)("div",{className:"ml-4 space-y-2",children:[(0,a.jsx)("div",{className:"h-4 bg-gray-200 rounded w-20"}),(0,a.jsx)("div",{className:"h-6 bg-gray-200 rounded w-16"})]})]})},t))});let i=[{title:"Total Calls",value:t.total_calls,icon:j.Z,color:"blue",bgColor:"bg-blue-500",iconColor:"text-blue-200"},{title:"Success Rate",value:"".concat(Math.round(t.success_rate),"%"),icon:eT.Z,color:"emerald",bgColor:"bg-emerald-500",iconColor:"text-emerald-200"},{title:"Total Credits",value:(0,l.Hf)(t.total_credits),icon:Q.Z,color:"amber",bgColor:"bg-amber-500",iconColor:"text-amber-200"},{title:"Total Cost",value:(0,l.xG)(t.total_cost),icon:eR.Z,color:"rose",bgColor:"bg-rose-500",iconColor:"text-rose-200"}];return void 0!==t.total_contacts&&i.splice(3,0,{title:"Total Contacts",value:t.total_contacts,icon:L.Z,color:"purple",bgColor:"bg-purple-500/10",iconColor:"text-purple-500"}),void 0!==t.active_agents&&i.splice(4,0,{title:"Active Agents",value:t.active_agents,icon:T.Z,color:"cyan",bgColor:"bg-cyan-500/10",iconColor:"text-cyan-500"}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-".concat(Math.min(i.length,4)," gap-6 ").concat(r),children:i.map((e,t)=>{let s=e.icon;return(0,a.jsx)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*t},className:"card p-6",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"w-12 h-12 ".concat(e.bgColor," rounded-xl flex items-center justify-center"),children:(0,a.jsx)(s,{className:"w-6 h-6 ".concat(e.iconColor)})}),(0,a.jsxs)("div",{className:"ml-4",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-text-secondary",children:e.title}),(0,a.jsx)("p",{className:"text-2xl font-bold text-text-primary",children:e.value})]})]})},e.title)})})}function e$(e){let{onNavigate:t}=e,[s,r]=(0,i.useState)([]),[c,o]=(0,i.useState)(!0),[d,m]=(0,i.useState)(""),[u,p]=(0,i.useState)({total_calls:0,successful_calls:0,total_credits:0,total_cost:0,success_rate:0});(0,i.useEffect)(()=>{h()},[]);let h=async()=>{try{o(!0);let{data:e,error:t}=await l.OQ.from("calls").select("\n          *,\n          agents!inner(id, name, phone_number),\n          contacts(id, first_name, last_name, phone_number),\n          call_transcripts(full_transcript, messages)\n        ").order("started_at",{ascending:!1}).limit(100);if(t){console.error("Error fetching calls:",t),x.ZP.error("Failed to load call history");return}let s=(e||[]).map(e=>{var t,s,a;return{id:e.id,vapi_call_id:e.vapi_call_id,direction:e.direction,outcome:e.outcome,duration_seconds:e.duration_seconds,started_at:e.started_at,ended_at:e.ended_at,cost_usd:e.cost_usd,summary:e.summary,recording_url:e.recording_url,agent_name:(null===(t=e.agents)||void 0===t?void 0:t.name)||"Unknown Agent",contact_name:e.contacts&&"".concat(e.contacts.first_name||""," ").concat(e.contacts.last_name||"").trim()||"Unknown Contact",contact_phone:null===(s=e.contacts)||void 0===s?void 0:s.phone_number,from_number:e.from_number,to_number:e.to_number,created_at:e.created_at,transcript:(null===(a=e.call_transcripts)||void 0===a?void 0:a[0])?{full_transcript:e.call_transcripts[0].full_transcript,messages:e.call_transcripts[0].messages}:void 0}});if(r(s),s.length>0){let e=s.length,t=s.filter(e=>"success"===e.outcome).length,a=s.reduce((e,t)=>e+(0,l.XF)(t.duration_seconds),0),r=s.reduce((e,t)=>e+(t.cost_usd||0),0);p({total_calls:e,successful_calls:t,total_credits:a,total_cost:r,success_rate:t/e*100})}}catch(e){console.error("Error in fetchCalls:",e),x.ZP.error("Failed to load call history")}finally{o(!1)}},g=s.filter(e=>{var t,s,a;return!d||(null===(t=e.summary)||void 0===t?void 0:t.toLowerCase().includes(d.toLowerCase()))||(null===(s=e.contact_name)||void 0===s?void 0:s.toLowerCase().includes(d.toLowerCase()))||(null===(a=e.agent_name)||void 0===a?void 0:a.toLowerCase().includes(d.toLowerCase()))});return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-text-primary",children:"Conversations"}),(0,a.jsx)("p",{className:"text-text-secondary mt-1",children:"View and analyze all customer interactions (currently showing voice calls)"})]}),(0,a.jsxs)("button",{onClick:h,className:"btn-secondary flex items-center",children:[(0,a.jsx)(S.Z,{className:"w-4 h-4 mr-2"}),"Refresh"]})]}),(0,a.jsx)(eX,{stats:u,loading:c}),(0,a.jsx)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"card p-6",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(ex.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-text-tertiary w-4 h-4"}),(0,a.jsx)("input",{type:"text",placeholder:"Search by contact, agent, or summary...",value:d,onChange:e=>m(e.target.value),className:"input-field pl-10"})]})}),(0,a.jsx)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},children:(0,a.jsx)(ez,{calls:g,loading:c,onRefresh:h,showContact:!0,showAgent:!0,variant:"full"})}),!c&&0===s.length&&(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center py-12",children:[(0,a.jsx)(j.Z,{className:"mx-auto h-12 w-12 text-text-tertiary mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-text-primary mb-2",children:"No calls yet"}),(0,a.jsx)("p",{className:"text-text-secondary mb-6",children:"Your call history will appear here once you start making calls with your voice agents."}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[(0,a.jsx)("button",{onClick:()=>t("agents"),className:"btn-primary",children:"View Agents"}),(0,a.jsx)("button",{onClick:()=>t("contacts"),className:"btn-secondary",children:"Manage Contacts"})]})]})]})}var e0=s(63639),e1=s(10407),e2=s(98420);function e4(e){var t,s,n,c,d,m,x;let{onUpdate:u}=e,{state:p,actions:h}=(0,r.q)(),[g,b]=(0,i.useState)(!1),[f,v]=(0,i.useState)(!1),[N,w]=(0,i.useState)(""),[_,C]=(0,i.useState)(""),[k,D]=(0,i.useState)({first_name:(null===(t=p.profile)||void 0===t?void 0:t.first_name)||"",last_name:(null===(s=p.profile)||void 0===s?void 0:s.last_name)||"",phone_number:(null===(n=p.profile)||void 0===n?void 0:n.phone_number)||""}),S=async()=>{if(p.user&&p.profile){v(!0),C(""),w("");try{let{error:e}=await l.OQ.from("user_profiles").update({first_name:k.first_name,last_name:k.last_name,phone_number:k.phone_number,updated_at:new Date().toISOString()}).eq("id",p.user.id);if(e)throw e;await h.fetchUserData(),w("Profile updated successfully!"),b(!1),setTimeout(()=>w(""),3e3),u&&u()}catch(e){console.error("Error updating profile:",e),C(e.message||"Failed to update profile")}finally{v(!1)}}};return(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"flex items-center justify-between mb-6",children:!g&&(0,a.jsx)("button",{onClick:()=>b(!0),className:"px-4 py-2 text-sm font-medium text-primary-600 border border-primary-600 rounded-lg hover:bg-primary-50 transition-colors",children:"Edit Profile"})}),N&&(0,a.jsxs)("div",{className:"mb-4 p-3 bg-success-100 border border-success-300 rounded-lg flex items-center space-x-2",children:[(0,a.jsx)(y.Z,{className:"w-5 h-5 text-success-600"}),(0,a.jsx)("span",{className:"text-sm text-success-700",children:N})]}),_&&(0,a.jsx)("div",{className:"mb-4 p-3 bg-error-100 border border-error-300 rounded-lg",children:(0,a.jsx)("span",{className:"text-sm text-error-700",children:_})}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"flex items-center space-x-2 text-sm font-medium text-text-secondary mb-2",children:[(0,a.jsx)(o.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"Email Address"})]}),(0,a.jsx)("div",{className:"px-4 py-3 bg-bg-tertiary rounded-lg text-text-primary border border-bg-tertiary",children:null===(c=p.user)||void 0===c?void 0:c.email}),(0,a.jsx)("p",{className:"mt-1 text-xs text-text-tertiary",children:"Email address cannot be changed here"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"First Name"}),g?(0,a.jsx)("input",{type:"text",value:k.first_name,onChange:e=>D({...k,first_name:e.target.value}),className:"w-full px-4 py-3 bg-bg-primary border border-bg-tertiary rounded-lg text-text-primary focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Enter your first name"}):(0,a.jsx)("div",{className:"px-4 py-3 bg-bg-tertiary rounded-lg text-text-primary border border-bg-tertiary",children:(null===(d=p.profile)||void 0===d?void 0:d.first_name)||"Not set"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Last Name"}),g?(0,a.jsx)("input",{type:"text",value:k.last_name,onChange:e=>D({...k,last_name:e.target.value}),className:"w-full px-4 py-3 bg-bg-primary border border-bg-tertiary rounded-lg text-text-primary focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Enter your last name"}):(0,a.jsx)("div",{className:"px-4 py-3 bg-bg-tertiary rounded-lg text-text-primary border border-bg-tertiary",children:(null===(m=p.profile)||void 0===m?void 0:m.last_name)||"Not set"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"flex items-center space-x-2 text-sm font-medium text-text-secondary mb-2",children:[(0,a.jsx)(j.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"Phone Number"})]}),g?(0,a.jsx)("input",{type:"tel",value:k.phone_number,onChange:e=>D({...k,phone_number:e.target.value}),className:"w-full px-4 py-3 bg-bg-primary border border-bg-tertiary rounded-lg text-text-primary focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"+1234567890"}):(0,a.jsx)("div",{className:"px-4 py-3 bg-bg-tertiary rounded-lg text-text-primary border border-bg-tertiary",children:(null===(x=p.profile)||void 0===x?void 0:x.phone_number)||"Not set"})]}),g&&(0,a.jsxs)("div",{className:"flex space-x-3 pt-4",children:[(0,a.jsx)("button",{onClick:S,disabled:f,className:"flex-1 flex items-center justify-center space-x-2 px-4 py-3 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:f?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ea.Z,{className:"w-5 h-5 animate-spin"}),(0,a.jsx)("span",{children:"Saving..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(eb.Z,{className:"w-5 h-5"}),(0,a.jsx)("span",{children:"Save Changes"})]})}),(0,a.jsx)("button",{onClick:()=>{var e,t,s;D({first_name:(null===(e=p.profile)||void 0===e?void 0:e.first_name)||"",last_name:(null===(t=p.profile)||void 0===t?void 0:t.last_name)||"",phone_number:(null===(s=p.profile)||void 0===s?void 0:s.phone_number)||""}),b(!1),C("")},disabled:f,className:"px-4 py-3 border border-bg-tertiary text-text-secondary rounded-lg hover:bg-bg-tertiary transition-colors disabled:opacity-50",children:"Cancel"})]})]})]})}var e5=s(5005),e3=s(29202);function e6(e){var t,s,n,c,o;let{onUpdate:d}=e,{state:m,actions:x}=(0,r.q)(),[u,p]=(0,i.useState)(!1),[h,g]=(0,i.useState)(!1),[b,f]=(0,i.useState)(""),[j,v]=(0,i.useState)(""),[N,w]=(0,i.useState)({name:(null===(t=m.organization)||void 0===t?void 0:t.name)||"",industry:(null===(s=m.organization)||void 0===s?void 0:s.industry)||"",website:(null===(n=m.organization)||void 0===n?void 0:n.website)||"",description:(null===(c=m.organization)||void 0===c?void 0:c.description)||"",default_country_code:(null===(o=m.organization)||void 0===o?void 0:o.default_country_code)||"+1"}),_=async()=>{if(m.organization){g(!0),v(""),f("");try{let{error:e}=await l.OQ.from("organizations").update({name:N.name,industry:N.industry,website:N.website,description:N.description,default_country_code:N.default_country_code,updated_at:new Date().toISOString()}).eq("id",m.organization.id);if(e)throw e;await x.fetchUserData(),f("Organization updated successfully!"),p(!1),setTimeout(()=>f(""),3e3),d&&d()}catch(e){console.error("Error updating organization:",e),v(e.message||"Failed to update organization")}finally{g(!1)}}};return m.organization?(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"flex items-center justify-between mb-6",children:!u&&(0,a.jsx)("button",{onClick:()=>p(!0),className:"px-4 py-2 text-sm font-medium text-blue-600 border border-blue-600 rounded-lg hover:bg-blue-50 transition-colors",children:"Edit Organization"})}),b&&(0,a.jsxs)("div",{className:"mb-4 p-3 bg-success-100 border border-success-300 rounded-lg flex items-center space-x-2",children:[(0,a.jsx)(y.Z,{className:"w-5 h-5 text-success-600"}),(0,a.jsx)("span",{className:"text-sm text-success-700",children:b})]}),j&&(0,a.jsx)("div",{className:"mb-4 p-3 bg-error-100 border border-error-300 rounded-lg",children:(0,a.jsx)("span",{className:"text-sm text-error-700",children:j})}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"flex items-center space-x-2 text-sm font-medium text-text-secondary mb-2",children:[(0,a.jsx)(e2.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"Organization Name"})]}),u?(0,a.jsx)("input",{type:"text",value:N.name,onChange:e=>w({...N,name:e.target.value}),className:"w-full px-4 py-3 bg-bg-primary border border-bg-tertiary rounded-lg text-text-primary focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter organization name"}):(0,a.jsx)("div",{className:"px-4 py-3 bg-bg-tertiary rounded-lg text-text-primary border border-bg-tertiary",children:m.organization.name})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"flex items-center space-x-2 text-sm font-medium text-text-secondary mb-2",children:[(0,a.jsx)(e5.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"Industry"})]}),u?(0,a.jsx)("input",{type:"text",value:N.industry,onChange:e=>w({...N,industry:e.target.value}),className:"w-full px-4 py-3 bg-bg-primary border border-bg-tertiary rounded-lg text-text-primary focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., Technology, Healthcare, Finance"}):(0,a.jsx)("div",{className:"px-4 py-3 bg-bg-tertiary rounded-lg text-text-primary border border-bg-tertiary",children:m.organization.industry||"Not specified"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"flex items-center space-x-2 text-sm font-medium text-text-secondary mb-2",children:[(0,a.jsx)(e3.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"Website"})]}),u?(0,a.jsx)("input",{type:"url",value:N.website,onChange:e=>w({...N,website:e.target.value}),className:"w-full px-4 py-3 bg-bg-primary border border-bg-tertiary rounded-lg text-text-primary focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"https://example.com"}):(0,a.jsx)("div",{className:"px-4 py-3 bg-bg-tertiary rounded-lg text-text-primary border border-bg-tertiary",children:m.organization.website||"Not specified"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Description"}),u?(0,a.jsx)("textarea",{value:N.description,onChange:e=>w({...N,description:e.target.value}),rows:3,className:"w-full px-4 py-3 bg-bg-primary border border-bg-tertiary rounded-lg text-text-primary focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",placeholder:"Brief description of your organization"}):(0,a.jsx)("div",{className:"px-4 py-3 bg-bg-tertiary rounded-lg text-text-primary border border-bg-tertiary min-h-[80px]",children:m.organization.description||"Not specified"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Default Country Code"}),u?(0,a.jsxs)("select",{value:N.default_country_code,onChange:e=>w({...N,default_country_code:e.target.value}),className:"w-full px-4 py-3 bg-bg-primary border border-bg-tertiary rounded-lg text-text-primary focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"+1",children:"+1 (US/Canada)"}),(0,a.jsx)("option",{value:"+44",children:"+44 (UK)"}),(0,a.jsx)("option",{value:"+61",children:"+61 (Australia)"}),(0,a.jsx)("option",{value:"+91",children:"+91 (India)"})]}):(0,a.jsx)("div",{className:"px-4 py-3 bg-bg-tertiary rounded-lg text-text-primary border border-bg-tertiary",children:m.organization.default_country_code})]}),u&&(0,a.jsxs)("div",{className:"flex space-x-3 pt-4",children:[(0,a.jsx)("button",{onClick:_,disabled:h,className:"flex-1 flex items-center justify-center space-x-2 px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:h?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ea.Z,{className:"w-5 h-5 animate-spin"}),(0,a.jsx)("span",{children:"Saving..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(eb.Z,{className:"w-5 h-5"}),(0,a.jsx)("span",{children:"Save Changes"})]})}),(0,a.jsx)("button",{onClick:()=>{var e,t,s,a,r;w({name:(null===(e=m.organization)||void 0===e?void 0:e.name)||"",industry:(null===(t=m.organization)||void 0===t?void 0:t.industry)||"",website:(null===(s=m.organization)||void 0===s?void 0:s.website)||"",description:(null===(a=m.organization)||void 0===a?void 0:a.description)||"",default_country_code:(null===(r=m.organization)||void 0===r?void 0:r.default_country_code)||"+1"}),p(!1),v("")},disabled:h,className:"px-4 py-3 border border-bg-tertiary text-text-secondary rounded-lg hover:bg-bg-tertiary transition-colors disabled:opacity-50",children:"Cancel"})]})]})]}):(0,a.jsx)("div",{children:(0,a.jsx)("p",{className:"text-text-secondary",children:"No organization data available"})})}var e8=s(37829),e9=s(99801);function e7(e){let{onUpdate:t}=e,{state:s}=(0,r.q)(),[n,c]=(0,i.useState)(null),[o,x]=(0,i.useState)(!0),[u,p]=(0,i.useState)(!1),[h,g]=(0,i.useState)(null),[b,f]=(0,i.useState)(!1),[j,v]=(0,i.useState)(!1),[N,w]=(0,i.useState)(""),[_,C]=(0,i.useState)(""),[k,D]=(0,i.useState)({smtp_host:"",smtp_port:587,smtp_username:"",smtp_password:"",smtp_from_email:"",smtp_from_name:"",smtp_use_tls:!0,smtp_use_ssl:!1}),[S,Z]=(0,i.useState)({imap_host:"",imap_port:993,imap_username:"",imap_password:"",imap_use_ssl:!0}),E=(0,i.useCallback)(async()=>{var e,t,a,r;if(null===(e=s.organization)||void 0===e?void 0:e.id)try{x(!0);let{data:e,error:i}=await l.OQ.from("email_config_safe").select("*").eq("organization_id",s.organization.id).single();if(i&&"PGRST116"!==i.code)throw i;e&&(c(e),D({smtp_host:e.smtp_host||"",smtp_port:e.smtp_port||587,smtp_username:e.smtp_username||"",smtp_password:"",smtp_from_email:e.smtp_from_email||"",smtp_from_name:e.smtp_from_name||"",smtp_use_tls:null===(t=e.smtp_use_tls)||void 0===t||t,smtp_use_ssl:null!==(a=e.smtp_use_ssl)&&void 0!==a&&a}),Z({imap_host:e.imap_host||"",imap_port:e.imap_port||993,imap_username:e.imap_username||"",imap_password:"",imap_use_ssl:null===(r=e.imap_use_ssl)||void 0===r||r}))}catch(e){console.error("Error fetching email config:",e),C("Failed to load email configuration")}finally{x(!1)}},[s.organization]);(0,i.useEffect)(()=>{E()},[E]);let A=async()=>{var e;if(null===(e=s.organization)||void 0===e?void 0:e.id){p(!0),C(""),w("");try{let{data:e,error:a}=await l.OQ.functions.invoke("save-email-config",{body:{organizationId:s.organization.id,smtp:k.smtp_host?{host:k.smtp_host,port:k.smtp_port,username:k.smtp_username,password:k.smtp_password,fromEmail:k.smtp_from_email,fromName:k.smtp_from_name,useTls:k.smtp_use_tls,useSsl:k.smtp_use_ssl}:void 0,imap:S.imap_host?{host:S.imap_host,port:S.imap_port,username:S.imap_username,password:S.imap_password,useSsl:S.imap_use_ssl}:void 0}});if(a)throw a;if(!(null==e?void 0:e.success))throw Error((null==e?void 0:e.error)||"Failed to save configuration");D({...k,smtp_password:""}),Z({...S,imap_password:""}),await E(),w("Email configuration saved successfully!"),setTimeout(()=>w(""),3e3),t&&t()}catch(e){console.error("Error saving email config:",e),C(e.message||"Failed to save email configuration")}finally{p(!1)}}},P=async e=>{var t,a,r;if(null===(t=s.organization)||void 0===t?void 0:t.id){g(e),C(""),w("");try{let t="smtp"===e?{host:k.smtp_host,port:k.smtp_port,username:k.smtp_username,password:k.smtp_password,useTls:k.smtp_use_tls,useSsl:k.smtp_use_ssl,fromEmail:k.smtp_from_email}:{host:S.imap_host,port:S.imap_port,username:S.imap_username,password:S.imap_password,useSsl:S.imap_use_ssl},{data:i,error:n}=await l.OQ.functions.invoke("test-email-config",{body:{organizationId:s.organization.id,testType:e,config:t}});if(n)throw n;if(i.success){w("".concat(e.toUpperCase()," connection successful! ✅")),setTimeout(()=>w(""),4e3);let t=await l.OQ.functions.invoke("save-email-config",{body:{organizationId:s.organization.id,smtp:"smtp"===e?{host:k.smtp_host,port:k.smtp_port,username:k.smtp_username,password:k.smtp_password,fromEmail:k.smtp_from_email,fromName:k.smtp_from_name,useTls:k.smtp_use_tls,useSsl:k.smtp_use_ssl}:void 0,imap:"imap"===e?{host:S.imap_host,port:S.imap_port,username:S.imap_username,password:S.imap_password,useSsl:S.imap_use_ssl}:void 0}});if(t.error||!(null===(a=t.data)||void 0===a?void 0:a.success))throw Error((null===(r=t.data)||void 0===r?void 0:r.error)||"Failed to save configuration");"smtp"===e?D({...k,smtp_password:""}):Z({...S,imap_password:""}),await E()}else throw Error(i.error||"Connection test failed")}catch(t){console.error("Error testing ".concat(e," config:"),t),C((t.message||"Failed to test ".concat(e.toUpperCase()," connection"))+("imap"===e?". Note: IMAP configuration is optional and only needed if you want to read incoming emails.":"")),setTimeout(()=>C(""),5e3)}finally{g(null)}}};return o?(0,a.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,a.jsx)(ea.Z,{className:"w-8 h-8 text-primary-600 animate-spin"})}):(0,a.jsxs)("div",{className:"relative",children:[N&&(0,a.jsxs)("div",{className:"fixed top-4 right-4 z-50 max-w-md p-4 bg-success-100 border border-success-300 rounded-lg shadow-lg flex items-center space-x-2 animate-slide-in",children:[(0,a.jsx)(y.Z,{className:"w-5 h-5 text-success-600 flex-shrink-0"}),(0,a.jsx)("span",{className:"text-sm text-success-700",children:N})]}),_&&(0,a.jsxs)("div",{className:"fixed top-4 right-4 z-50 max-w-md p-4 bg-error-100 border border-error-300 rounded-lg shadow-lg flex items-center space-x-2 animate-slide-in",children:[(0,a.jsx)(J.Z,{className:"w-5 h-5 text-error-600 flex-shrink-0"}),(0,a.jsx)("span",{className:"text-sm text-error-700",children:_})]}),(0,a.jsxs)("div",{className:"space-y-8",children:[(0,a.jsxs)("div",{className:"border border-bg-tertiary rounded-lg p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(ei.Z,{className:"w-5 h-5 text-purple-600"}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-text-primary",children:"SMTP (Outgoing Email)"})]}),(null==n?void 0:n.smtp_is_configured)&&(0,a.jsxs)("div",{className:"flex items-center space-x-2 px-3 py-1 bg-success-100 border border-success-300 rounded-full",children:[(0,a.jsx)(y.Z,{className:"w-4 h-4 text-success-600"}),(0,a.jsx)("span",{className:"text-xs text-success-700 font-medium",children:"Configured"})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"SMTP Host"}),(0,a.jsx)("input",{type:"text",value:k.smtp_host,onChange:e=>D({...k,smtp_host:e.target.value}),className:"w-full px-4 py-2 bg-bg-primary border border-bg-tertiary rounded-lg text-text-primary focus:outline-none focus:ring-2 focus:ring-purple-500",placeholder:"smtp.gmail.com"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Port"}),(0,a.jsx)("input",{type:"number",value:k.smtp_port,onChange:e=>D({...k,smtp_port:parseInt(e.target.value)}),className:"w-full px-4 py-2 bg-bg-primary border border-bg-tertiary rounded-lg text-text-primary focus:outline-none focus:ring-2 focus:ring-purple-500",placeholder:"587"})]})]}),(0,a.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Username"}),(0,a.jsx)("input",{type:"text",value:k.smtp_username,onChange:e=>D({...k,smtp_username:e.target.value}),className:"w-full px-4 py-2 bg-bg-primary border border-bg-tertiary rounded-lg text-text-primary focus:outline-none focus:ring-2 focus:ring-purple-500",placeholder:"your-email@gmail.com"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:["Password ",(null==n?void 0:n.smtp_password_set)&&(0,a.jsx)("span",{className:"text-xs text-success-600",children:"(configured)"})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:b?"text":"password",value:k.smtp_password,onChange:e=>D({...k,smtp_password:e.target.value}),className:"w-full px-4 py-2 pr-10 bg-bg-primary border border-bg-tertiary rounded-lg text-text-primary focus:outline-none focus:ring-2 focus:ring-purple-500",placeholder:(null==n?void 0:n.smtp_password_set)?"Enter new password (leave blank to keep current)":"Enter SMTP password",autoComplete:"off"}),(0,a.jsx)("button",{type:"button",onClick:()=>f(!b),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-text-tertiary hover:text-text-secondary transition-colors",tabIndex:-1,children:b?(0,a.jsx)(d.Z,{className:"w-4 h-4"}):(0,a.jsx)(m.Z,{className:"w-4 h-4"})})]})]})]}),(0,a.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"From Email"}),(0,a.jsx)("input",{type:"email",value:k.smtp_from_email,onChange:e=>D({...k,smtp_from_email:e.target.value}),className:"w-full px-4 py-2 bg-bg-primary border border-bg-tertiary rounded-lg text-text-primary focus:outline-none focus:ring-2 focus:ring-purple-500",placeholder:"noreply@yourdomain.com"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"From Name"}),(0,a.jsx)("input",{type:"text",value:k.smtp_from_name,onChange:e=>D({...k,smtp_from_name:e.target.value}),className:"w-full px-4 py-2 bg-bg-primary border border-bg-tertiary rounded-lg text-text-primary focus:outline-none focus:ring-2 focus:ring-purple-500",placeholder:"Your Company"})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-6",children:[(0,a.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,a.jsx)("input",{type:"checkbox",checked:k.smtp_use_tls,onChange:e=>D({...k,smtp_use_tls:e.target.checked}),className:"w-4 h-4 text-purple-600 rounded focus:ring-purple-500"}),(0,a.jsx)("span",{className:"text-sm text-text-secondary",children:"Use TLS"})]}),(0,a.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,a.jsx)("input",{type:"checkbox",checked:k.smtp_use_ssl,onChange:e=>D({...k,smtp_use_ssl:e.target.checked}),className:"w-4 h-4 text-purple-600 rounded focus:ring-purple-500"}),(0,a.jsx)("span",{className:"text-sm text-text-secondary",children:"Use SSL"})]})]}),(0,a.jsx)("button",{onClick:()=>P("smtp"),disabled:"smtp"===h||!k.smtp_host||!k.smtp_username,className:"flex items-center space-x-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"smtp"===h?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ea.Z,{className:"w-4 h-4 animate-spin"}),(0,a.jsx)("span",{children:"Testing..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(e8.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"Test SMTP Connection"})]})})]})]}),(0,a.jsxs)("div",{className:"border border-bg-tertiary rounded-lg p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(e9.Z,{className:"w-5 h-5 text-blue-600"}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-text-primary",children:"IMAP (Incoming Email)"})]}),(null==n?void 0:n.imap_is_configured)&&(0,a.jsxs)("div",{className:"flex items-center space-x-2 px-3 py-1 bg-success-100 border border-success-300 rounded-full",children:[(0,a.jsx)(y.Z,{className:"w-4 h-4 text-success-600"}),(0,a.jsx)("span",{className:"text-xs text-success-700 font-medium",children:"Configured"})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"IMAP Host"}),(0,a.jsx)("input",{type:"text",value:S.imap_host,onChange:e=>Z({...S,imap_host:e.target.value}),className:"w-full px-4 py-2 bg-bg-primary border border-bg-tertiary rounded-lg text-text-primary focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"imap.gmail.com"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Port"}),(0,a.jsx)("input",{type:"number",value:S.imap_port,onChange:e=>Z({...S,imap_port:parseInt(e.target.value)}),className:"w-full px-4 py-2 bg-bg-primary border border-bg-tertiary rounded-lg text-text-primary focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"993"})]})]}),(0,a.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Username"}),(0,a.jsx)("input",{type:"text",value:S.imap_username,onChange:e=>Z({...S,imap_username:e.target.value}),className:"w-full px-4 py-2 bg-bg-primary border border-bg-tertiary rounded-lg text-text-primary focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"your-email@gmail.com"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:["Password ",(null==n?void 0:n.imap_password_set)&&(0,a.jsx)("span",{className:"text-xs text-success-600",children:"(configured)"})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:j?"text":"password",value:S.imap_password,onChange:e=>Z({...S,imap_password:e.target.value}),className:"w-full px-4 py-2 pr-10 bg-bg-primary border border-bg-tertiary rounded-lg text-text-primary focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:(null==n?void 0:n.imap_password_set)?"Enter new password (leave blank to keep current)":"Enter IMAP password",autoComplete:"off"}),(0,a.jsx)("button",{type:"button",onClick:()=>v(!j),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-text-tertiary hover:text-text-secondary transition-colors",tabIndex:-1,children:j?(0,a.jsx)(d.Z,{className:"w-4 h-4"}):(0,a.jsx)(m.Z,{className:"w-4 h-4"})})]})]})]}),(0,a.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,a.jsx)("input",{type:"checkbox",checked:S.imap_use_ssl,onChange:e=>Z({...S,imap_use_ssl:e.target.checked}),className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500"}),(0,a.jsx)("span",{className:"text-sm text-text-secondary",children:"Use SSL"})]}),(0,a.jsx)("button",{onClick:()=>P("imap"),disabled:"imap"===h||!S.imap_host||!S.imap_username,className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"imap"===h?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ea.Z,{className:"w-4 h-4 animate-spin"}),(0,a.jsx)("span",{children:"Testing..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(e8.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"Test IMAP Connection"})]})})]})]}),(0,a.jsx)("div",{className:"flex justify-end pt-4",children:(0,a.jsx)("button",{onClick:A,disabled:u,className:"flex items-center space-x-2 px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:u?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ea.Z,{className:"w-5 h-5 animate-spin"}),(0,a.jsx)("span",{children:"Saving..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(eb.Z,{className:"w-5 h-5"}),(0,a.jsx)("span",{children:"Save Configuration"})]})})})]}),(0,a.jsxs)("div",{className:"mt-6 p-4 bg-bg-tertiary border border-bg-tertiary rounded-lg",children:[(0,a.jsx)("h4",{className:"font-medium text-text-primary mb-2",children:"Common Email Providers"}),(0,a.jsxs)("div",{className:"text-sm text-text-secondary space-y-1",children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Gmail:"})," smtp.gmail.com:587 (TLS) / imap.gmail.com:993 (SSL)"]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Outlook:"})," smtp-mail.outlook.com:587 (TLS) / outlook.office365.com:993 (SSL)"]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Yahoo:"})," smtp.mail.yahoo.com:587 (TLS) / imap.mail.yahoo.com:993 (SSL)"]}),(0,a.jsxs)("div",{className:"mt-3 p-3 bg-blue-900/20 border border-blue-700/30 rounded text-xs space-y-1",children:[(0,a.jsx)("p",{className:"text-blue-300 font-medium",children:"\uD83D\uDCE7 Gmail IMAP Setup:"}),(0,a.jsxs)("ol",{className:"list-decimal list-inside text-text-tertiary space-y-0.5 ml-1",children:[(0,a.jsx)("li",{children:"Go to Google Account → Security"}),(0,a.jsx)("li",{children:"Enable 2-Step Verification if not already enabled"}),(0,a.jsx)("li",{children:'Create an App Password (Search for "App passwords")'}),(0,a.jsx)("li",{children:'Select "Mail" and "Other device"'}),(0,a.jsx)("li",{children:"Use the generated 16-character password here (not your regular password)"}),(0,a.jsx)("li",{children:"Make sure IMAP is enabled in Gmail Settings → Forwarding and POP/IMAP"})]})]})]})]})]})}function te(e){let{onNavigate:t}=e,{state:s}=(0,r.q)(),[c,d]=(0,i.useState)("profile"),[m,x]=(0,i.useState)(!1),[u,p]=(0,i.useState)(!0),g=e=>{d(c===e?null:e)},j=(0,i.useCallback)(async()=>{var e;if(null===(e=s.organization)||void 0===e?void 0:e.id){p(!0);try{let{data:e}=await l.OQ.from("email_config").select("smtp_is_configured, imap_is_configured").eq("organization_id",s.organization.id).single();e&&(e.smtp_is_configured||e.imap_is_configured)||x(!0)}catch(e){console.error("Error checking email config:",e),x(!0)}finally{p(!1)}}},[s.organization]);return(0,i.useEffect)(()=>{j()},[j]),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-text-primary",children:"Settings"}),(0,a.jsx)("p",{className:"text-text-secondary mt-1",children:"Manage your account, organization, and integration preferences"})]})}),m&&!u&&(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"bg-warning-100 border border-warning-300 rounded-lg p-4 flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,a.jsx)(e0.Z,{className:"w-5 h-5 text-warning-600 mt-0.5"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold text-warning-800",children:"Email Integration Not Configured"}),(0,a.jsx)("p",{className:"text-sm text-warning-700 mt-1",children:"Configure your SMTP and IMAP settings below to enable email tools for your agents. Your agents won't be able to send or receive emails until this is set up."})]})]}),(0,a.jsx)("button",{onClick:()=>x(!1),className:"text-warning-600 hover:text-warning-800 transition-colors",children:(0,a.jsx)(b.Z,{className:"w-5 h-5"})})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"bg-bg-secondary rounded-lg border border-bg-tertiary overflow-hidden",children:[(0,a.jsxs)("button",{onClick:()=>g("profile"),className:"w-full flex items-center justify-between p-6 text-left hover:bg-bg-tertiary transition-colors",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-primary-100 rounded-lg flex items-center justify-center",children:(0,a.jsx)(h.Z,{className:"w-5 h-5 text-primary-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-text-primary",children:"User Profile"}),(0,a.jsx)("p",{className:"text-sm text-text-secondary",children:"Manage your personal information and account details"})]})]}),"profile"===c?(0,a.jsx)(f.Z,{className:"w-5 h-5 text-text-tertiary"}):(0,a.jsx)(e1.Z,{className:"w-5 h-5 text-text-tertiary"})]}),"profile"===c&&(0,a.jsx)("div",{className:"border-t border-bg-tertiary p-6",children:(0,a.jsx)(e4,{onUpdate:j})})]}),(0,a.jsxs)("div",{className:"bg-bg-secondary rounded-lg border border-bg-tertiary overflow-hidden",children:[(0,a.jsxs)("button",{onClick:()=>g("organization"),className:"w-full flex items-center justify-between p-6 text-left hover:bg-bg-tertiary transition-colors",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:(0,a.jsx)(e2.Z,{className:"w-5 h-5 text-blue-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-text-primary",children:"Organization"}),(0,a.jsx)("p",{className:"text-sm text-text-secondary",children:"Update organization details and settings"})]})]}),"organization"===c?(0,a.jsx)(f.Z,{className:"w-5 h-5 text-text-tertiary"}):(0,a.jsx)(e1.Z,{className:"w-5 h-5 text-text-tertiary"})]}),"organization"===c&&(0,a.jsx)("div",{className:"border-t border-bg-tertiary p-6",children:(0,a.jsx)(e6,{onUpdate:j})})]}),(0,a.jsxs)("div",{className:"bg-bg-secondary rounded-lg border border-bg-tertiary overflow-hidden",children:[(0,a.jsxs)("button",{onClick:()=>g("email"),className:"w-full flex items-center justify-between p-6 text-left hover:bg-bg-tertiary transition-colors",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center",children:(0,a.jsx)(o.Z,{className:"w-5 h-5 text-purple-600"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-text-primary",children:"Email Integration"}),!u&&s.organization&&(0,a.jsx)(a.Fragment,{children:m?(0,a.jsx)("span",{className:"px-2 py-1 bg-warning-100 border border-warning-300 text-warning-700 text-xs rounded-full font-medium",children:"Not Configured"}):(0,a.jsxs)("span",{className:"flex items-center space-x-1 px-2 py-1 bg-success-100 border border-success-300 text-success-700 text-xs rounded-full font-medium",children:[(0,a.jsx)(y.Z,{className:"w-3 h-3"}),(0,a.jsx)("span",{children:"Configured"})]})})]}),(0,a.jsx)("p",{className:"text-sm text-text-secondary",children:"Configure SMTP and IMAP for email tools"})]})]}),"email"===c?(0,a.jsx)(f.Z,{className:"w-5 h-5 text-text-tertiary"}):(0,a.jsx)(e1.Z,{className:"w-5 h-5 text-text-tertiary"})]}),"email"===c&&(0,a.jsx)("div",{className:"border-t border-bg-tertiary p-6",children:(0,a.jsx)(e7,{onUpdate:j})})]})]})]})}var tt=s(98728);function ts(e){let{onNavigate:t}=e,{state:s}=(0,r.q)(),{profile:c,organization:o}=s,[d,m]=(0,i.useState)("chat"),[x,u]=(0,i.useState)([]),[h,g]=(0,i.useState)([]),[b,f]=(0,i.useState)(null),[j,v]=(0,i.useState)(!0),[N,w]=(0,i.useState)(null);(0,i.useEffect)(()=>{(null==o?void 0:o.id)&&_()},[null==o?void 0:o.id]);let _=async()=>{try{v(!0);let{data:e}=await l.OQ.from("communication_strategies").select("*").eq("organization_id",null==o?void 0:o.id).order("created_at",{ascending:!1});e&&u(e);let{data:t}=await l.OQ.from("outbound_queue").select("\n          id,\n          scheduled_for,\n          priority,\n          context,\n          contacts(first_name, last_name, phone_number),\n          agents(name)\n        ").eq("organization_id",null==o?void 0:o.id).eq("status","queued").gte("scheduled_for",new Date().toISOString()).order("scheduled_for",{ascending:!0}).limit(10);if(t){let e=t.map(e=>{var t;let s=Array.isArray(e.contacts)?e.contacts[0]:e.contacts,a=Array.isArray(e.agents)?e.agents[0]:e.agents;return{id:e.id,contact_name:s?"".concat(s.first_name||""," ").concat(s.last_name||"").trim():"Unknown Contact",contact_phone:(null==s?void 0:s.phone_number)||"",agent_name:(null==a?void 0:a.name)||"Unassigned",scheduled_for:e.scheduled_for,priority:e.priority,objective:(null===(t=e.context)||void 0===t?void 0:t.objective)||"General outreach"}});g(e)}let s=(null==e?void 0:e.length)||0,a=(null==e?void 0:e.filter(e=>e.is_active).length)||0,r=(null==t?void 0:t.length)||0,i=new Date;i.setDate(i.getDate()-7);let{data:n}=await l.OQ.from("calls").select("outcome").eq("organization_id",null==o?void 0:o.id).gte("created_at",i.toISOString()),c=(null==n?void 0:n.length)||0,d=(null==n?void 0:n.filter(e=>"success"===e.outcome).length)||0;f({totalStrategies:s,activeStrategies:a,queuedCalls:r,callsThisWeek:c,successRate:c>0?d/c*100:0})}catch(e){console.error("Error fetching strategy data:",e)}finally{v(!1)}},C=async e=>{try{let{data:t,error:s}=await l.OQ.from("communication_strategies").insert({organization_id:null==o?void 0:o.id,name:"Strategy - ".concat(new Date().toLocaleDateString()),description:"Automatically created strategy",target_tags:e.targetAudience||[],communication_frequency:e.frequency||"weekly",objectives:e.communicationGoals||[],success_metrics:{targets:e.successMetrics||[],confidence:e.confidence||.8},is_active:!0}).select().single();if(s)throw s;await _(),m("manage")}catch(e){console.error("Error creating strategy:",e)}},k=async(e,t)=>{try{let{error:s}=await l.OQ.from("communication_strategies").update({is_active:!t}).eq("id",e);if(s)throw s;await _()}catch(e){console.error("Error updating strategy:",e)}},D=async e=>{if(confirm("Are you sure you want to delete this strategy?"))try{let{error:t}=await l.OQ.from("communication_strategies").delete().eq("id",e);if(t)throw t;await _()}catch(e){console.error("Error deleting strategy:",e)}},S=e=>{switch(e){case 4:return"text-red-400 bg-red-900/20";case 3:return"text-orange-400 bg-orange-900/20";case 2:return"text-yellow-400 bg-yellow-900/20";default:return"text-blue-400 bg-blue-900/20"}},Z=e=>{switch(e){case 4:return"Urgent";case 3:return"High";case 2:return"Medium";default:return"Low"}};return j?(0,a.jsx)("div",{className:"space-y-8",children:(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6",children:[1,2,3,4,5].map(e=>(0,a.jsxs)("div",{className:"card animate-pulse",children:[(0,a.jsx)("div",{className:"h-4 bg-neutral-600 rounded w-1/2 mb-4"}),(0,a.jsx)("div",{className:"h-8 bg-neutral-600 rounded w-1/3 mb-2"}),(0,a.jsx)("div",{className:"h-3 bg-neutral-600 rounded w-1/4"})]},e))})}):(0,a.jsxs)("div",{className:"space-y-8",children:[(0,a.jsxs)("div",{className:"dashboard-header",children:[(0,a.jsx)(n.E.h1,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"dashboard-title",children:"Strategy Center \uD83C\uDFAF"}),(0,a.jsx)("p",{className:"dashboard-subtitle",children:"Create intelligent outbound communication strategies with Kai and monitor their performance."})]}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6",children:b&&[{title:"Total Strategies",value:b.totalStrategies,icon:H.Z,color:"primary",iconColor:"text-blue-400",bgColor:"bg-blue-400/10"},{title:"Active Strategies",value:b.activeStrategies,icon:y.Z,color:"success",iconColor:"text-emerald-400",bgColor:"bg-emerald-400/10"},{title:"Queued Calls",value:b.queuedCalls,icon:eo.Z,color:"warning",iconColor:"text-amber-400",bgColor:"bg-amber-400/10"},{title:"Calls This Week",value:b.callsThisWeek,icon:eT.Z,color:"primary",iconColor:"text-blue-400",bgColor:"bg-blue-400/10"},{title:"Success Rate",value:"".concat(Math.round(b.successRate),"%"),icon:M.Z,color:"success",iconColor:"text-purple-400",bgColor:"bg-purple-400/10"}].map((e,t)=>{let s=e.icon;return(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*t},className:"kpi-card p-6",children:[(0,a.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,a.jsx)("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center ".concat(e.bgColor),children:(0,a.jsx)(s,{className:"w-6 h-6 ".concat(e.iconColor)})})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"kpi-title",children:e.title}),(0,a.jsx)("p",{className:"kpi-value",children:e.value})]})]},e.title)})}),(0,a.jsxs)("div",{className:"card p-6",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4 mb-6",children:[(0,a.jsxs)("button",{onClick:()=>m("chat"),className:"flex items-center space-x-2 px-4 py-2 rounded-lg transition-colors ".concat("chat"===d?"bg-primary-600 text-white":"text-text-secondary hover:text-text-primary hover:bg-bg-secondary"),children:[(0,a.jsx)(R.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"Strategy Chat"})]}),(0,a.jsxs)("button",{onClick:()=>m("manage"),className:"flex items-center space-x-2 px-4 py-2 rounded-lg transition-colors ".concat("manage"===d?"bg-primary-600 text-white":"text-text-secondary hover:text-text-primary hover:bg-bg-secondary"),children:[(0,a.jsx)(tt.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"Manage Strategies"})]})]}),(0,a.jsxs)(p.M,{mode:"wait",children:["chat"===d&&(0,a.jsx)(n.E.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.2},children:(0,a.jsx)(el,{organizationId:(null==o?void 0:o.id)||"",userId:(null==c?void 0:c.id)||"",onStrategyCreated:C})},"chat"),"manage"===d&&(0,a.jsxs)(n.E.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.2},className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-bold text-text-primary",children:"Active Strategies"}),(0,a.jsxs)("button",{onClick:()=>m("chat"),className:"btn-primary flex items-center",children:[(0,a.jsx)(em.Z,{className:"w-4 h-4 mr-2"}),"Create Strategy with Kai"]})]}),x.length>0?(0,a.jsx)("div",{className:"grid gap-4",children:x.map(e=>(0,a.jsx)("div",{className:"border border-bg-tertiary rounded-lg p-4 hover:border-primary-300 transition-colors",children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 mb-2",children:[(0,a.jsx)("h4",{className:"font-medium text-text-primary",children:e.name}),(0,a.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat(e.is_active?"text-green-100 bg-green-800":"text-gray-100 bg-gray-800"),children:e.is_active?"Active":"Paused"})]}),(0,a.jsx)("p",{className:"text-sm text-text-secondary mb-3",children:e.description}),(0,a.jsxs)("div",{className:"grid md:grid-cols-3 gap-4 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium text-text-primary mb-1",children:"Target Audience"}),(0,a.jsx)("p",{className:"text-text-secondary",children:e.target_tags.length>0?e.target_tags.join(", "):"All contacts"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium text-text-primary mb-1",children:"Frequency"}),(0,a.jsx)("p",{className:"text-text-secondary capitalize",children:e.communication_frequency})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium text-text-primary mb-1",children:"Objectives"}),(0,a.jsxs)("p",{className:"text-text-secondary",children:[e.objectives.slice(0,2).join(", "),e.objectives.length>2&&" +".concat(e.objectives.length-2," more")]})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("button",{onClick:()=>k(e.id,e.is_active),className:"p-2 rounded-lg transition-colors ".concat(e.is_active?"text-yellow-400 hover:bg-yellow-900/20":"text-green-400 hover:bg-green-900/20"),title:e.is_active?"Pause strategy":"Activate strategy",children:e.is_active?(0,a.jsx)(ew.Z,{className:"w-4 h-4"}):(0,a.jsx)(e_.Z,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:()=>w(e),className:"p-2 text-text-secondary hover:text-text-primary hover:bg-bg-secondary rounded-lg transition-colors",title:"Edit strategy",children:(0,a.jsx)(ey.Z,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:()=>D(e.id),className:"p-2 text-red-400 hover:bg-red-900/20 rounded-lg transition-colors",title:"Delete strategy",children:(0,a.jsx)(eg.Z,{className:"w-4 h-4"})})]})]})},e.id))}):(0,a.jsxs)("div",{className:"text-center py-12 border border-dashed border-bg-tertiary rounded-lg",children:[(0,a.jsx)(T.Z,{className:"w-12 h-12 text-text-tertiary mx-auto mb-3"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-text-primary mb-2",children:"No Strategies Yet"}),(0,a.jsx)("p",{className:"text-text-secondary mb-4",children:"Create your first intelligent outbound strategy by chatting with Kai"}),(0,a.jsx)("button",{onClick:()=>m("chat"),className:"btn-primary",children:"Start Strategy Chat"})]})]}),h.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-bold text-text-primary mb-4",children:"Upcoming Communications"}),(0,a.jsx)("div",{className:"space-y-3",children:h.map(e=>(0,a.jsxs)("div",{className:"flex items-center space-x-4 p-3 border border-bg-tertiary rounded-lg",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)(eu.Z,{className:"w-5 h-5 text-primary-solid"})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("p",{className:"font-medium text-text-primary",children:e.contact_name}),(0,a.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat(S(e.priority)),children:Z(e.priority)})]}),(0,a.jsx)("p",{className:"text-sm text-text-secondary",children:e.objective})]}),(0,a.jsxs)("div",{className:"text-right text-sm",children:[(0,a.jsx)("p",{className:"text-text-primary",children:e.agent_name}),(0,a.jsxs)("p",{className:"text-text-tertiary",children:[new Date(e.scheduled_for).toLocaleDateString()," at"," ",new Date(e.scheduled_for).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]})]},e.id))})]})]},"manage")]})]})]})}var ta=s(92451),tr=s(9127),ti=s(22135);function tn(e){var t;let{caseId:s,onBack:r,onLoaded:c,showParentSpinner:d}=e,[m,u]=(0,i.useState)(null),[p,g]=(0,i.useState)([]),[b,v]=(0,i.useState)(!0),[N,w]=(0,i.useState)(!1),[_,C]=(0,i.useState)("timeline"),[D,Z]=(0,i.useState)(!1);(0,i.useEffect)(()=>{E();let e=l.OQ.channel("case_activities_".concat(s)).on("postgres_changes",{event:"*",schema:"public",table:"case_activities",filter:"case_id=eq.".concat(s)},()=>{console.log("Activity change detected, refreshing..."),E()}).subscribe();return()=>{l.OQ.removeChannel(e)}},[s]);let E=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{e?w(!0):v(!0);let{data:t,error:a}=await l.OQ.from("support_cases").select("\n          *,\n          contacts:contact_id (first_name, last_name, email, phone_number),\n          agents:assigned_agent_id (name)\n        ").eq("id",s).single();if(a)throw console.error("Case fetch error:",a),x.ZP.error("Failed to load case details"),a;u(t);let{data:r,error:i}=await l.OQ.from("case_activities").select("*").eq("case_id",s).order("created_at",{ascending:!1});i&&(console.error("Activities fetch error:",i),x.ZP.error("Failed to load activity timeline"));let n=await Promise.all((r||[]).map(async e=>{if(e.created_by){let{data:t}=await l.OQ.from("user_profiles").select("email").eq("id",e.created_by).single();return{...e,user_profiles:t}}return{...e,user_profiles:null}}));g(n)}catch(e){console.error("Error fetching case data:",e),x.ZP.error("Failed to load case details")}finally{v(!1),w(!1);try{c&&c()}catch(e){}}},A=e=>({created:ep.Z,status_change:tt.Z,channel_switch:R.Z,message_sent:o.Z,message_received:et.Z,note_added:ep.Z,escalated:eT.Z,resolved:y.Z,assigned:h.Z,tag_added:ej.Z,tag_removed:ej.Z,priority_change:J.Z})[e]||ep.Z,P=e=>({created:"bg-blue-500/10 text-blue-400 border-blue-500/20 shadow-[0_0_15px_rgba(59,130,246,0.1)]",status_change:"bg-purple-500/10 text-purple-400 border-purple-500/20 shadow-[0_0_15px_rgba(168,85,247,0.1)]",channel_switch:"bg-indigo-500/10 text-indigo-400 border-indigo-500/20 shadow-[0_0_15px_rgba(99,102,241,0.1)]",message_sent:"bg-emerald-500/10 text-emerald-400 border-emerald-500/20 shadow-[0_0_15px_rgba(16,185,129,0.1)]",message_received:"bg-cyan-500/10 text-cyan-400 border-cyan-500/20 shadow-[0_0_15px_rgba(6,182,212,0.1)]",note_added:"bg-slate-500/10 text-slate-400 border-slate-500/20 shadow-[0_0_15px_rgba(148,163,184,0.1)]",escalated:"bg-red-500/10 text-red-400 border-red-500/20 shadow-[0_0_15px_rgba(239,68,68,0.1)]",resolved:"bg-green-500/10 text-green-400 border-green-500/20 shadow-[0_0_15px_rgba(34,197,94,0.1)]",assigned:"bg-violet-500/10 text-violet-400 border-violet-500/20 shadow-[0_0_15px_rgba(139,92,246,0.1)]",tag_added:"bg-yellow-500/10 text-yellow-400 border-yellow-500/20 shadow-[0_0_15px_rgba(234,179,8,0.1)]",tag_removed:"bg-orange-500/10 text-orange-400 border-orange-500/20 shadow-[0_0_15px_rgba(249,115,22,0.1)]",priority_change:"bg-pink-500/10 text-pink-400 border-pink-500/20 shadow-[0_0_15px_rgba(236,72,153,0.1)]"})[e]||"bg-slate-500/10 text-slate-400 border-slate-500/20",z=()=>{if(!m)return"—";let e=m.contacts;return e&&("".concat(e.first_name||""," ").concat(e.last_name||"").trim()||e.email||e.phone_number)||"—"};return b?d?(0,a.jsx)("div",{className:"min-h-screen"}):(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,a.jsx)("div",{className:"text-text-secondary",children:"Loading case details..."})}):m?(0,a.jsxs)("div",{className:"min-h-screen bg-[#09090b] relative flex flex-col",children:[(0,a.jsxs)("div",{className:"border-b border-white/[0.05] sticky top-0 bg-[#09090b]/95 backdrop-blur-sm z-40 transition-all duration-300 ease-in-out",children:[(0,a.jsxs)("div",{className:"transition-all duration-300 px-4 md:px-8 w-full ".concat(D?"py-2 md:py-3":"py-4 md:py-6"),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4 md:gap-6",children:[(0,a.jsxs)("div",{className:"flex items-start transition-all duration-300 ".concat(D?"space-x-2 md:space-x-4":"space-x-3 md:space-x-5"),children:[(0,a.jsx)("button",{onClick:r,className:"transition-all duration-300 bg-white/[0.03] hover:bg-white/[0.08] text-text-tertiary hover:text-white rounded-xl border border-white/[0.05] active:scale-95 group ".concat(D?"p-1.5 mt-0.5":"p-2 md:p-2.5 mt-1"),title:"Back to List",children:(0,a.jsx)(k.Z,{className:"".concat(D?"w-4 h-4":"w-5 h-5"," group-hover:-translate-x-0.5 transition-transform")})}),(0,a.jsxs)("div",{className:"space-y-0.5 md:space-y-1 min-w-0 flex-1",children:[(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2 md:gap-3",children:[(0,a.jsx)("h1",{className:"font-black text-white tracking-tight truncate transition-all duration-300 ".concat(D?"text-lg md:text-xl":"text-xl md:text-3xl"),children:m.case_number}),(0,a.jsxs)("div",{className:"flex items-center gap-1.5 md:gap-2",children:[(0,a.jsx)("span",{className:"px-2 md:px-3 py-0.5 md:py-1 font-bold uppercase tracking-widest rounded-full border shadow-sm transition-all hover:scale-105 cursor-default ".concat({new:"bg-blue-600/10 text-blue-400 border-blue-500/30",open:"bg-violet-600/10 text-violet-400 border-violet-500/30",pending_customer:"bg-amber-600/10 text-amber-400 border-amber-500/30",pending_internal:"bg-amber-500/10 text-amber-300 border-amber-500/30",escalated:"bg-red-600/10 text-red-400 border-red-500/30",resolved:"bg-emerald-600/10 text-emerald-400 border-emerald-500/30",closed:"bg-slate-600/10 text-slate-400 border-slate-500/30"}[m.status]," border-white/10 whitespace-nowrap ").concat(D?"text-[8px] md:text-[9px]":"text-[9px] md:text-[10px]"),children:m.status.replace("_"," ")}),(0,a.jsx)("span",{className:"px-2 md:px-3 py-0.5 md:py-1 font-bold uppercase tracking-widest rounded-full border shadow-sm transition-all hover:scale-105 cursor-default ".concat({low:"bg-slate-500/10 text-slate-400 border-slate-500/30",normal:"bg-violet-600/10 text-violet-400 border-violet-500/30",high:"bg-red-500/10 text-red-400 border-red-500/30",urgent:"bg-pink-600/10 text-pink-400 border-pink-500/30"}[m.priority]," border-white/10 whitespace-nowrap ").concat(D?"text-[8px] md:text-[9px]":"text-[9px] md:text-[10px]"),children:m.priority})]})]}),!D&&(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsx)("span",{className:"text-text-secondary font-medium text-sm md:text-lg leading-tight truncate underline decoration-white/10 underline-offset-4 decoration-dashed",children:m.subject||"Untitled Subject"})}),D&&(0,a.jsx)("div",{className:"text-text-tertiary text-[10px] md:text-xs truncate font-medium opacity-70",children:m.subject||"No Subject"})]})]}),(0,a.jsx)("div",{className:"flex items-center justify-end shrink-0",children:(0,a.jsx)("button",{onClick:()=>Z(!D),className:"bg-white/[0.08] rounded-xl border border-white/[0.05] text-white transition-all flex items-center gap-2 font-black uppercase tracking-widest ".concat(D?"p-1.5 md:p-2 text-[8px] md:text-[9px]":"p-2 md:p-3 text-[10px]"),children:D?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(f.Z,{className:"".concat(D?"w-3.5 h-3.5":"w-4 h-4")}),(0,a.jsx)("span",{className:"hidden md:inline",children:"Expand"})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ti.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{className:"hidden md:inline",children:"Collapse"})]})})})]}),!D&&(0,a.jsxs)(n.E.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mt-6 md:mt-8 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 md:gap-4",children:[(0,a.jsxs)("div",{className:"p-3.5 bg-white/[0.02] border border-white/[0.05] rounded-2xl flex items-center gap-3 group hover:border-primary-500/30 transition-all cursor-default overflow-hidden relative",children:[(0,a.jsx)("div",{className:"p-2.5 bg-primary-500/10 rounded-xl text-primary-400 group-hover:scale-110 transition-transform",children:(0,a.jsx)(h.Z,{className:"w-4 h-4"})}),(0,a.jsxs)("div",{className:"flex flex-col min-w-0",children:[(0,a.jsx)("span",{className:"text-[10px] text-text-tertiary uppercase font-bold tracking-wider",children:"Customer"}),(0,a.jsx)("span",{className:"text-sm font-semibold text-white truncate group-hover:text-primary-300 transition-colors",title:z(),children:z()})]})]}),(0,a.jsxs)("div",{className:"p-3.5 bg-white/[0.02] border border-white/[0.05] rounded-2xl flex items-center gap-3 group hover:border-purple-500/30 transition-all cursor-default overflow-hidden relative",children:[(0,a.jsx)("div",{className:"p-2.5 bg-purple-500/10 rounded-xl text-purple-400 group-hover:scale-110 transition-transform",children:(0,a.jsx)(h.Z,{className:"w-4 h-4"})}),(0,a.jsxs)("div",{className:"flex flex-col min-w-0",children:[(0,a.jsx)("span",{className:"text-[10px] text-text-tertiary uppercase font-bold tracking-wider",children:"Assigned"}),(0,a.jsx)("span",{className:"text-sm font-semibold text-white truncate group-hover:text-purple-300 transition-colors",children:m&&(null===(t=m.agents)||void 0===t?void 0:t.name)||"—"})]})]}),(0,a.jsxs)("div",{className:"p-3.5 bg-white/[0.02] border border-white/[0.05] rounded-2xl flex items-center gap-3 group hover:border-amber-500/30 transition-all cursor-default overflow-hidden relative",children:[(0,a.jsx)("div",{className:"p-2.5 bg-amber-500/10 rounded-xl text-amber-400 group-hover:scale-110 transition-transform",children:(0,a.jsx)(eu.Z,{className:"w-4 h-4"})}),(0,a.jsxs)("div",{className:"flex flex-col min-w-0",children:[(0,a.jsx)("span",{className:"text-[10px] text-text-tertiary uppercase font-bold tracking-wider",children:"Opened"}),(0,a.jsx)("span",{className:"text-sm font-semibold text-white truncate group-hover:text-amber-300 transition-colors",children:new Date(m.created_at).toLocaleDateString()})]})]})]})]}),(0,a.jsx)("div",{className:"px-4 md:px-8 w-full border-t border-white/[0.02]",children:(0,a.jsx)("nav",{className:"flex items-center space-x-1 md:space-x-2",children:[{id:"timeline",label:"Timeline",icon:eo.Z},{id:"details",label:"Properties",icon:ej.Z}].map(e=>{let t=e.icon,s=_===e.id;return(0,a.jsxs)("button",{onClick:()=>C(e.id),className:"relative flex items-center space-x-2 py-3 md:py-4 px-4 md:px-6 text-xs md:text-sm font-bold transition-all rounded-t-2xl group overflow-hidden ".concat(s?"text-primary-400":"text-text-tertiary hover:text-white"),children:[(0,a.jsx)(t,{className:"w-3.5 h-3.5 md:w-4 md:h-4 transition-transform ".concat(s?"scale-110":"group-hover:scale-110")}),(0,a.jsx)("span",{className:"relative z-10",children:e.label}),s&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.E.div,{layoutId:"activeTabBg",className:"absolute inset-0 bg-white/[0.02] z-0"}),(0,a.jsx)(n.E.div,{layoutId:"activeTabUnder",className:"absolute bottom-0 left-4 right-4 h-0.5 md:h-1 bg-primary-500 rounded-full shadow-[0_0_15px_rgba(59,130,246,0.6)]"})]})]},e.id)})})})]}),(0,a.jsxs)("div",{className:"p-4 md:p-8 w-full flex-1 relative",children:[(0,a.jsx)("div",{className:"absolute top-0 right-0 w-1/3 h-1/2 bg-primary-500/5 blur-[120px] pointer-events-none -z-10 animate-pulse"}),(0,a.jsx)("div",{className:"absolute bottom-0 left-0 w-1/3 h-1/2 bg-purple-500/5 blur-[120px] pointer-events-none -z-10 opacity-50"}),"timeline"===_&&(0,a.jsxs)(n.E.div,{initial:{opacity:0,scale:.98},animate:{opacity:1,scale:1},className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h2",{className:"text-xl font-black text-white px-0",children:"Recent Activities"}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("button",{onClick:()=>E(!0),disabled:N,className:"flex items-center gap-2 px-3 py-1.5 bg-white/[0.03] hover:bg-white/[0.08] rounded-xl border border-white/[0.05] text-text-tertiary hover:text-white transition-all disabled:opacity-50 disabled:cursor-not-allowed text-[10px] font-black uppercase tracking-widest",title:"Refresh timeline",children:[(0,a.jsx)(S.Z,{className:"w-3.5 h-3.5 ".concat(N?"animate-spin":"")}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"Refresh"})]}),(0,a.jsxs)("div",{className:"text-[10px] text-text-tertiary font-bold space-x-2 flex items-center",children:[(0,a.jsx)("span",{className:"w-2 h-2 rounded-full bg-green-500 animate-pulse inline-block"}),(0,a.jsx)("span",{className:"uppercase tracking-[0.2em] hidden md:inline",children:"Live Monitoring"})]})]})]}),0===p.length?(0,a.jsxs)("div",{className:"text-center py-32 rounded-[2rem] border-2 border-dashed border-white/[0.05] bg-white/[0.01]",children:[(0,a.jsx)(eo.Z,{className:"w-16 h-16 text-white/10 mx-auto mb-6 opacity-20"}),(0,a.jsx)("h3",{className:"text-lg font-bold text-white/40",children:"Quiet Zone"}),(0,a.jsx)("p",{className:"text-text-tertiary text-sm max-w-xs mx-auto mt-2",children:"No activity events have been recorded for this case yet."})]}):(0,a.jsx)("div",{className:"space-y-4 px-0",children:p.map((e,t)=>{var s;let r=A(e.activity_type),i=P(e.activity_type);return(0,a.jsxs)("div",{className:"group flex items-start space-x-6 relative py-2",children:[(0,a.jsx)("div",{className:"absolute left-[24px] top-[48px] bottom-[-24px] w-[2px] bg-gradient-to-b from-white/[0.08] to-transparent group-last:hidden"}),(0,a.jsx)("div",{className:"mt-1.5 w-12 h-12 rounded-2xl flex items-center justify-center border-2 transition-all duration-300 group-hover:scale-110 group-hover:shadow-[0_0_20px_rgba(255,255,255,0.05)] z-10 ".concat(i),children:(0,a.jsx)(r,{className:"w-5 h-5"})}),(0,a.jsx)("div",{className:"flex-1 space-y-2",children:(0,a.jsx)("div",{className:"flex items-start justify-between",children:(0,a.jsxs)("div",{className:"flex-1 p-5 rounded-[1.5rem] bg-[#121214] border border-white/[0.05] group-hover:border-white/[0.1] shadow-lg transition-all duration-300 relative group-hover:-translate-y-1",children:[(0,a.jsx)("div",{className:"absolute inset-x-0 -bottom-px h-px bg-gradient-to-r from-transparent via-white/10 to-transparent group-hover:via-white/20 transition-all"}),(0,a.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[(0,a.jsx)("p",{className:"text-base text-white font-medium tracking-tight pr-4 leading-relaxed",children:e.description}),(0,a.jsx)("div",{className:"flex items-center gap-3 shrink-0",children:(0,a.jsx)("span",{className:"text-[10px] font-mono text-text-tertiary bg-white/[0.02] px-2.5 py-1 rounded-lg border border-white/5 uppercase tracking-tighter",children:e.activity_type.replace("_"," ")})})]}),(0,a.jsxs)("div",{className:"mt-5 pt-4 border-t border-white/[0.03] flex flex-wrap items-center gap-6 text-[11px] font-bold text-text-tertiary",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 group/time cursor-default",children:[(0,a.jsx)(eo.Z,{className:"w-3.5 h-3.5 transition-colors group-hover/time:text-primary-400"}),(0,a.jsx)("span",{className:"group-hover/time:text-text-secondary transition-colors",children:new Date(e.created_at).toLocaleString([],{dateStyle:"medium",timeStyle:"short"})})]}),(null===(s=e.user_profiles)||void 0===s?void 0:s.email)&&(0,a.jsxs)("div",{className:"flex items-center gap-2 group/user cursor-default",children:[(0,a.jsx)("div",{className:"p-1 bg-white/[0.05] rounded-md transition-colors group-hover/user:bg-white/[0.1]",children:(0,a.jsx)(h.Z,{className:"w-3 h-3 text-text-tertiary group-hover/user:text-white"})}),(0,a.jsx)("span",{className:"text-primary-500/80 group-hover/user:text-primary-400 transition-colors",children:e.user_profiles.email})]})]})]})})})]},e.id)})})]}),"details"===_&&(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"grid grid-cols-1 lg:grid-cols-12 gap-8",children:[(0,a.jsx)("div",{className:"lg:col-span-8 space-y-8",children:(0,a.jsxs)("section",{className:"relative overflow-hidden group bg-[#121214] rounded-[2rem] border border-white/[0.05] p-8 transition-all hover:border-white/[0.1] shadow-2xl",children:[(0,a.jsx)("div",{className:"absolute top-0 right-0 w-32 h-32 bg-primary-500/10 blur-[60px] opacity-0 group-hover:opacity-100 transition-opacity rounded-full"}),(0,a.jsxs)("div",{className:"flex items-center gap-4 mb-8",children:[(0,a.jsx)("div",{className:"p-3 bg-primary-400/10 rounded-2xl text-primary-400 ring-1 ring-primary-400/20",children:(0,a.jsx)(ep.Z,{className:"w-6 h-6"})}),(0,a.jsx)("h2",{className:"text-2xl font-black text-white tracking-tight",children:"Case Overview"})]}),(0,a.jsxs)("div",{className:"space-y-10 px-2",children:[(0,a.jsxs)("div",{className:"relative pl-6 border-l-2 border-white/[0.05] group-hover:border-primary-500/20 transition-colors",children:[(0,a.jsx)("span",{className:"absolute -left-[5px] top-0 w-[8px] h-[8px] rounded-full bg-white/[0.05] group-hover:bg-primary-500/40 transition-colors"}),(0,a.jsx)("label",{className:"text-[10px] font-black uppercase tracking-widest text-text-tertiary block mb-3 opacity-60",children:"Subject Focus"}),(0,a.jsx)("p",{className:"text-xl font-bold text-white tracking-tight leading-snug",children:m.subject||"No Subject Defined"})]}),(0,a.jsxs)("div",{className:"relative pl-6 border-l-2 border-white/[0.05] hover:border-violet-500/20 transition-colors",children:[(0,a.jsx)("span",{className:"absolute -left-[5px] top-0 w-[8px] h-[8px] rounded-full bg-white/[0.05] hover:bg-violet-500/40 transition-colors"}),(0,a.jsx)("label",{className:"text-[10px] font-black uppercase tracking-widest text-text-tertiary block mb-3 opacity-60",children:"Core Description"}),(0,a.jsx)("p",{className:"text-base text-text-secondary whitespace-pre-wrap leading-relaxed pb-2",children:m.description||"Description details stay empty for now."})]}),m.tags&&m.tags.length>0&&(0,a.jsxs)("div",{className:"relative pl-6 border-l-2 border-white/[0.05] hover:border-amber-500/20 transition-colors",children:[(0,a.jsx)("span",{className:"absolute -left-[5px] top-0 w-[8px] h-[8px] rounded-full bg-white/[0.05] hover:bg-amber-500/40 transition-colors"}),(0,a.jsx)("label",{className:"text-[10px] font-black uppercase tracking-widest text-text-tertiary block mb-4 opacity-60",children:"Categorization Tags"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2.5",children:m.tags.map(e=>(0,a.jsx)("span",{className:"px-4 py-1.5 bg-white/[0.03] text-white/70 hover:text-white border border-white/[0.05] hover:border-white/20 rounded-full text-xs font-bold transition-all hover:scale-105 cursor-default hover:shadow-lg",children:e},e))})]}),m.resolution_notes&&(0,a.jsxs)("div",{className:"mt-8 p-6 bg-green-500/5 rounded-[1.5rem] border border-green-500/20 animate-in fade-in slide-in-from-bottom-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,a.jsx)(y.Z,{className:"w-5 h-5 text-green-500"}),(0,a.jsx)("label",{className:"text-xs font-black uppercase tracking-[0.2em] text-green-500",children:"Resolution Strategy"})]}),(0,a.jsxs)("p",{className:"text-sm text-green-100/80 font-medium italic leading-relaxed",children:['"',m.resolution_notes,'"']}),m.resolved_at&&(0,a.jsxs)("div",{className:"mt-4 flex items-center gap-2 text-[10px] font-bold text-green-500/60 pl-1 uppercase tracking-tighter",children:[(0,a.jsx)(eo.Z,{className:"w-3 h-3"}),(0,a.jsxs)("span",{children:["Finalized on ",new Date(m.resolved_at).toLocaleString()]})]})]})]})]})}),(0,a.jsx)("div",{className:"lg:col-span-4 space-y-6",children:m.contacts&&(0,a.jsxs)("section",{className:"bg-[#121214] rounded-[2rem] border border-white/[0.05] p-8 shadow-xl relative overflow-hidden group",children:[(0,a.jsx)("div",{className:"absolute -right-10 -top-10 w-40 h-40 bg-purple-500/5 blur-[50px] rounded-full transition-all group-hover:bg-purple-500/10"}),(0,a.jsxs)("div",{className:"flex items-center gap-4 mb-8",children:[(0,a.jsx)("div",{className:"w-12 h-12 rounded-2xl bg-purple-500/10 border border-purple-500/20 flex items-center justify-center text-purple-400",children:(0,a.jsx)(h.Z,{className:"w-6 h-6"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-black text-white tracking-tight leading-none mb-1",children:"Customer Details"}),(0,a.jsx)("span",{className:"text-[10px] uppercase font-bold text-text-tertiary tracking-widest opacity-60",children:"Direct Contact"})]})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"group/row cursor-default",children:[(0,a.jsx)("span",{className:"text-[10px] font-black uppercase tracking-widest text-text-tertiary block mb-2 group-hover/row:text-purple-400 transition-colors",children:"Identity"}),(0,a.jsx)("p",{className:"text-base text-white font-bold tracking-tight whitespace-nowrap overflow-hidden text-ellipsis group-hover/row:translate-x-1 transition-transform",children:z()})]}),m.contacts.email&&(0,a.jsxs)("div",{className:"group/row cursor-default",children:[(0,a.jsx)("span",{className:"text-[10px] font-black uppercase tracking-widest text-text-tertiary block mb-2 group-hover/row:text-cyan-400 transition-colors",children:"Email Address"}),(0,a.jsxs)("div",{className:"flex items-center gap-3 bg-white/[0.02] border border-white/[0.05] p-3 rounded-xl transition-all hover:bg-white/[0.05] group-hover/row:translate-x-1",children:[(0,a.jsx)(o.Z,{className:"w-3.5 h-3.5 text-text-tertiary"}),(0,a.jsx)("span",{className:"text-sm font-semibold text-white/90 truncate",children:m.contacts.email})]})]}),m.contacts.phone_number&&(0,a.jsxs)("div",{className:"group/row cursor-default",children:[(0,a.jsx)("span",{className:"text-[10px] font-black uppercase tracking-widest text-text-tertiary block mb-2 group-hover/row:text-amber-400 transition-colors",children:"Support Line"}),(0,a.jsxs)("div",{className:"flex items-center gap-3 bg-white/[0.02] border border-white/[0.05] p-3 rounded-xl transition-all hover:bg-white/[0.05] group-hover/row:translate-x-1",children:[(0,a.jsx)(j.Z,{className:"w-3.5 h-3.5 text-text-tertiary"}),(0,a.jsx)("span",{className:"text-sm font-semibold text-white/90 truncate",children:m.contacts.phone_number})]})]})]})]})})]})]})]}):(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,a.jsx)("div",{className:"text-text-secondary",children:"Case not found"})})}function tl(){var e,t;let{state:s}=(0,r.q)(),n=null==s?void 0:s.profile,[c,o]=(0,i.useState)(!1),[d,u]=(0,i.useState)([]),[p,h]=(0,i.useState)([]),[g,b]=(0,i.useState)([]),[f,j]=(0,i.useState)(null),[v,N]=(0,i.useState)(!1),[w,_]=(0,i.useState)(!1),[C,k]=(0,i.useState)(!1),[D,Z]=(0,i.useState)({subject:"",description:"",contact_id:"",assigned_agent_id:"",priority:"normal",status:"new",origin_channel:"",channels_used:"",resolution_notes:"",tags:""}),[E,A]=(0,i.useState)(null),[P,z]=(0,i.useState)(!1),[I,F]=(0,i.useState)(null),[O,T]=(0,i.useState)({subject:"",description:"",contact_id:"",assigned_agent_id:"",priority:"normal",status:"new",tags:""}),[L,M]=(0,i.useState)(!1),[R,U]=(0,i.useState)(!1),[q,Q]=(0,i.useState)(null),[V,H]=(0,i.useState)(!1),B=d.length,K=d.filter(e=>"open"===e.status).length,J=d.filter(e=>"resolved"===e.status).length,Y=d.filter(e=>"escalated"===e.status).length,[G,W]=(0,i.useState)("");(0,i.useRef)(null);let X=(0,i.useRef)(null),[$,ee]=(0,i.useState)(""),[es,ea]=(0,i.useState)(""),[er,ei]=(0,i.useState)(""),[en,el]=(0,i.useState)(""),ec=()=>{let e=window.location.pathname.replace("","").replace(/\/$/,"").match(/^\/support\/(.+)$/);return e?decodeURIComponent(e[1]):null};(0,i.useEffect)(()=>{let e=ec();if(!e)return;let t=d.find(t=>t.case_number===e);if(t){j(t.id);return}(null==n?void 0:n.organization_id)&&l.OQ.from("support_cases").select("id").eq("case_number",e).eq("organization_id",n.organization_id).single().then(t=>{let{data:s,error:a}=t;s&&!a?j(s.id):(console.error("Case not found:",e,a),window.history.replaceState({},"","".concat("","/support")))})},[null==n?void 0:n.organization_id]),(0,i.useEffect)(()=>{let e=()=>{let e=ec();if(e){let t=d.find(t=>t.case_number===e);t?j(t.id):(null==n?void 0:n.organization_id)&&l.OQ.from("support_cases").select("id").eq("case_number",e).eq("organization_id",n.organization_id).single().then(e=>{let{data:t}=e;t&&j(t.id)})}else j(null)};return window.addEventListener("popstate",e),()=>window.removeEventListener("popstate",e)},[]),(0,i.useEffect)(()=>{let e=setTimeout(()=>{ea($)},300);return()=>clearTimeout(e)},[$]);let ed=["new","open","pending_customer","pending_internal","escalated","resolved","closed"],ex={new:"New",open:"Open",pending_customer:"Pending Customer",pending_internal:"Pending Internal",escalated:"Escalated",resolved:"Resolved",closed:"Closed"},eu=ed.reduce((e,t)=>(e[t]=d.filter(e=>e.status===t).length,e),{}),eb=e=>{let t=X.current;if(!t)return;let s=Math.max(200,Math.floor(.6*t.clientWidth));t.scrollBy({left:"left"===e?-s:s,behavior:"smooth"})},[ey,ej]=(0,i.useState)(!0),[ev,eN]=(0,i.useState)(!1),ew=()=>{let e=X.current;if(!e)return;let t=e.scrollLeft<=8,s=e.scrollLeft+e.clientWidth>=e.scrollWidth-8;ej(t),eN(s)};(0,i.useEffect)(()=>{let e=X.current;if(!e)return;let t=()=>ew();return requestAnimationFrame(ew),e.addEventListener("scroll",t),window.addEventListener("resize",t),()=>{e.removeEventListener("scroll",t),window.removeEventListener("resize",t)}},[d]);let e_=e=>{let t=Array.isArray(e.contacts)?e.contacts[0]:e.contacts;return t&&("".concat(t.first_name||""," ").concat(t.last_name||"").trim()||t.email||t.phone_number)||"—"},eC=e=>{let t=Array.isArray(e.contacts)?e.contacts[0]:e.contacts;if(!t)return{name:"—",contactInfo:"",full:"No contact"};let s="".concat(t.first_name||""," ").concat(t.last_name||"").trim(),a=t.email||"",r=t.phone_number||"",i=r||a,n=[s,a,r].filter(Boolean).join(" • ")||"No contact details";return{name:s||a||r||"—",contactInfo:s&&i?i:"",full:n}},ek=d.filter(e=>{if(G&&e.status!==G)return!1;let t=es.toLowerCase();return(!t||!!((e.subject||"").toLowerCase().includes(t)||e.status.toLowerCase().includes(t)||(e.case_number||"").toLowerCase().includes(t)||e_(e).toLowerCase().includes(t)))&&(!er||!!(e.tags||[]).includes(er))&&(!en||e.contact_id===en)}),eD={new:"bg-blue-600 text-white",open:"bg-violet-700 text-white",pending_customer:"bg-amber-500 text-white",pending_internal:"bg-amber-400 text-black",escalated:"bg-red-600 text-white",resolved:"bg-emerald-600 text-white",closed:"bg-slate-600 text-white"},eS={low:"bg-slate-500 text-white",normal:"bg-violet-700 text-white",high:"bg-red-500 text-white",urgent:"bg-pink-600 text-white"},eZ=e=>{let t=e.toLowerCase();return"error"===t||"urgent"===t?"bg-red-600 text-white":"resolved"===t?"bg-emerald-600 text-white":"new"===t?"bg-blue-600 text-white":"billing"===t?"bg-purple-600 text-white":"bg-bg-tertiary text-text-secondary border border-border"},eE=async()=>{if(null==n?void 0:n.organization_id){o(!0);try{let{data:e,error:t}=await l.OQ.from("support_cases").select("\n          id,organization_id,case_number,subject,description,status,priority,tags,\n          assigned_agent_id,contact_id,origin_channel,channels_used,resolution_notes,\n          resolved_at,created_at,updated_at,\n          contacts:contact_id (first_name, last_name, email, phone_number)\n        ").eq("organization_id",n.organization_id).order("created_at",{ascending:!1});if(t)throw console.error("Fetch cases error:",t),t;u(e||[])}catch(e){console.error(e),x.ZP.error("Failed to load support cases")}finally{o(!1)}}},eA=async()=>{if(null==n?void 0:n.organization_id)try{let{data:e}=await l.OQ.from("contacts").select("*").eq("organization_id",n.organization_id);h(e||[])}catch(e){}},eP=async()=>{if(null==n?void 0:n.organization_id)try{let{data:e}=await l.OQ.from("agents").select("*").eq("organization_id",n.organization_id);b(e||[])}catch(e){}};(0,i.useEffect)(()=>{if(null==n?void 0:n.organization_id){eE(),eA(),eP();let e=setTimeout(()=>{0===d.length&&eE()},500);return()=>clearTimeout(e)}},[null==n?void 0:n.organization_id]),(0,i.useEffect)(()=>{if(!(null==n?void 0:n.organization_id))return;let e=n.organization_id,t=l.OQ.channel("contacts-org-".concat(e)).on("postgres_changes",{event:"*",schema:"public",table:"contacts",filter:"organization_id=eq.".concat(e)},()=>{eA()}).subscribe();return()=>{try{l.OQ.removeChannel(t)}catch(e){}}},[null==n?void 0:n.organization_id]);let ez=e=>{if(!e)return"—";let t=g.find(t=>t.id===e);return t?t.name||t.display_name||t.id:e},eI=Array.from(new Set(d.flatMap(e=>e.tags||[]))).sort(),eF=e=>{j(e.id),N(!0),window.history.pushState({},"","".concat("","/support/").concat(encodeURIComponent(e.case_number))),document.title="".concat(e.case_number," - Support - Kai Agent")};(0,i.useEffect)(()=>{let e=e=>{let t=e.target;t&&(t.closest(".support-menu")||t.closest("[data-menu-button-id]")||A(null))};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[]),(0,i.useEffect)(()=>{let e=w||P||R,t=document.body.style.overflow;return e&&(document.body.style.overflow="hidden"),()=>{document.body.style.overflow=t}},[w,P,R]);let eO=e=>{F(e),T({subject:e.subject||"",description:e.description||"",contact_id:e.contact_id||"",assigned_agent_id:e.assigned_agent_id||"",priority:e.priority,status:e.status,tags:(e.tags||[]).join(", ")}),z(!0),A(null)},eT=e=>{Q(e),U(!0),A(null)},eL=async()=>{if(I){M(!0);try{var e,t,s;let a={subject:O.subject.trim()||null,description:(null===(e=O.description)||void 0===e?void 0:e.trim())||null,contact_id:O.contact_id||null,assigned_agent_id:O.assigned_agent_id||null,priority:O.priority,status:O.status,tags:O.tags?O.tags.split(",").map(e=>e.trim()).filter(Boolean):[]},r=[],i=null==n?void 0:n.id;if(I.status!==O.status&&r.push({case_id:I.id,activity_type:"status_change",description:'Status changed from "'.concat(I.status.replace("_"," "),'" to "').concat(O.status.replace("_"," "),'"'),metadata:{old_value:I.status,new_value:O.status},created_by:i}),I.priority!==O.priority&&r.push({case_id:I.id,activity_type:"priority_change",description:'Priority changed from "'.concat(I.priority,'" to "').concat(O.priority,'"'),metadata:{old_value:I.priority,new_value:O.priority},created_by:i}),I.assigned_agent_id!==O.assigned_agent_id){let e=g.find(e=>e.id===I.assigned_agent_id),t=g.find(e=>e.id===O.assigned_agent_id);r.push({case_id:I.id,activity_type:"assigned",description:"Assigned to ".concat((null==t?void 0:t.name)||"Unassigned").concat(e?" (previously: ".concat(e.name,")"):""),metadata:{old_agent_id:I.assigned_agent_id,new_agent_id:O.assigned_agent_id},created_by:i})}let c=I.tags||[],o=O.tags?O.tags.split(",").map(e=>e.trim()).filter(Boolean):[],d=o.filter(e=>!c.includes(e)),m=c.filter(e=>!o.includes(e));d.forEach(e=>{r.push({case_id:I.id,activity_type:"tag_added",description:'Tag added: "'.concat(e,'"'),metadata:{tag:e},created_by:i})}),m.forEach(e=>{r.push({case_id:I.id,activity_type:"tag_removed",description:'Tag removed: "'.concat(e,'"'),metadata:{tag:e},created_by:i})}),(I.subject!==O.subject.trim()||I.description!==(null===(t=O.description)||void 0===t?void 0:t.trim()))&&r.push({case_id:I.id,activity_type:"note_added",description:"Case details updated (subject/description modified)",metadata:{subject_changed:I.subject!==O.subject.trim(),description_changed:I.description!==(null===(s=O.description)||void 0===s?void 0:s.trim())},created_by:i});let{data:u,error:p}=await l.OQ.from("support_cases").update(a).eq("id",I.id).select().single();if(p)throw p;if(r.length>0){let{error:e}=await l.OQ.from("case_activities").insert(r);e&&console.error("Failed to create activity entries:",e)}x.ZP.success("Support case updated"),z(!1),F(null),eE()}catch(t){console.error(t);let e=t&&t.message?t.message:"Failed to update case";x.ZP.error(e)}finally{M(!1)}}},eM=async e=>{H(!0);try{let{error:t}=await l.OQ.from("support_cases").delete().eq("id",e);if(t)throw t;x.ZP.success("Case deleted"),U(!1),Q(null),eE()}catch(e){console.error(e),x.ZP.error("Failed to delete case")}finally{H(!1)}},eR=async()=>{if(console.log("\uD83D\uDCDD Opening create case modal...",{organizationId:null==n?void 0:n.organization_id}),!(null==n?void 0:n.organization_id)){x.ZP.error("Organization not found. Please sign in again.");return}await eA(),_(!0),console.log("✅ Create modal opened")},eU=async()=>{if(console.log("\uD83D\uDCDD Creating new case...",D),!D.subject.trim()){x.ZP.error("Subject is required");return}if(!(null==n?void 0:n.organization_id)){x.ZP.error("Organization not found. Please sign in again.");return}k(!0);try{var e,t,s;let a={organization_id:n.organization_id,subject:D.subject.trim(),description:(null===(e=D.description)||void 0===e?void 0:e.trim())||null,contact_id:D.contact_id||null,assigned_agent_id:D.assigned_agent_id||null,priority:D.priority,status:D.status,origin_channel:D.origin_channel||null,channels_used:D.channels_used?D.channels_used.split(",").map(e=>e.trim()).filter(Boolean):[],tags:D.tags?D.tags.split(",").map(e=>e.trim()).filter(Boolean):[],resolution_notes:(null===(t=D.resolution_notes)||void 0===t?void 0:t.trim())||null};console.log("\uD83D\uDCE4 Inserting case data:",a);let{data:r,error:i}=await l.OQ.from("support_cases").insert(a).select().single();if(i)throw console.error("❌ Case creation error:",i),i;console.log("✅ Case created successfully:",r);let c=null==n?void 0:n.id,o=D.contact_id?(null===(s=p.find(e=>e.id===D.contact_id))||void 0===s?void 0:s.first_name)||"Unknown":"No contact";await l.OQ.from("case_activities").insert({case_id:r.id,activity_type:"created",description:"Support case created for ".concat(o),metadata:{subject:D.subject.trim(),priority:D.priority,status:D.status,origin_channel:D.origin_channel},created_by:c}),x.ZP.success("Support case created"),_(!1),Z({subject:"",description:"",contact_id:"",assigned_agent_id:"",priority:"normal",status:"new",origin_channel:"",channels_used:"",resolution_notes:"",tags:""}),eE()}catch(t){console.error("Failed to create support case",t);let e=t&&t.message?t.message:"Failed to create support case";x.ZP.error(e)}finally{k(!1)}},eq=w||P||R;return f?(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(tn,{caseId:f,showParentSpinner:v,onLoaded:()=>N(!1),onBack:()=>{j(null),N(!1),window.history.pushState({},"","".concat("","/support")),document.title="Support - Kai Agent",eE()}}),v&&(0,a.jsx)("div",{className:"absolute inset-0 z-50 flex items-center justify-center bg-[#080809]/80 backdrop-blur-sm",children:(0,a.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,a.jsx)("div",{className:"w-12 h-12 rounded-full border-4 border-white/10 border-t-transparent animate-spin"}),(0,a.jsx)("div",{className:"text-sm text-text-tertiary",children:"Loading case details..."})]})})]}):(0,a.jsxs)("div",{className:"relative min-h-screen",children:[(0,a.jsxs)("div",{className:"space-y-6 py-2 transition-all duration-300 ".concat(eq?"opacity-30 blur-[2px] pointer-events-none":"opacity-100 blur-0"),children:[(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsx)("h1",{className:"text-3xl md:text-4xl font-bold tracking-tight text-white",children:"Support Cases"})}),(0,a.jsx)("style",{children:".no-scrollbar::-webkit-scrollbar{display:none}.no-scrollbar{-ms-overflow-style:none;scrollbar-width:none}.support-table{width:100%}.support-table th:not(:first-child),.support-table td:not(:first-child){border-left:1px solid rgba(255,255,255,0.06);padding-left:0.75rem}"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("button",{onClick:()=>eb("left"),className:"absolute left-2 top-1/2 -translate-y-1/2 z-30 p-2 rounded-full bg-black/40 hover:bg-black/60 transition-opacity duration-200 cursor-pointer ".concat(ey?"opacity-0 pointer-events-none":"opacity-100"),"aria-hidden":ey,children:(0,a.jsx)(ta.Z,{className:"w-5 h-5 text-white"})}),(0,a.jsxs)("div",{ref:X,tabIndex:0,role:"region","aria-label":"KPI cards",onKeyDown:e=>{"ArrowLeft"===e.key?(e.preventDefault(),eb("left")):"ArrowRight"===e.key&&(e.preventDefault(),eb("right"))},className:"w-full flex gap-6 overflow-x-auto no-scrollbar py-4 px-4",children:[(0,a.jsxs)("div",{className:"rounded-2xl min-w-[280px] p-6 bg-[#2a2a2b] text-white shadow-lg flex items-center gap-4",children:[(0,a.jsx)("div",{className:"w-12 h-12 rounded-md bg-purple-700 flex items-center justify-center",children:(0,a.jsx)(ep.Z,{className:"w-5 h-5 text-white/90"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"text-sm text-text-secondary",children:"Total Cases"}),(0,a.jsx)("div",{className:"text-2xl font-bold",children:B})]})]}),(0,a.jsxs)("div",{className:"rounded-2xl min-w-[280px] p-6 bg-[#2a2a2b] text-white shadow-lg flex items-center gap-4",children:[(0,a.jsx)("div",{className:"w-12 h-12 rounded-md bg-sky-600 flex items-center justify-center",children:(0,a.jsx)(eo.Z,{className:"w-5 h-5 text-white/90"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"text-sm text-text-secondary",children:"Open"}),(0,a.jsx)("div",{className:"text-2xl font-bold",children:K})]})]}),(0,a.jsxs)("div",{className:"rounded-2xl min-w-[280px] p-6 bg-[#2a2a2b] text-white shadow-lg flex items-center gap-4",children:[(0,a.jsx)("div",{className:"w-12 h-12 rounded-md bg-red-600 flex items-center justify-center",children:(0,a.jsx)(tr.Z,{className:"w-5 h-5 text-white/90"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"text-sm text-text-secondary",children:"Escalated"}),(0,a.jsx)("div",{className:"text-2xl font-bold",children:Y})]})]}),(0,a.jsxs)("div",{className:"rounded-2xl min-w-[280px] p-6 bg-[#2a2a2b] text-white shadow-lg flex items-center gap-4",children:[(0,a.jsx)("div",{className:"w-12 h-12 rounded-md bg-emerald-600 flex items-center justify-center",children:(0,a.jsx)(y.Z,{className:"w-5 h-5 text-white/90"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"text-sm text-text-secondary",children:"Resolved"}),(0,a.jsx)("div",{className:"text-2xl font-bold",children:J})]})]}),(0,a.jsxs)("div",{className:"rounded-2xl min-w-[280px] p-6  bg-[#2a2a2b] text-white shadow-lg flex items-center gap-4",children:[(0,a.jsx)("div",{className:"w-12 h-12 rounded-md bg-amber-500 flex items-center justify-center",children:(0,a.jsx)(eo.Z,{className:"w-5 h-5 text-white/90"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"text-sm text-text-secondary",children:"Pending Customer"}),(0,a.jsx)("div",{className:"text-2xl font-bold",children:eu.pending_customer||0})]})]}),(0,a.jsxs)("div",{className:"rounded-2xl min-w-[280px] p-6 bg-[#2a2a2b] text-white shadow-lg flex items-center gap-4",children:[(0,a.jsx)("div",{className:"w-12 h-12 rounded-md bg-amber-400 flex items-center justify-center",children:(0,a.jsx)(ep.Z,{className:"w-5 h-5 text-white/90"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"text-sm text-text-secondary",children:"Pending Internal"}),(0,a.jsx)("div",{className:"text-2xl font-bold",children:eu.pending_internal||0})]})]}),(0,a.jsxs)("div",{className:"rounded-2xl min-w-[280px] p-6 bg-[#2a2a2b] text-white shadow-lg flex items-center gap-4",children:[(0,a.jsx)("div",{className:"w-12 h-12 rounded-md bg-slate-600 flex items-center justify-center",children:(0,a.jsx)(y.Z,{className:"w-5 h-5 text-white/90"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"text-sm text-text-secondary",children:"Closed"}),(0,a.jsx)("div",{className:"text-2xl font-bold",children:eu.closed||0})]})]})]}),(0,a.jsx)("button",{onClick:()=>eb("right"),className:"absolute right-2 top-1/2 -translate-y-1/2 z-30 p-2 rounded-full bg-black/40 hover:bg-black/60 transition-opacity duration-200 cursor-pointer ".concat(ev?"opacity-0 pointer-events-none":"opacity-100"),"aria-hidden":ev,children:(0,a.jsx)(e1.Z,{className:"w-5 h-5 text-white"})}),(0,a.jsx)("div",{onClick:()=>eb("right"),className:"pointer-events-auto absolute right-0 top-0 bottom-0 w-16 bg-gradient-to-l from-black/40 to-transparent z-10"}),(0,a.jsx)("div",{onClick:()=>eb("left"),className:"pointer-events-auto absolute left-0 top-0 bottom-0 w-16 bg-gradient-to-r from-black/40 to-transparent z-10"})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3",children:[(0,a.jsx)("input",{value:$,onChange:e=>ee(e.target.value),placeholder:"Search by subject, case #, or name...",className:"input-field bg-[#0b0b0d] border-gray-400"}),(0,a.jsxs)("select",{value:G,onChange:e=>W(e.target.value),className:"input-field bg-[#0b0b0d] border-gray-400",children:[(0,a.jsx)("option",{value:"",children:"All Statuses"}),ed.map(e=>(0,a.jsx)("option",{value:e,children:ex[e]},e))]}),(0,a.jsxs)("select",{value:er,onChange:e=>ei(e.target.value),className:"input-field bg-[#0b0b0d] border-gray-400",children:[(0,a.jsx)("option",{value:"",children:"All Tags"}),eI.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]}),(0,a.jsxs)("select",{value:en,onChange:e=>el(e.target.value),className:"input-field bg-[#0b0b0d] border-gray-400",children:[(0,a.jsx)("option",{value:"",children:"All Customers"}),p.map(e=>{let t=e.full_name||e.name||e.first_name||"",s=e.phone||e.phone_number||e.mobile||"",r=e.email||"",i=t?"".concat(t).concat(s?" — ".concat(s):r?" — ".concat(r):""):s||r||"Unnamed contact";return(0,a.jsx)("option",{value:e.id,children:i},e.id)})]})]}),($||G||er||en)&&(0,a.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,a.jsx)("span",{className:"text-xs text-text-tertiary",children:"Active filters:"}),$&&(0,a.jsxs)("span",{className:"px-2 py-1 bg-blue-500/20 text-blue-400 rounded text-xs",children:["Search: ",$]}),G&&(0,a.jsxs)("span",{className:"px-2 py-1 bg-purple-500/20 text-purple-400 rounded text-xs",children:["Status: ",ex[G]]}),er&&(0,a.jsxs)("span",{className:"px-2 py-1 bg-yellow-500/20 text-yellow-400 rounded text-xs",children:["Tag: ",er]}),en&&(0,a.jsxs)("span",{className:"px-2 py-1 bg-cyan-500/20 text-cyan-400 rounded text-xs",children:["Customer: ",(null===(e=p.find(e=>e.id===en))||void 0===e?void 0:e.first_name)||(null===(t=p.find(e=>e.id===en))||void 0===t?void 0:t.name)||"Selected"]}),(0,a.jsx)("button",{onClick:()=>{ee(""),W(""),ei(""),el("")},className:"text-xs text-red-400 hover:text-red-300 underline",children:"Clear all filters"})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)("button",{onClick:eE,className:"btn-secondary flex items-center gap-2",children:[(0,a.jsx)(S.Z,{className:"w-4 h-4"})," Refresh"]}),(0,a.jsxs)("button",{onClick:()=>{if(!(null==n?void 0:n.organization_id)){x.ZP.error("Organization not found. Please sign in again.");return}eR()},className:"btn-primary flex items-center gap-2 ".concat((null==n?void 0:n.organization_id)?"":"opacity-60 cursor-not-allowed"),disabled:!(null==n?void 0:n.organization_id),children:[(0,a.jsx)(em.Z,{className:"w-4 h-4"})," ",(0,a.jsx)("span",{children:"New Case"})]})]})]}),(0,a.jsx)("div",{className:"card p-4",children:c?(0,a.jsx)("div",{className:"text-sm text-text-secondary",children:"Loading..."}):0===d.length?(0,a.jsxs)("div",{className:"py-12 text-center",children:[(0,a.jsx)("div",{className:"mx-auto w-24 h-24 rounded-lg bg-[#0f0f11] flex items-center justify-center border border-border",children:(0,a.jsx)(et.Z,{className:"w-10 h-10 text-text-tertiary"})}),(0,a.jsxs)("div",{className:"mt-6",children:[(0,a.jsx)("div",{className:"text-lg font-semibold text-white",children:"No cases found"}),(0,a.jsx)("div",{className:"text-sm text-text-secondary mt-2",children:"No support cases have been created yet."}),(0,a.jsxs)("div",{className:"mt-4 flex items-center justify-center gap-3",children:[(0,a.jsxs)("button",{onClick:eE,className:"btn-secondary flex items-center gap-2",children:[(0,a.jsx)(S.Z,{className:"w-4 h-4"})," Refresh"]}),(0,a.jsxs)("button",{onClick:()=>eR(),className:"btn-primary flex items-center gap-2",children:[(0,a.jsx)(em.Z,{className:"w-4 h-4"})," New Case"]})]})]})]}):(0,a.jsx)(a.Fragment,{children:0===ek.length?(0,a.jsxs)("div",{className:"py-8 text-center",children:[(0,a.jsx)("div",{className:"text-sm text-text-secondary",children:"No cases for selected status."}),(0,a.jsx)("div",{className:"mt-3",children:(0,a.jsx)("button",{onClick:()=>W(""),className:"btn-secondary",children:"Clear filter"})})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"md:hidden space-y-3 w-full",children:ek.map(e=>(0,a.jsxs)("div",{className:"bg-[#0f0f11] p-3 rounded-lg border border-border w-full max-w-full overflow-hidden break-words",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("button",{onClick:()=>eF(e),className:"text-xs !text-text-secondary hover:!text-primary-400 focus:!text-primary-400 font-medium hover:underline transition-colors duration-150 cursor-pointer",children:e.case_number}),(0,a.jsx)("div",{className:"font-semibold truncate text-sm",children:e.subject||"—"}),(0,a.jsxs)("div",{className:"text-xs text-text-secondary mt-1",children:["Customer: ",e_(e)]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 shrink-0 ml-2",children:[(0,a.jsx)("button",{onClick:t=>{t.stopPropagation(),eF(e),A(null)},className:"w-8 h-8 flex items-center justify-center rounded hover:bg-bg-tertiary",title:"View details",children:(0,a.jsx)(m.Z,{className:"w-4 h-4 text-text-tertiary"})}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("button",{"data-menu-button-id":e.id,onClick:t=>{t.stopPropagation(),A(t=>t===e.id?null:e.id)},className:"w-8 h-8 flex items-center justify-center rounded hover:bg-bg-tertiary",children:(0,a.jsx)(ef.Z,{className:"w-4 h-4 text-text-tertiary"})}),E===e.id&&(0,a.jsxs)("div",{onClick:e=>e.stopPropagation(),className:"absolute right-0 mt-2 w-40 bg-bg-primary border border-border rounded shadow-md z-40 support-menu",children:[(0,a.jsxs)("button",{onClick:()=>eO(e),className:"w-full text-left px-3 py-2 hover:bg-bg-tertiary flex items-center gap-2",children:[(0,a.jsx)(eh.Z,{className:"w-4 h-4"})," Edit"]}),(0,a.jsxs)("button",{onClick:()=>eT(e),className:"w-full text-left px-3 py-2 hover:bg-red-600 flex items-center gap-2 text-red-50",children:[(0,a.jsx)(eg.Z,{className:"w-4 h-4"})," Delete"]})]})]})]})]}),(0,a.jsxs)("div",{className:"mt-2 flex items-center gap-2 flex-wrap",children:[(0,a.jsx)("span",{className:"inline-flex items-center whitespace-nowrap px-2 py-0.5 text-xs font-semibold rounded-full ".concat(eD[e.status]||"bg-bg-tertiary text-text-secondary"),children:e.status}),(0,a.jsx)("span",{className:"inline-flex items-center whitespace-nowrap px-2 py-0.5 text-xs font-semibold rounded-full ".concat(eS[e.priority]||"bg-bg-tertiary text-text-secondary"),children:e.priority})]}),(0,a.jsxs)("div",{className:"mt-2",children:[(0,a.jsx)("div",{className:"text-xs text-text-secondary",children:"Tags"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2 mt-2",children:e.tags&&e.tags.length>0?e.tags.map(e=>(0,a.jsx)("span",{className:"inline-flex items-center gap-1 whitespace-nowrap px-2 py-0.5 rounded-full text-xs ".concat(eZ(e)),children:e},e)):(0,a.jsx)("span",{className:"text-text-tertiary",children:"—"})})]})]},e.id))}),(0,a.jsx)("div",{className:"hidden md:grid lg:hidden grid-cols-2 gap-3 w-full",children:ek.map(e=>(0,a.jsxs)("div",{className:"bg-[#0f0f11] p-3 rounded-lg border border-border w-full max-w-full overflow-hidden break-words",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("button",{onClick:()=>eF(e),className:"text-xs !text-text-secondary hover:!text-primary-400 focus:!text-primary-400 font-medium hover:underline transition-colors duration-150 cursor-pointer",children:e.case_number}),(0,a.jsx)("div",{className:"font-semibold truncate text-sm",children:e.subject||"—"})]}),(0,a.jsx)("div",{className:"flex items-center gap-2 shrink-0 ml-2",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("button",{"data-menu-button-id":e.id,onClick:t=>{t.stopPropagation(),A(t=>t===e.id?null:e.id)},className:"w-8 h-8 flex items-center justify-center rounded hover:bg-bg-tertiary",children:(0,a.jsx)(ef.Z,{className:"w-4 h-4 text-text-tertiary"})}),E===e.id&&(0,a.jsxs)("div",{onClick:e=>e.stopPropagation(),className:"absolute right-0 mt-2 w-40 bg-bg-primary border border-border rounded shadow-md z-40 support-menu",children:[(0,a.jsxs)("button",{onClick:()=>eO(e),className:"w-full text-left px-3 py-2 hover:bg-bg-tertiary flex items-center gap-2",children:[(0,a.jsx)(eh.Z,{className:"w-4 h-4"})," Edit"]}),(0,a.jsxs)("button",{onClick:()=>eT(e),className:"w-full text-left px-3 py-2 hover:bg-red-600 flex items-center gap-2 text-red-50",children:[(0,a.jsx)(eg.Z,{className:"w-4 h-4"})," Delete"]})]})]})})]}),(0,a.jsxs)("div",{className:"mt-2 flex items-center gap-2 flex-wrap",children:[(0,a.jsx)("span",{className:"inline-flex items-center whitespace-nowrap px-2 py-0.5 text-xs font-semibold rounded-full ".concat(eD[e.status]||"bg-bg-tertiary text-text-secondary"),children:e.status}),(0,a.jsx)("span",{className:"inline-flex items-center whitespace-nowrap px-2 py-0.5 text-xs font-semibold rounded-full ".concat(eS[e.priority]||"bg-bg-tertiary text-text-secondary"),children:e.priority})]}),(0,a.jsxs)("div",{className:"mt-2",children:[(0,a.jsx)("div",{className:"text-xs text-text-secondary",children:"Tags"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2 mt-2",children:e.tags&&e.tags.length>0?e.tags.map(e=>(0,a.jsx)("span",{className:"inline-flex items-center gap-1 whitespace-nowrap px-2 py-0.5 rounded-full text-xs ".concat(eZ(e)),children:e},e)):(0,a.jsx)("span",{className:"text-text-tertiary",children:"—"})})]})]},e.id))}),(0,a.jsx)("div",{className:"hidden lg:block",children:(0,a.jsx)("div",{className:"overflow-x-auto no-scrollbar relative",children:(0,a.jsxs)("table",{className:"support-table w-full text-sm",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"text-text-secondary text-xs uppercase divide-x divide-white/[0.06]",children:[(0,a.jsx)("th",{className:"text-left py-2 px-3",children:"Case #"}),(0,a.jsx)("th",{className:"text-left py-2 px-3",children:"Subject"}),(0,a.jsx)("th",{className:"text-left py-2 px-3",title:"Contact associated with this case",children:"Customer"}),(0,a.jsx)("th",{className:"text-left py-2 px-3",children:"Status"}),(0,a.jsx)("th",{className:"text-left py-2 px-3 whitespace-nowrap",children:"Priority"}),(0,a.jsx)("th",{className:"text-left py-2 px-3",children:"Tags"}),(0,a.jsx)("th",{className:"text-left py-2 px-3 whitespace-nowrap",children:"Assigned"}),(0,a.jsx)("th",{className:"text-left py-2 px-3",children:"Created"}),(0,a.jsx)("th",{className:"text-right py-2 px-3 bg-transparent",style:{width:"50px"},children:" "})]})}),(0,a.jsx)("tbody",{children:ek.map(e=>(0,a.jsxs)("tr",{className:"border-t divide-x divide-white/[0.06]",children:[(0,a.jsx)("td",{className:"py-3 px-3",children:(0,a.jsx)("button",{onClick:()=>eF(e),className:"text-xs !text-text-secondary hover:!text-primary-400 focus:!text-primary-400 font-medium hover:underline transition-colors duration-150 cursor-pointer",children:e.case_number})}),(0,a.jsx)("td",{className:"py-3 px-3 truncate",title:e.subject||"",children:e.subject||"—"}),(0,a.jsx)("td",{className:"py-3 px-3",title:eC(e).full,children:(0,a.jsxs)("div",{className:"max-w-[200px]",children:[(0,a.jsx)("div",{className:"truncate font-medium",children:eC(e).name}),eC(e).contactInfo&&(0,a.jsx)("div",{className:"truncate text-xs text-text-tertiary mt-0.5",children:eC(e).contactInfo})]})}),(0,a.jsx)("td",{className:"py-3 px-3",children:(0,a.jsx)("span",{className:"inline-flex items-center whitespace-nowrap px-2 py-1 text-xs font-semibold rounded-full ".concat(eD[e.status]||"bg-bg-tertiary text-text-secondary"),children:e.status})}),(0,a.jsx)("td",{className:"py-3 px-3",children:(0,a.jsx)("span",{className:"inline-flex items-center whitespace-nowrap px-2 py-1 text-xs font-semibold rounded-full ".concat(eS[e.priority]||"bg-bg-tertiary text-text-secondary"),children:e.priority})}),(0,a.jsx)("td",{className:"py-3 px-3",children:(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:e.tags&&e.tags.length>0?e.tags.map(e=>(0,a.jsx)("span",{className:"inline-flex items-center gap-1 whitespace-nowrap px-2 py-0.5 rounded-full text-xs ".concat(eZ(e)),children:e},e)):(0,a.jsx)("span",{className:"text-text-tertiary",children:"—"})})}),(0,a.jsx)("td",{className:"py-3 px-3",children:ez(e.assigned_agent_id)}),(0,a.jsx)("td",{className:"py-3 px-3 truncate whitespace-nowrap",title:new Date(e.created_at).toLocaleString(),children:new Date(e.created_at).toLocaleDateString()}),(0,a.jsx)("td",{className:"py-3 px-3 text-right align-middle",style:{overflow:"visible"},children:(0,a.jsx)("div",{className:"flex items-center justify-end",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("button",{"data-menu-button-id":e.id,onClick:t=>{t.stopPropagation(),A(t=>t===e.id?null:e.id)},className:"w-9 h-9 flex items-center justify-center rounded hover:bg-bg-tertiary",children:(0,a.jsx)(ef.Z,{className:"w-4 h-4 text-text-tertiary"})}),E===e.id&&(0,a.jsxs)("div",{onClick:e=>e.stopPropagation(),className:"absolute right-0 mt-2 w-44 bg-bg-primary border border-border rounded shadow-md z-40 support-menu",children:[(0,a.jsxs)("button",{onClick:()=>eO(e),className:"w-full text-left px-3 py-2 hover:bg-green-500 flex items-center gap-2",children:[(0,a.jsx)(eh.Z,{className:"w-4 h-4"})," Edit"]}),(0,a.jsxs)("button",{onClick:()=>eT(e),className:"w-full text-left px-3 py-2 hover:bg-red-600 flex items-center gap-2 text-red-50",children:[(0,a.jsx)(eg.Z,{className:"w-4 h-4"})," Delete"]})]})]})})})]},e.id))})]})})})]})})})]}),w&&(0,a.jsxs)("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-black/95 backdrop-blur-2xl",onClick:()=>_(!1)}),(0,a.jsxs)("div",{className:"relative z-10 w-full max-w-2xl bg-[#111113] rounded-2xl shadow-[0_0_50px_rgba(0,0,0,0.8)] overflow-hidden border border-white/10 max-h-[90vh] flex flex-col",children:[(0,a.jsxs)("div",{className:"p-6 flex items-start gap-4 border-b border-white/5",children:[(0,a.jsx)("div",{className:"w-14 h-14 rounded-xl bg-gradient-to-br from-purple-600 to-indigo-600 flex items-center justify-center shadow-lg shadow-purple-500/20",children:(0,a.jsx)(em.Z,{className:"w-6 h-6 text-white"})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("h3",{className:"text-xl font-bold text-white",children:"New Support Case"}),(0,a.jsx)("p",{className:"text-sm text-text-secondary mt-1",children:"Create a new support case to track customer issues."})]}),(0,a.jsx)("button",{onClick:()=>_(!1),className:"w-10 h-10 flex items-center justify-center text-text-secondary hover:text-white hover:bg-white/5 rounded-lg transition-colors border border-white/10",children:"✕"})]}),(0,a.jsxs)("div",{className:"p-6 space-y-5 overflow-auto flex-1",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-xs font-semibold uppercase tracking-wider text-text-tertiary mb-2 block",children:"Subject *"}),(0,a.jsx)("input",{value:D.subject,onChange:e=>Z(t=>({...t,subject:e.target.value})),className:"input-field w-full bg-[#080809] border-white/5 focus:border-purple-500/50",placeholder:"Brief summary of the issue"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-xs font-semibold uppercase tracking-wider text-text-tertiary mb-2 block",children:"Description"}),(0,a.jsx)("textarea",{value:D.description,onChange:e=>Z(t=>({...t,description:e.target.value})),className:"input-field w-full min-h-[120px] bg-[#080809] border-white/5 focus:border-purple-500/50 py-3",placeholder:"Provide more details about the customer's request..."})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-xs font-semibold uppercase tracking-wider text-text-tertiary mb-2 block",children:"Contact"}),(0,a.jsxs)("select",{value:D.contact_id,onChange:e=>Z(t=>({...t,contact_id:e.target.value})),className:"input-field w-full bg-[#080809] border-white/5",children:[(0,a.jsx)("option",{value:"",children:"Unassigned"}),p.map(e=>{let t=e.full_name||e.name||e.first_name||"",s=e.phone||e.phone_number||e.mobile||"",r=e.email||"",i=t?"".concat(t).concat(s?" — ".concat(s):r?" — ".concat(r):""):s||r||"Unnamed contact";return(0,a.jsx)("option",{value:e.id,children:i},e.id)})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-xs font-semibold uppercase tracking-wider text-text-tertiary mb-2 block",children:"Assigned Agent"}),(0,a.jsxs)("select",{value:D.assigned_agent_id,onChange:e=>Z(t=>({...t,assigned_agent_id:e.target.value})),className:"input-field w-full bg-[#080809] border-white/5",children:[(0,a.jsx)("option",{value:"",children:"Unassigned"}),g.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name||e.display_name},e.id))]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-xs font-semibold uppercase tracking-wider text-text-tertiary mb-2 block",children:"Priority"}),(0,a.jsxs)("select",{value:D.priority,onChange:e=>Z(t=>({...t,priority:e.target.value})),className:"input-field w-full bg-[#080809] border-white/5",children:[(0,a.jsx)("option",{value:"low",children:"Low"}),(0,a.jsx)("option",{value:"normal",children:"Normal"}),(0,a.jsx)("option",{value:"high",children:"High"}),(0,a.jsx)("option",{value:"urgent",children:"Urgent"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-xs font-semibold uppercase tracking-wider text-text-tertiary mb-2 block",children:"Status"}),(0,a.jsxs)("select",{value:D.status,onChange:e=>Z(t=>({...t,status:e.target.value})),className:"input-field w-full bg-[#080809] border-white/5",children:[(0,a.jsx)("option",{value:"new",children:"New"}),(0,a.jsx)("option",{value:"open",children:"Open"}),(0,a.jsx)("option",{value:"pending_customer",children:"Pending Customer"}),(0,a.jsx)("option",{value:"pending_internal",children:"Pending Internal"}),(0,a.jsx)("option",{value:"escalated",children:"Escalated"}),(0,a.jsx)("option",{value:"resolved",children:"Resolved"}),(0,a.jsx)("option",{value:"closed",children:"Closed"})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-xs font-semibold uppercase tracking-wider text-text-tertiary mb-2 block",children:"Tags (comma-separated)"}),(0,a.jsx)("input",{value:D.tags,onChange:e=>Z(t=>({...t,tags:e.target.value})),className:"input-field w-full bg-[#080809] border-white/5",placeholder:"billing, feature-request, bug"})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-end gap-3 px-6 py-4 border-t border-white/5 bg-[#0a0a0c]",children:[(0,a.jsx)("button",{onClick:()=>_(!1),className:"px-5 py-2.5 rounded-xl border border-white/10 hover:bg-white/5 text-text-secondary transition-colors",children:"Cancel"}),(0,a.jsx)("button",{onClick:eU,disabled:C,className:"px-6 py-2.5 rounded-xl bg-gradient-to-r from-purple-600 to-indigo-600 text-white font-semibold shadow-lg shadow-purple-600/20 disabled:opacity-50 transition-all hover:scale-[1.02] active:scale-[0.98]",children:C?"Creating...":"Create Case"})]})]})]}),P&&I&&(0,a.jsxs)("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-black/95 backdrop-blur-2xl",onClick:()=>z(!1)}),(0,a.jsxs)("div",{className:"relative z-10 w-full max-w-2xl bg-[#111113] rounded-2xl shadow-[0_0_50px_rgba(0,0,0,0.8)] overflow-hidden border border-white/10 max-h-[90vh] flex flex-col",children:[(0,a.jsxs)("div",{className:"p-6 flex items-start gap-4 border-b border-white/5",children:[(0,a.jsx)("div",{className:"w-14 h-14 rounded-xl bg-gradient-to-br from-emerald-500 to-teal-600 flex items-center justify-center shadow-lg shadow-emerald-500/20",children:(0,a.jsx)(eh.Z,{className:"w-6 h-6 text-white"})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("h3",{className:"text-xl font-bold text-white",children:"Edit Support Case"}),(0,a.jsx)("p",{className:"text-sm text-text-secondary mt-1",children:"Update case details and status."})]}),(0,a.jsx)("button",{onClick:()=>z(!1),className:"w-10 h-10 flex items-center justify-center text-text-secondary hover:text-white hover:bg-white/5 rounded-lg transition-colors border border-white/10",children:"✕"})]}),(0,a.jsxs)("div",{className:"p-6 space-y-5 overflow-auto flex-1",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-xs font-semibold uppercase tracking-wider text-text-tertiary mb-2 block",children:"Subject *"}),(0,a.jsx)("input",{value:O.subject,onChange:e=>T(t=>({...t,subject:e.target.value})),className:"input-field w-full bg-[#080809] border-white/5 focus:border-emerald-500/50"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-xs font-semibold uppercase tracking-wider text-text-tertiary mb-2 block",children:"Description"}),(0,a.jsx)("textarea",{value:O.description,onChange:e=>T(t=>({...t,description:e.target.value})),className:"input-field w-full min-h-[120px] bg-[#080809] border-white/5 focus:border-emerald-500/50 py-3"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-xs font-semibold uppercase tracking-wider text-text-tertiary mb-2 block",children:"Contact"}),(0,a.jsxs)("select",{value:O.contact_id,onChange:e=>T(t=>({...t,contact_id:e.target.value})),className:"input-field w-full bg-[#080809] border-white/5",children:[(0,a.jsx)("option",{value:"",children:"Unassigned"}),p.map(e=>{let t=e.full_name||e.name||e.first_name||"",s=e.phone||e.phone_number||e.mobile||"",r=e.email||"",i=t?"".concat(t).concat(s?" — ".concat(s):r?" — ".concat(r):""):s||r||"Unnamed contact";return(0,a.jsx)("option",{value:e.id,children:i},e.id)})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-xs font-semibold uppercase tracking-wider text-text-tertiary mb-2 block",children:"Assigned Agent"}),(0,a.jsxs)("select",{value:O.assigned_agent_id,onChange:e=>T(t=>({...t,assigned_agent_id:e.target.value})),className:"input-field w-full bg-[#080809] border-white/5",children:[(0,a.jsx)("option",{value:"",children:"Unassigned"}),g.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name||e.display_name},e.id))]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-xs font-semibold uppercase tracking-wider text-text-tertiary mb-2 block",children:"Priority"}),(0,a.jsxs)("select",{value:O.priority,onChange:e=>T(t=>({...t,priority:e.target.value})),className:"input-field w-full bg-[#080809] border-white/5",children:[(0,a.jsx)("option",{value:"low",children:"Low"}),(0,a.jsx)("option",{value:"normal",children:"Normal"}),(0,a.jsx)("option",{value:"high",children:"High"}),(0,a.jsx)("option",{value:"urgent",children:"Urgent"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-xs font-semibold uppercase tracking-wider text-text-tertiary mb-2 block",children:"Status"}),(0,a.jsxs)("select",{value:O.status,onChange:e=>T(t=>({...t,status:e.target.value})),className:"input-field w-full bg-[#080809] border-white/5",children:[(0,a.jsx)("option",{value:"new",children:"New"}),(0,a.jsx)("option",{value:"open",children:"Open"}),(0,a.jsx)("option",{value:"pending_customer",children:"Pending Customer"}),(0,a.jsx)("option",{value:"pending_internal",children:"Pending Internal"}),(0,a.jsx)("option",{value:"escalated",children:"Escalated"}),(0,a.jsx)("option",{value:"resolved",children:"Resolved"}),(0,a.jsx)("option",{value:"closed",children:"Closed"})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-xs font-semibold uppercase tracking-wider text-text-tertiary mb-2 block",children:"Tags (comma-separated)"}),(0,a.jsx)("input",{value:O.tags,onChange:e=>T(t=>({...t,tags:e.target.value})),className:"input-field w-full bg-[#080809] border-white/5"})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-end gap-3 px-6 py-4 border-t border-white/5 bg-[#0a0a0c]",children:[(0,a.jsx)("button",{onClick:()=>z(!1),className:"px-5 py-2.5 rounded-xl border border-white/10 hover:bg-white/5 text-text-secondary transition-colors",children:"Cancel"}),(0,a.jsx)("button",{onClick:eL,className:"px-8 py-2.5 rounded-xl bg-gradient-to-r from-emerald-500 to-teal-600 text-white font-semibold shadow-lg shadow-emerald-600/20 transition-all hover:scale-[1.02] active:scale-[0.98]",children:"Save"})]})]})]}),R&&q&&(0,a.jsxs)("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-black/95 backdrop-blur-2xl",onClick:()=>{U(!1),Q(null)}}),(0,a.jsxs)("div",{className:"relative z-10 w-full max-w-md bg-[#111113] rounded-2xl shadow-[0_0_50px_rgba(0,0,0,0.8)] overflow-hidden border border-white/10 flex flex-col",children:[(0,a.jsxs)("div",{className:"p-8 flex flex-col items-center text-center",children:[(0,a.jsx)("div",{className:"w-16 h-16 rounded-full bg-red-500/10 flex items-center justify-center mb-4 ring-1 ring-red-500/20",children:(0,a.jsx)(eg.Z,{className:"w-8 h-8 text-red-500"})}),(0,a.jsx)("h3",{className:"text-2xl font-bold text-white mb-2",children:"Delete Case"}),(0,a.jsxs)("p",{className:"text-text-secondary leading-relaxed",children:["Are you sure you want to delete case ",(0,a.jsx)("span",{className:"text-white font-bold",children:q.case_number}),"? This action cannot be undone."]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-end gap-3 px-6 py-4 border-t border-white/5 bg-[#0a0a0c]",children:[(0,a.jsx)("button",{onClick:()=>{U(!1),Q(null)},className:"px-5 py-2.5 rounded-xl border border-white/10 hover:bg-white/5 text-text-secondary transition-colors",children:"Cancel"}),(0,a.jsx)("button",{onClick:()=>q&&eM(q.id),disabled:V,className:"px-6 py-2.5 rounded-xl bg-red-600 hover:bg-red-700 text-white font-semibold shadow-lg shadow-red-600/20 transition-all hover:scale-[1.02] active:scale-[0.98] disabled:opacity-50",children:V?"Deleting...":"Delete Case"})]})]})]})]})}var tc=s(99637),to=s(98617),td=s(58293);function tm(e){let{currentView:t,onNavigate:s}=e,[c,o]=(0,i.useState)(!1),[d,m]=(0,i.useState)(!1),{state:x,actions:u}=(0,r.q)(),{user:h,profile:g,organization:y,subscription:f}=x,v=f&&f.credits_included>0?(f.credits_used||0)/f.credits_included:0,N=()=>f?v>=.95?"bg-red-500/10 border-red-500/50":v>=.8?"bg-orange-500/10 border-orange-500/50":v>=.6?"bg-yellow-500/10 border-yellow-500/50":"bg-green-500/10 border-green-500/50":"bg-bg-tertiary border-transparent",w=[{id:"dashboard",label:"Dashboard",icon:tc.Z,view:"dashboard"},{id:"support",label:"Support",icon:es.Z,view:"support"},{id:"strategy",label:"Strategy Center",icon:H.Z,view:"strategy"},{id:"agents",label:"Agents",icon:T.Z,view:"agents"},{id:"contacts",label:"CRM",icon:L.Z,view:"contacts"},{id:"calls",label:"Conversations",icon:j.Z,view:"calls"},{id:"reports",label:"Reports",icon:M.Z,view:"reports"},{id:"settings",label:"Settings",icon:tt.Z,view:"settings"}],_=()=>{m(!0)},C=async()=>{await u.logout(),m(!1),o(!1),s("auth")},k=()=>{m(!1)},D=()=>{var e,r;return(0,a.jsxs)("div",{className:"flex flex-col h-dvh bg-bg-secondary border-r border-bg-tertiary",children:[(0,a.jsx)("div",{className:"p-6 border-b border-bg-tertiary flex-shrink-0",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-gradient-primary rounded-xl flex items-center justify-center shadow-primary",children:(0,a.jsx)(R.Z,{className:"w-6 h-6 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-lg text-text-primary",children:"Kai"}),(0,a.jsx)("p",{className:"text-sm text-text-tertiary",children:"AI Support Platform"})]})]}),(0,a.jsx)("button",{onClick:()=>o(!1),className:"md:hidden p-2 rounded-lg hover:bg-bg-tertiary",children:(0,a.jsx)(b.Z,{className:"w-5 h-5 text-text-tertiary"})})]})}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto scrollbar-hide-hover min-h-0",children:(0,a.jsx)("nav",{className:"p-4 space-y-2",children:w.map(e=>{let r=t===e.view,i=e.icon;return(0,a.jsxs)("button",{onClick:()=>{s(e.view),o(!1)},className:"w-full flex items-center space-x-3 px-4 py-3 rounded-xl text-left transition-all duration-200 nav-item ".concat(r?"bg-bg-tertiary text-text-primary border border-primary-solid shadow-primary":"text-text-secondary hover:bg-bg-tertiary hover:text-text-primary"),disabled:!1,children:[(0,a.jsx)(i,{className:"w-5 h-5 ".concat(r?"text-primary-solid":"text-text-tertiary")}),(0,a.jsx)("span",{className:"flex-1",children:e.label})]},e.id)})})}),(0,a.jsxs)("div",{className:"p-4 border-t border-bg-tertiary flex-shrink-0",children:[f&&(0,a.jsxs)("div",{className:"rounded-xl p-4 mb-4 border ".concat(N()),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(to.Z,{className:"w-4 h-4 text-primary-solid"}),(0,a.jsx)("span",{className:"text-sm font-medium text-text-primary",children:"trial"===f.status?"Trial":"Credits"})]}),(0,a.jsx)("span",{className:"text-xs text-text-tertiary",children:"trial"===f.status?"Free":"Paid"})]}),"trial"===f.status?(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,a.jsx)("span",{className:"text-text-secondary",children:"Trial Days Left"}),(0,a.jsxs)("span",{className:"text-text-primary font-medium",children:[Math.max(0,Math.ceil((new Date(f.trial_end_date).getTime()-new Date().getTime())/864e5))," ","days"]})]}),(0,a.jsx)("div",{className:"w-full bg-bg-secondary rounded-full h-2",children:(0,a.jsx)("div",{className:"h-2 rounded-full bg-gradient-to-r from-indigo-500",style:{width:"".concat(Math.min(100,Math.max(0,Math.ceil((new Date(f.trial_end_date).getTime()-new Date().getTime())/864e5))/14*100),"%")}})})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,a.jsx)("span",{className:"text-text-secondary",children:"Credits Used"}),(0,a.jsxs)("span",{className:"text-text-primary font-medium",children:[(0,l.Hf)(f.credits_used||0)," /"," ",(0,l.Hf)(f.credits_included||0)]})]}),(0,a.jsx)("div",{className:"w-full bg-bg-secondary rounded-full h-2",children:(0,a.jsx)("div",{className:"h-2 rounded-full transition-all duration-300 ".concat((()=>{let e=100*v;return e>=95?"bg-gradient-to-r from-red-400 to-red-700":e>=80?"bg-gradient-to-r from-orange-400 to-orange-700":e>=60?"bg-gradient-to-r from-yellow-400 to-yellow-600":"bg-gradient-to-r from-green-400 to-green-700"})()),style:{width:"".concat(Math.min(100,100*v),"%")}})})]}),(0,a.jsx)("button",{onClick:()=>s("settings"),className:"w-full py-2 text-xs font-medium bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:"Add Credits"})]}):(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,a.jsx)("span",{className:"text-text-secondary",children:"Credits Used"}),(0,a.jsxs)("span",{className:"text-text-primary font-medium",children:[(0,l.Hf)(f.credits_used||0)," / ",(0,l.Hf)(f.credits_included||0)]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)("div",{className:"w-full bg-bg-secondary rounded-full h-2",children:(0,a.jsx)("div",{className:"h-2 rounded-full transition-all duration-300 ".concat((()=>{let e=100*v;return e>=95?"bg-gradient-to-r from-red-500 to-red-600":e>=80?"bg-gradient-to-r from-orange-500 to-orange-600":e>=60?"bg-gradient-to-r from-yellow-400 to-yellow-500":"bg-gradient-to-r from-green-500 to-green-600"})()),style:{width:"".concat(Math.min(100,100*v),"%")}})})}),(0,a.jsx)("div",{children:(0,a.jsx)("button",{onClick:()=>s("settings"),className:"px-3 py-1 text-xs bg-primary-600 text-white rounded-md",children:"Add Credits"})})]})]})]}),g&&(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 flex-1 min-w-0",children:[(0,a.jsx)("div",{className:"w-8 h-8 bg-gradient-primary rounded-lg flex items-center justify-center flex-shrink-0",children:(0,a.jsxs)("span",{className:"text-sm font-medium text-white",children:[null===(e=g.first_name)||void 0===e?void 0:e[0],null===(r=g.last_name)||void 0===r?void 0:r[0]]})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("p",{className:"text-sm font-medium text-text-primary truncate",children:[g.first_name," ",g.last_name]}),(0,a.jsx)("p",{className:"text-xs text-text-tertiary truncate",children:null==h?void 0:h.email})]})]}),(0,a.jsx)("button",{onClick:_,className:"p-2 rounded-lg hover:bg-bg-tertiary text-text-tertiary hover:text-red-400 transition-colors duration-200 flex-shrink-0",title:"Sign Out",children:(0,a.jsx)(Y.Z,{className:"w-4 h-4"})})]})]})]})};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>o(!0),className:"md:hidden fixed top-4 left-4 z-50 p-2 bg-bg-secondary rounded-lg shadow-primary border border-bg-tertiary",children:(0,a.jsx)(td.Z,{className:"w-6 h-6 text-text-secondary"})}),(0,a.jsx)("div",{className:"hidden md:flex w-64 h-screen fixed left-0 top-0 z-40",children:(0,a.jsx)(D,{})}),(0,a.jsx)(p.M,{children:c&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"md:hidden fixed inset-0 bg-black bg-opacity-50 z-40",onClick:()=>o(!1)}),(0,a.jsx)(n.E.div,{initial:{x:-320},animate:{x:0},exit:{x:-320},transition:{type:"spring",damping:25,stiffness:200},className:"md:hidden fixed left-0 top-0 bottom-0 w-80 z-50",style:{height:"100dvh"},children:(0,a.jsx)(D,{})})]})}),(0,a.jsx)(p.M,{children:d&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center",onClick:k}),(0,a.jsx)(n.E.div,{initial:{scale:.9,opacity:0,y:20},animate:{scale:1,opacity:1,y:0},exit:{scale:.9,opacity:0,y:20},transition:{type:"spring",damping:25,stiffness:300},className:"fixed inset-0 z-50 flex items-center justify-center p-4 pointer-events-none",children:(0,a.jsxs)("div",{className:"bg-gradient-to-br from-bg-secondary to-bg-tertiary border-2 border-red-500/20 rounded-3xl p-8 max-w-md w-full shadow-2xl pointer-events-auto relative overflow-hidden",children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-red-500/5 to-transparent pointer-events-none"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"flex items-center justify-center mb-6",children:(0,a.jsx)(n.E.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.1,type:"spring",stiffness:200},className:"w-16 h-16 bg-gradient-to-br from-red-500 to-red-600 rounded-2xl flex items-center justify-center shadow-lg",children:(0,a.jsx)(Y.Z,{className:"w-8 h-8 text-white"})})}),(0,a.jsx)(n.E.h3,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.15},className:"text-2xl font-medium text-text-primary text-center mb-3",children:"Sign Out"}),(0,a.jsx)(n.E.p,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2},className:"text-text-secondary text-center mb-8 text-base",children:"Are you sure you want to sign out of your account?"}),(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.25},className:"flex space-x-4",children:[(0,a.jsx)("button",{onClick:k,className:"flex-1 px-6 py-3 text-sm font-medium text-text-primary bg-bg-tertiary hover:bg-bg-tertiary/70 border border-border-subtle rounded-xl transition-all duration-200 hover:scale-105 active:scale-95",children:"Cancel"}),(0,a.jsx)("button",{onClick:C,className:"flex-1 px-6 py-3 text-sm font-medium text-white bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 rounded-xl transition-all duration-200 shadow-lg hover:shadow-red-500/30 hover:scale-105 active:scale-95",children:"Sign Out"})]})]})]})})]})})]})}var tx=s(29600);function tu(e){let{size:t="md",text:s="Loading...",fullScreen:r=!1}=e,i=(0,a.jsxs)(n.E.div,{initial:{opacity:0},animate:{opacity:1},className:"flex flex-col items-center justify-center space-y-4",children:[(0,a.jsx)(ea.Z,{className:"".concat({sm:"w-4 h-4",md:"w-8 h-8",lg:"w-12 h-12"}[t]," text-primary-solid animate-spin")}),s&&(0,a.jsx)("p",{className:"".concat({sm:"text-sm",md:"text-base",lg:"text-lg"}[t]," text-text-secondary"),children:s})]});return r?(0,a.jsx)("div",{className:"fixed inset-0 bg-background/80 backdrop-blur-sm flex items-center justify-center z-50",children:i}):i}let tp={"/":"dashboard","/auth":"auth","/welcome":"welcome","/setup":"setup","/dashboard":"dashboard","/contacts":"contacts","/agents":"agents","/reports":"reports","/calls":"calls","/settings":"settings","/strategy":"strategy","/support":"support"},th={auth:"/auth",welcome:"/welcome",setup:"/setup",dashboard:"/dashboard",contacts:"/contacts",agents:"/agents",reports:"/reports",calls:"/calls",settings:"/settings",strategy:"/strategy",support:"/support"};function tg(){var e;let{state:t,actions:s}=(0,r.q)(),{currentPath:c,navigate:o,replace:d}=function(){let[e,t]=(0,i.useState)("");return(0,i.useEffect)(()=>{let e=()=>window.location.pathname.replace("","")||"/",s=sessionStorage.getItem("redirect-path");if(s){console.log("\uD83D\uDD04 Handling 404 redirect to:",s),sessionStorage.removeItem("redirect-path");let e="/"+s.split("?")[0].split("#")[0];t(e),window.history.replaceState({},"",""+e)}else t(e());let a=()=>{t(e())};return window.addEventListener("popstate",a),()=>window.removeEventListener("popstate",a)},[]),{currentPath:e,navigate:e=>{window.history.pushState({},"",""+e),t(e),document.title=({"/auth":"Sign In - Kai Agent","/welcome":"Welcome - Kai Agent","/setup":"Agent Setup - Kai Agent","/dashboard":"Dashboard - Kai Agent","/contacts":"CRM - Kai Agent","/agents":"Voice Agents - Kai Agent","/reports":"Reports - Kai Agent","/calls":"Call History - Kai Agent","/settings":"Settings - Kai Agent","/strategy":"Strategy Center - Kai Agent","/support":"Support - Kai Agent"})[e]||(e.startsWith("/support/")?"".concat(decodeURIComponent(e.split("/").pop()||"")," - Support - Kai Agent"):"Kai Agent")},replace:e=>{window.history.replaceState({},"",""+e),t(e)}}}(),{forceSync:m}=function(){var e,t,s;let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{enableRealtime:n=!0,syncInterval:c=3e4,tables:o=["contacts","agents","calls","communication_strategies","outbound_queue"]}=a,{state:d,actions:m}=(0,r.q)(),{handleError:u,safeAsyncCall:p}=en(),h=(0,i.useRef)(),g=(0,i.useRef)({}),b=(0,i.useCallback)(async function(){var e;let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(null===(e=d.user)||void 0===e?void 0:e.id)&&await p(async()=>{console.log("\uD83D\uDD04 Force syncing all data...",{silent:t}),await m.fetchUserData(t),g.current={...g.current,lastFullSync:new Date().toISOString()},t||x.ZP.success("Data synchronized")},"force sync")},[null===(e=d.user)||void 0===e?void 0:e.id,m,p]),y=(0,i.useCallback)(async()=>{var e;if(null===(e=d.organization)||void 0===e?void 0:e.id)try{let{count:e}=await l.OQ.from("contacts").select("*",{count:"exact",head:!0}).eq("organization_id",d.organization.id),{count:t}=await l.OQ.from("contacts").select("id",{count:"exact",head:!0}).eq("organization_id",d.organization.id);e!==t&&(console.warn("Data inconsistency detected in contacts count"),b(!0));let s=d.agents.filter(e=>e.is_active).length,{count:a}=await l.OQ.from("agents").select("*",{count:"exact",head:!0}).eq("organization_id",d.organization.id).eq("is_active",!0);s!==a&&(console.warn("Agent count inconsistency detected"),await m.fetchUserData(!0))}catch(e){u(e,"data consistency validation",{showToast:!1})}},[null===(t=d.organization)||void 0===t?void 0:t.id,d.agents,b,u,m]);return(0,i.useEffect)(()=>{var e;if(!n||!(null===(e=d.organization)||void 0===e?void 0:e.id))return;let t=[];return o.forEach(e=>{var s;let a=l.OQ.channel("".concat(e,"_changes")).on("postgres_changes",{event:"*",schema:"public",table:e,filter:"organization_id=eq.".concat(null===(s=d.organization)||void 0===s?void 0:s.id)},t=>{console.log("\uD83D\uDCE1 Real-time update for ".concat(e,":"),t),h.current&&clearTimeout(h.current),h.current=setTimeout(()=>{if(document.hidden){console.log("\uD83D\uDCE1 Real-time update received while tab hidden, skipping sync for ".concat(e));return}switch(e){case"contacts":case"agents":case"calls":m.fetchUserData(!0);break;default:console.log("Update received for ".concat(e,", considering refresh..."))}},1e3)}).subscribe();t.push(a)}),()=>{t.forEach(e=>{l.OQ.removeChannel(e)}),h.current&&clearTimeout(h.current)}},[n,null===(s=d.organization)||void 0===s?void 0:s.id,o,m]),(0,i.useEffect)(()=>{if(!c)return;let e=null,t=()=>{e&&clearInterval(e),e=setInterval(()=>{document.hidden||y()},c)},s=()=>{"visible"===document.visibilityState?t():e&&(clearInterval(e),e=null)};return t(),document.addEventListener("visibilitychange",s),()=>{e&&clearInterval(e),document.removeEventListener("visibilitychange",s)}},[c,y]),(0,i.useEffect)(()=>{let e=!1,t=Date.now(),s=null,a=()=>{e&&(Date.now()-t>6e4?(console.log("\uD83C\uDF10 Connection restored, syncing data silently..."),t=Date.now(),b(!0)):console.log("\uD83C\uDF10 Connection restored, but synced recently, skipping..."),e=!1)},r=()=>{console.log("\uD83D\uDD0C Connection lost"),e=!0,x.ZP.error("Connection lost. Some features may not work properly.")},i=()=>{if("hidden"===document.visibilityState)s=Date.now(),console.log("\uD83D\uDC41️ Tab hidden");else if("visible"===document.visibilityState){let e=Date.now()-t,a=s?Date.now()-s:0;e>6e5&&a>6e5?(console.log("\uD83D\uDC41️ Tab became visible after very long absence, syncing data silently..."),t=Date.now(),b(!0)):e>6e4?(console.log("\uD83D\uDC41️ Tab became visible, silently syncing data in background..."),t=Date.now(),b(!0)):console.log("\uD83D\uDC41️ Tab became visible, but synced recently, skipping refresh..."),s=null}};return window.addEventListener("online",a),window.addEventListener("offline",r),document.addEventListener("visibilitychange",i),()=>{window.removeEventListener("online",a),window.removeEventListener("offline",r),document.removeEventListener("visibilitychange",i)}},[b]),{forceSync:b,validateDataConsistency:y,lastSync:g.current}}({enableRealtime:!0,syncInterval:3e4}),u=e=>tp[e]?tp[e]:e.startsWith("/support/")?"support":"auth",[p,h]=(0,i.useState)(()=>u(c)),[g,b]=(0,i.useState)(!1),y=(0,i.useRef)(!1),f=(0,i.useRef)(Date.now());(0,i.useEffect)(()=>{let e=()=>{"visible"===document.visibilityState&&(f.current=Date.now())};return document.addEventListener("visibilitychange",e),()=>document.removeEventListener("visibilitychange",e)},[]);let j=(0,i.useCallback)(async()=>{var e;if(!y.current&&(null===(e=t.user)||void 0===e?void 0:e.id)){y.current=!0,console.log("\uD83D\uDD27 Auto-fixing onboarding status...");try{await l.OQ.from("user_profiles").update({onboarding_completed:!0}).eq("id",t.user.id),console.log("\uD83D\uDD04 Refreshing profile data after auto-fix..."),await s.fetchUserData(!0)}catch(e){console.error("Auto-fix failed:",e),y.current=!1}}},[null===(e=t.user)||void 0===e?void 0:e.id]),v=(0,i.useCallback)(e=>{console.log("\uD83E\uDDED Navigating to:",e);let t=th[e];b(!0),o(t),h(e),setTimeout(()=>b(!1),100)},[o]);if((0,i.useEffect)(()=>{if(!t.initialized||g)return;let e=u(c);e!==p&&(console.log("\uD83C\uDF10 URL changed, updating view:",c,"->",e),h(e))},[c,t.initialized,g,p]),(0,i.useEffect)(()=>{var e;if(!t.initialized||g)return;console.log("\uD83E\uDDED Determining view:",{currentUrl:c,hasUser:!!t.user,hasProfile:!!t.profile,hasOrg:!!t.organization,agentsCount:t.agents.length,onboardingComplete:null===(e=t.profile)||void 0===e?void 0:e.onboarding_completed,isLoading:t.loading});let s=u(c),a=s;if(t.user){if(t.profile){if(t.organization){if(t.profile.onboarding_completed)0===t.agents.length?"setup"!==s&&(console.log("\uD83E\uDD16 No agents, redirecting to setup"),a="setup"):("auth"===s||"welcome"===s)&&(console.log("\uD83D\uDCCA User setup complete, redirecting to dashboard"),a="dashboard");else{if(t.agents.length>0){j();return}"welcome"!==s&&"setup"!==s&&(console.log("\uD83E\uDD16 Onboarding incomplete, redirecting to setup"),a="setup")}}else"welcome"!==s&&"setup"!==s&&(console.log("\uD83D\uDC4B No org yet, redirecting to welcome"),a="welcome")}else"welcome"!==s&&(console.log("\uD83D\uDC4B No profile, redirecting to welcome"),a="welcome")}else"auth"!==s&&(console.log("\uD83D\uDD10 User not authenticated, redirecting to auth"),a="auth");a!==s?(console.log("\uD83C\uDFAF Redirecting from",s,"to",a),d(th[a]),h(a)):a!==p&&(console.log("\uD83C\uDFAF Setting view to:",a),h(a))},[t.initialized,t.user,t.profile,t.organization,t.agents.length,t.loading,c,p,g,d,j]),!t.initialized)return(0,a.jsx)(tx.default,{children:(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-background",children:(0,a.jsx)(tu,{size:"lg",text:"Initializing your AI voice platform..."})})});let N=Date.now()-f.current;return t.loading&&(document.hidden||N>2e3)?(0,a.jsx)(tx.default,{children:(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-background",children:(0,a.jsx)(tu,{size:"lg",text:"Loading your data..."})})}):(()=>{switch(p){case"auth":return(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-background p-4",children:(0,a.jsx)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"w-full max-w-md",children:(0,a.jsx)(O,{onAuthSuccess:()=>{console.log("\uD83C\uDFAF Auth success - fetchUserData will be triggered by auth state change")}})})});case"welcome":return(0,a.jsx)(V,{onGetStarted:()=>v("setup")});case"setup":return(0,a.jsx)(X,{onComplete:async()=>{await s.fetchUserData(),v("dashboard")},onBack:()=>v("welcome"),onLogout:async()=>{await s.logout(),v("auth")}});default:return(0,a.jsx)(tx.default,{children:(0,a.jsxs)("div",{className:"page-container",children:[(0,a.jsx)(tm,{currentView:p,onNavigate:v}),(0,a.jsx)("div",{className:"md:ml-64",children:(0,a.jsx)("main",{className:"p-4 md:p-8",children:(0,a.jsxs)(tx.default,{fallback:(0,a.jsxs)("div",{className:"card p-8 text-center",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-text-primary mb-2",children:"Page Error"}),(0,a.jsx)("p",{className:"text-text-secondary mb-4",children:"This page encountered an error."}),(0,a.jsx)("button",{onClick:()=>window.location.reload(),className:"btn-primary",children:"Refresh Page"})]}),children:["dashboard"===p&&(0,a.jsx)(ec,{onNavigate:v}),"contacts"===p&&(0,a.jsx)(eF,{onNavigate:v}),"agents"===p&&(0,a.jsx)(eL,{onNavigate:v}),"reports"===p&&(0,a.jsx)(eW,{onNavigate:v}),"calls"===p&&(0,a.jsx)(e$,{onNavigate:v}),"settings"===p&&(0,a.jsx)(te,{onNavigate:v}),"strategy"===p&&(0,a.jsx)(ts,{onNavigate:v}),"support"===p&&(0,a.jsx)(tl,{})]})})})]})})}})()}}}]);